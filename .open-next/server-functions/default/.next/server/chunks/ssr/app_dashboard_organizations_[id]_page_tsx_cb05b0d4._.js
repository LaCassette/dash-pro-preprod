module.exports=[58105,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(278165),f=a.i(703130),g=a.i(340695),h=a.i(205522),i=a.i(917171),j=a.i(254161),k=a.i(965733),l=a.i(905094),m=a.i(277687),n=a.i(660246),o=a.i(992258),p=a.i(717371),q=a.i(533441),r=a.i(633508),s=a.i(400210);function t(){let a=(0,d.useParams)(),t=(0,d.useRouter)(),{user:u}=(0,e.useUser)(),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(null),{toast:N}=(0,m.useToast)(),O=a.id,P=u?.role==="PRO",Q=v?.owner.id===u?.id;async function R(){try{let a=await fetch(`/api/organizations/${O}`);if(!a.ok)throw Error("Failed to fetch organization");let b=await a.json();w(b);let c=b.owner.id===u?.id,d=u?.role==="PRO",e=[];d?e.push(fetch(`/api/organizations/${O}/invitations`)):e.push(Promise.resolve(null)),d&&c?e.push(fetch(`/api/organizations/${O}/requests`)):e.push(Promise.resolve(null));let[f,g]=await Promise.all(e);if(f&&f.ok){let a=await f.json();y(a)}if(g)if(g.ok){let a=await g.json();console.log("Requests fetched:",a),A(a)}else console.error("Failed to fetch requests:",g.status,await g.text());else console.log("Requests not fetched - userIsPro:",d,"userIsOwner:",c)}catch(a){console.error("Error fetching data:",a),N({title:"Erreur",description:"Impossible de charger les données",variant:"destructive"})}finally{C(!1)}}async function S(){if(!H.trim())return void N({title:"Erreur",description:"Veuillez entrer un email",variant:"destructive"});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(H))return void N({title:"Erreur",description:"Format d'email invalide",variant:"destructive"});try{let a=await fetch(`/api/organizations/${O}/invite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:H.trim()})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to invite")}N({title:"Succès",description:"Invitation envoyée"}),I(""),E(!1),R()}catch(a){N({title:"Erreur",description:a instanceof Error?a.message:"Impossible d'envoyer l'invitation",variant:"destructive"})}}async function T(){try{let a=await fetch(`/api/organizations/${O}/request`,{method:"POST"});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to request")}N({title:"Succès",description:"Demande envoyée"}),G(!1)}catch(a){N({title:"Erreur",description:a instanceof Error?a.message:"Impossible d'envoyer la demande",variant:"destructive"})}}async function U(a){try{if(!(await fetch(`/api/organizations/${O}/invitations/${a}`,{method:"POST"})).ok)throw Error("Failed to accept");N({title:"Succès",description:"Invitation acceptée"}),R()}catch(a){N({title:"Erreur",description:"Impossible d'accepter l'invitation",variant:"destructive"})}}async function V(a){try{if(!(await fetch(`/api/organizations/${O}/invitations/${a}`,{method:"DELETE"})).ok)throw Error("Failed to cancel");N({title:"Succès",description:"Invitation annulée"}),R()}catch(a){N({title:"Erreur",description:"Impossible d'annuler l'invitation",variant:"destructive"})}}async function W(a,b){K(a);try{let c=await fetch(`/api/organizations/${O}/requests/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:b})});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to process request")}N({title:"Succès",description:"approve"===b?"La demande a été approuvée et l'utilisateur a été ajouté à l'organisation":"La demande a été rejetée"}),await R()}catch(a){N({title:"Erreur",description:a instanceof Error?a.message:"Impossible de traiter la demande",variant:"destructive"})}finally{K(null),M(null)}}function X(a,b){M({requestId:a,action:b})}(0,c.useEffect)(()=>{u&&R()},[u,O]);let Y=(0,c.useMemo)(()=>x.filter(a=>"PENDING"===a.status),[x]),Z=(0,c.useMemo)(()=>{let a=z.filter(a=>"PENDING"===a.status);return console.log("All requests:",z),console.log("Pending requests:",a),a},[z]),$=(0,c.useMemo)(()=>u&&"USER"===u.role?Y.filter(a=>a.email===u.email||a.user?.id===u.id):[],[Y,u]);return B?(0,b.jsx)("div",{className:"container mx-auto p-6",children:"Chargement..."}):v?(0,b.jsxs)("div",{className:"container mx-auto p-6",children:[(0,b.jsxs)(g.Button,{variant:"ghost",onClick:()=>t.push("/dashboard/organizations"),className:"mb-4",children:[(0,b.jsx)(s.ArrowLeft,{className:"mr-2 h-4 w-4"}),"Retour"]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:v.name}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gestion des membres et invitations"})]}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Users,{className:"h-5 w-5"}),"Membres (",v.members.length,")"]})}),(0,b.jsx)(f.CardContent,{className:"space-y-2",children:v.members.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.user.name||a.user.email}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.user.email})]}),(0,b.jsx)(j.Badge,{variant:"outline",children:a.user.role})]},a.user.id))})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Actions"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-2",children:[P&&Q&&(0,b.jsxs)(k.Dialog,{open:D,onOpenChange:E,children:[(0,b.jsx)(k.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{className:"w-full",children:[(0,b.jsx)(p.UserPlus,{className:"mr-2 h-4 w-4"}),"Inviter un utilisateur"]})}),(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Inviter un utilisateur"}),(0,b.jsx)(k.DialogDescription,{children:"Entrez l'email de l'utilisateur à inviter"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(h.Input,{id:"email",type:"email",value:H,onChange:a=>I(a.target.value),placeholder:"user@example.com"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>E(!1),children:"Annuler"}),(0,b.jsx)(g.Button,{onClick:S,children:"Inviter"})]})]})]})]}),u?.role==="USER"&&!v.members.some(a=>a.user.id===u.id)&&(0,b.jsxs)(k.Dialog,{open:F,onOpenChange:G,children:[(0,b.jsx)(k.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",className:"w-full",children:[(0,b.jsx)(o.Mail,{className:"mr-2 h-4 w-4"}),"Demander à rejoindre"]})}),(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Demander à rejoindre"}),(0,b.jsx)(k.DialogDescription,{children:"Voulez-vous demander à rejoindre cette organisation ?"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>G(!1),children:"Annuler"}),(0,b.jsx)(g.Button,{onClick:T,children:"Envoyer la demande"})]})]})]})]})]}),P&&Q&&Y.length>0&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Mail,{className:"h-5 w-5"}),"Invitations en attente (",Y.length,")"]})}),(0,b.jsx)(f.CardContent,{className:"space-y-2",children:Y.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.user?.name||a.email}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.email})]}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>V(a.id),children:(0,b.jsx)(r.X,{className:"h-4 w-4"})})]},a.id))})]}),P&&Q&&(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.UserPlus,{className:"h-5 w-5"}),"Demandes d'adhésion (",Z.length,")"]}),(0,b.jsx)(f.CardDescription,{children:"Gérez les demandes des utilisateurs souhaitant rejoindre votre organisation"})]}),(0,b.jsx)(f.CardContent,{children:Z.length>0?(0,b.jsx)("div",{className:"space-y-3",children:Z.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-medium",children:a.user.name||a.user.email}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.user.email}),a.createdAt&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["Demandé le ",new Date(a.createdAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(g.Button,{variant:"default",size:"sm",onClick:()=>X(a.id,"approve"),disabled:J===a.id,className:"gap-2",children:J===a.id?(0,b.jsx)(b.Fragment,{children:"Chargement..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Check,{className:"h-4 w-4"}),"Accepter"]})}),(0,b.jsx)(g.Button,{variant:"destructive",size:"sm",onClick:()=>X(a.id,"reject"),disabled:J===a.id,className:"gap-2",children:J===a.id?(0,b.jsx)(b.Fragment,{children:"Chargement..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.X,{className:"h-4 w-4"}),"Refuser"]})})]})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(p.UserPlus,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"Aucune demande en attente"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"Les utilisateurs peuvent demander à rejoindre votre organisation"})]})})]}),u?.role==="USER"&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Mes invitations"})}),(0,b.jsx)(f.CardContent,{className:"space-y-2",children:$.length>0?$.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:v.name}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Invitation en attente"})]}),(0,b.jsx)(g.Button,{size:"sm",onClick:()=>U(a.id),children:"Accepter"})]},a.id)):(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Aucune invitation"})})]})]}),(0,b.jsx)(l.AlertDialog,{open:!!L,onOpenChange:a=>!a&&M(null),children:(0,b.jsxs)(l.AlertDialogContent,{children:[(0,b.jsxs)(l.AlertDialogHeader,{children:[(0,b.jsx)(l.AlertDialogTitle,{children:L?.action==="approve"?"Accepter la demande":"Refuser la demande"}),(0,b.jsx)(l.AlertDialogDescription,{children:L?.action==="approve"?(0,b.jsx)(b.Fragment,{children:"Êtes-vous sûr de vouloir accepter cette demande ? L'utilisateur sera ajouté comme membre de votre organisation."}):(0,b.jsx)(b.Fragment,{children:"Êtes-vous sûr de vouloir refuser cette demande ? Cette action ne peut pas être annulée."})})]}),(0,b.jsxs)(l.AlertDialogFooter,{children:[(0,b.jsx)(l.AlertDialogCancel,{children:"Annuler"}),(0,b.jsx)(l.AlertDialogAction,{onClick:()=>{L&&W(L.requestId,L.action)},className:L?.action==="reject"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:L?.action==="approve"?"Accepter":"Refuser"})]})]})})]}):(0,b.jsx)("div",{className:"container mx-auto p-6",children:(0,b.jsx)(f.Card,{children:(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Organisation introuvable"})})})})}a.s(["default",()=>t])}];

//# sourceMappingURL=app_dashboard_organizations_%5Bid%5D_page_tsx_cb05b0d4._.js.map