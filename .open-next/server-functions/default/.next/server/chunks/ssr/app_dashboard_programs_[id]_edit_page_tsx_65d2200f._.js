module.exports=[433673,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(278165),f=a.i(277687),g=a.i(703130),h=a.i(340695),i=a.i(205522),j=a.i(917171),k=a.i(546893),l=a.i(254161),m=a.i(621958),n=a.i(514727),o=a.i(46470),p=a.i(965733),q=a.i(400210),r=a.i(114548),s=a.i(177156),t=a.i(824569),u=a.i(596221),v=a.i(835181),w=a.i(781560),x=a.i(915618),y=a.i(641710),z=a.i(971824),A=a.i(598091),A=A,B=a.i(504699),B=B,C=a.i(762180),D=a.i(558348),E=a.i(905094);let F={CHEST:"Pectoraux",BACK:"Dos",SHOULDERS:"Épaules",BICEPS:"Biceps",TRICEPS:"Triceps",FOREARMS:"Avant-bras",ABS:"Abdos",OBLIQUES:"Obliques",QUADRICEPS:"Quadriceps",HAMSTRINGS:"Ischio-jambiers",GLUTES:"Fessiers",CALVES:"Mollets",LOWER_BACK:"Lombaires",TRAPS:"Trapèzes",FULL_BODY:"Full Body",CARDIO:"Cardio",STRETCHING:"Étirements"},G={CHEST:"bg-red-500",BACK:"bg-blue-500",SHOULDERS:"bg-orange-500",BICEPS:"bg-purple-500",TRICEPS:"bg-pink-500",FOREARMS:"bg-amber-500",ABS:"bg-green-500",OBLIQUES:"bg-lime-500",QUADRICEPS:"bg-cyan-500",HAMSTRINGS:"bg-teal-500",GLUTES:"bg-rose-500",CALVES:"bg-sky-500",LOWER_BACK:"bg-indigo-500",TRAPS:"bg-violet-500",FULL_BODY:"bg-gray-500",CARDIO:"bg-red-400",STRETCHING:"bg-emerald-500"};function H(){let a=(0,d.useParams)(),H=(0,d.useRouter)(),{user:I}=(0,e.useUser)(),{toast:J}=(0,f.useToast)(),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(!0),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(""),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)(""),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)({}),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(""),[ai,aj]=(0,c.useState)("exercises"),[ak,al]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a.id&&ao(a.id)},[a.id]);let am=(0,c.useCallback)(a=>{try{let b=JSON.parse(a);if(b.exercises&&Array.isArray(b.exercises)){X(b.exercises),_(!0),Z(b.notes||"");return}}catch{}_(!1),X([]),Z(a)},[]),an=(0,c.useCallback)(()=>$||W.length>0?JSON.stringify({exercises:W,notes:Y||void 0}):Y,[W,Y,$]);async function ao(a){N(!0);try{let b=await fetch(`/api/programs/${a}`);if(!b.ok){if(404===b.status){J({title:"Erreur",description:"Programme non trouvé",variant:"destructive"}),H.push("/dashboard");return}throw Error("Failed to fetch program")}let c=await b.json();if(I&&c.createdBy.id!==I.id){J({title:"Accès refusé",description:"Vous ne pouvez pas modifier ce programme",variant:"destructive"}),H.push(`/dashboard/programs/${a}`);return}L(c),T(c.name),V(c.description||""),am(c.content)}catch(a){console.error("Error fetching program:",a),J({title:"Erreur",description:"Impossible de charger le programme",variant:"destructive"}),H.push("/dashboard")}finally{N(!1)}}async function ap(){if(!(Object.keys(aa).length>0)){ad(!0);try{let a=await fetch("/api/exercises/grouped");a.ok&&ab(await a.json())}catch(a){console.error("Error loading exercises:",a)}finally{ad(!1)}}}(0,c.useEffect)(()=>{if(K){let a=an();al(S!==K.name||U!==(K.description||"")||a!==K.content)}},[S,U,W,Y,K,an]);let aq=async()=>{if(!K||!S.trim())return void J({title:"Erreur",description:"Le nom du programme est requis",variant:"destructive"});P(!0);try{let a=await fetch(`/api/programs/${K.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:S.trim(),description:U.trim()||null,content:an()})});if(!a.ok)throw Error("Failed to save program");let b=await a.json();L(b),al(!1),J({title:"Succès",description:"Programme sauvegardé"})}catch(a){console.error("Error saving program:",a),J({title:"Erreur",description:"Impossible de sauvegarder le programme",variant:"destructive"})}finally{P(!1)}},ar=async()=>{if(K){R(!0);try{if(!(await fetch(`/api/programs/${K.id}`,{method:"DELETE"})).ok)throw Error("Failed to delete program");J({title:"Succès",description:"Programme supprimé"}),H.push("/dashboard/programs")}catch(a){console.error("Error deleting program:",a),J({title:"Erreur",description:"Impossible de supprimer",variant:"destructive"})}finally{R(!1)}}},as=(a,b,c)=>{let d=[...W];d[a]={...d[a],[b]:c},X(d)},at=(a,b)=>{if("up"===b&&0===a||"down"===b&&a===W.length-1)return;let c="up"===b?a-1:a+1,d=[...W];[d[a],d[c]]=[d[c],d[a]],d.forEach((a,b)=>a.order=b),X(d)};if(M)return(0,b.jsx)("div",{className:"w-full min-w-0 p-6",children:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(u.Loader2,{className:"h-8 w-8 animate-spin"})})});if(!K)return null;let au="SPORT"===K.type;return(0,b.jsxs)("div",{className:"w-full min-w-0 p-6 h-screen flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(n.SidebarTrigger,{}),(0,b.jsxs)(h.Button,{variant:"ghost",onClick:()=>{ak?confirm("Modifications non sauvegardées. Quitter ?")&&H.push(`/dashboard/programs/${K.id}`):H.push(`/dashboard/programs/${K.id}`)},children:[(0,b.jsx)(q.ArrowLeft,{className:"mr-2 h-4 w-4"})," Retour"]}),(0,b.jsx)(l.Badge,{variant:au?"default":"secondary",children:au?"Sportif":"Nutritionnel"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[ak&&(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Modifications non sauvegardées"}),(0,b.jsxs)(h.Button,{onClick:aq,disabled:O||!ak,children:[O?(0,b.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(r.Save,{className:"mr-2 h-4 w-4"}),"Sauvegarder"]}),(0,b.jsxs)(E.AlertDialog,{children:[(0,b.jsx)(E.AlertDialogTrigger,{asChild:!0,children:(0,b.jsxs)(h.Button,{variant:"destructive",disabled:Q,children:[(0,b.jsx)(w.Trash2,{className:"mr-2 h-4 w-4"})," Supprimer"]})}),(0,b.jsxs)(E.AlertDialogContent,{children:[(0,b.jsxs)(E.AlertDialogHeader,{children:[(0,b.jsx)(E.AlertDialogTitle,{children:"Supprimer le programme ?"}),(0,b.jsx)(E.AlertDialogDescription,{children:"Cette action est irréversible."})]}),(0,b.jsxs)(E.AlertDialogFooter,{children:[(0,b.jsx)(E.AlertDialogCancel,{children:"Annuler"}),(0,b.jsx)(E.AlertDialogAction,{onClick:ar,children:"Supprimer"})]})]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"name",children:"Nom du programme"}),(0,b.jsx)(i.Input,{id:"name",value:S,onChange:a=>T(a.target.value),placeholder:"Nom du programme"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"description",children:"Description (optionnelle)"}),(0,b.jsx)(i.Input,{id:"description",value:U,onChange:a=>V(a.target.value),placeholder:"Description"})]})]}),(0,b.jsxs)(m.Tabs,{value:ai,onValueChange:a=>aj(a),className:"flex-1 flex flex-col",children:[(0,b.jsxs)(m.TabsList,{className:"w-fit",children:[(0,b.jsxs)(m.TabsTrigger,{value:"exercises",className:"gap-2",children:[(0,b.jsx)(v.Dumbbell,{className:"h-4 w-4"})," Exercices (",W.length,")"]}),(0,b.jsxs)(m.TabsTrigger,{value:"notes",className:"gap-2",children:[(0,b.jsx)(t.Edit,{className:"h-4 w-4"})," Notes"]}),(0,b.jsxs)(m.TabsTrigger,{value:"preview",className:"gap-2",children:[(0,b.jsx)(s.Eye,{className:"h-4 w-4"})," Aperçu"]})]}),(0,b.jsx)(m.TabsContent,{value:"exercises",className:"flex-1 mt-4",children:(0,b.jsxs)(g.Card,{className:"h-full",children:[(0,b.jsx)(g.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(g.CardTitle,{children:"Exercices du programme"}),(0,b.jsxs)(p.Dialog,{open:ae,onOpenChange:a=>{af(a),a&&ap()},children:[(0,b.jsx)(p.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(h.Button,{size:"sm",children:[(0,b.jsx)(x.Plus,{className:"h-4 w-4 mr-2"})," Ajouter un exercice"]})}),(0,b.jsxs)(p.DialogContent,{className:"max-w-2xl max-h-[80vh]",children:[(0,b.jsx)(p.DialogHeader,{children:(0,b.jsx)(p.DialogTitle,{children:"Bibliothèque d'exercices"})}),ac?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(u.Loader2,{className:"h-6 w-6 animate-spin"})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("select",{className:"w-full p-2 rounded border bg-background",value:ag,onChange:a=>ah(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Choisir un groupe musculaire"}),Object.keys(aa).map(a=>(0,b.jsxs)("option",{value:a,children:[F[a]||a," (",aa[a].length,")"]},a))]}),ag&&(0,b.jsx)(o.ScrollArea,{className:"h-[400px]",children:(0,b.jsx)("div",{className:"space-y-2 pr-4",children:aa[ag]?.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-muted cursor-pointer",onClick:()=>{let b;return b={name:a.name,exerciseId:a.id,muscleGroup:a.muscleGroup,series:3,reps:"10",rest:"60s",notes:"",order:W.length},void(X([...W,b]),_(!0),af(!1),J({title:"Exercice ajouté",description:a.name}))},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),(0,b.jsx)(l.Badge,{variant:"outline",className:"text-xs mt-1",children:F[a.muscleGroup]})]}),(0,b.jsx)(x.Plus,{className:"h-4 w-4"})]},a.id))})})]})]})]})]})}),(0,b.jsx)(g.CardContent,{children:0===W.length?(0,b.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(v.Dumbbell,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),(0,b.jsx)("p",{children:"Aucun exercice dans ce programme"}),(0,b.jsx)("p",{className:"text-sm",children:'Cliquez sur "Ajouter un exercice" pour commencer'})]}):(0,b.jsx)(o.ScrollArea,{className:"h-[calc(100vh-400px)]",children:(0,b.jsx)("div",{className:"space-y-3 pr-4",children:W.map((a,c)=>(0,b.jsxs)("div",{className:"p-4 rounded-lg border bg-card space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("button",{onClick:()=>at(c,"up"),disabled:0===c,className:"p-1 hover:bg-muted rounded disabled:opacity-30",children:(0,b.jsx)(A.default,{className:"h-3 w-3"})}),(0,b.jsx)("button",{onClick:()=>at(c,"down"),disabled:c===W.length-1,className:"p-1 hover:bg-muted rounded disabled:opacity-30",children:(0,b.jsx)(B.default,{className:"h-3 w-3"})})]}),(0,b.jsx)(l.Badge,{variant:"secondary",children:c+1}),(0,b.jsx)("span",{className:"font-semibold",children:a.name}),(0,b.jsx)(l.Badge,{className:`${G[a.muscleGroup]} text-white text-xs`,children:F[a.muscleGroup]||a.muscleGroup})]}),(0,b.jsx)(h.Button,{variant:"ghost",size:"icon",onClick:()=>{X(W.filter((a,b)=>b!==c))},children:(0,b.jsx)(w.Trash2,{className:"h-4 w-4 text-destructive"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-xs",children:"Séries"}),(0,b.jsx)(i.Input,{type:"number",value:a.series,onChange:a=>as(c,"series",parseInt(a.target.value)||0),className:"h-9"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-xs",children:"Répétitions"}),(0,b.jsx)(i.Input,{value:a.reps,onChange:a=>as(c,"reps",a.target.value),className:"h-9"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-xs",children:"Repos"}),(0,b.jsx)(i.Input,{value:a.rest,onChange:a=>as(c,"rest",a.target.value),className:"h-9"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-xs",children:"Notes (optionnel)"}),(0,b.jsx)(i.Input,{value:a.notes||"",onChange:a=>as(c,"notes",a.target.value),placeholder:"Notes pour cet exercice...",className:"h-9"})]})]},`${a.exerciseId||a.name}-${c}`))})})})]})}),(0,b.jsx)(m.TabsContent,{value:"notes",className:"flex-1 mt-4",children:(0,b.jsxs)(g.Card,{className:"h-full flex flex-col",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-2",children:[(0,b.jsx)(g.CardTitle,{children:"Notes et instructions"}),(0,b.jsx)(g.CardDescription,{children:"Ajoutez des notes en Markdown pour accompagner les exercices"})]}),(0,b.jsx)(g.CardContent,{className:"flex-1",children:(0,b.jsx)(k.Textarea,{value:Y,onChange:a=>Z(a.target.value),placeholder:"Rédigez des notes en Markdown...",className:"h-full min-h-[400px] resize-none font-mono text-sm"})})]})}),(0,b.jsx)(m.TabsContent,{value:"preview",className:"flex-1 mt-4",children:(0,b.jsxs)(g.Card,{className:"h-full overflow-auto",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Aperçu du programme"})}),(0,b.jsxs)(g.CardContent,{children:[W.length>0&&(0,b.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,b.jsx)(v.Dumbbell,{className:"h-5 w-5"})," ",W.length," Exercices"]}),(0,b.jsx)("div",{className:"space-y-2",children:W.map((a,c)=>(0,b.jsxs)("div",{className:"p-3 rounded-lg border flex items-center gap-4",children:[(0,b.jsx)(l.Badge,{children:c+1}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("span",{className:"font-medium",children:a.name}),(0,b.jsx)(l.Badge,{variant:"outline",className:"ml-2 text-xs",children:F[a.muscleGroup]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:[(0,b.jsx)(z.Repeat,{className:"h-3 w-3 inline mr-1"}),a.series,"×",a.reps]}),(0,b.jsxs)("span",{children:[(0,b.jsx)(y.Clock,{className:"h-3 w-3 inline mr-1"}),a.rest]})]})]},c))})]}),Y&&(0,b.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:(0,b.jsx)(C.default,{remarkPlugins:[D.default],children:Y})}),0===W.length&&!Y&&(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"Aucun contenu à afficher"})]})]})})]})]})}a.s(["default",()=>H],433673)}];

//# sourceMappingURL=app_dashboard_programs_%5Bid%5D_edit_page_tsx_65d2200f._.js.map