module.exports=[287300,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(278165),e=a.i(415925),f=a.i(703130),g=a.i(340695),h=a.i(965733),i=a.i(905094),j=a.i(205522),k=a.i(917171),l=a.i(915618),m=a.i(267900),n=a.i(660246),o=a.i(824569),p=a.i(781560);let q=(0,a.i(170106).default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var r=a.i(277687),s=a.i(254161),t=a.i(98687);function u(){let{user:a}=(0,d.useUser)(),[h,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(!0),[t,u]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),{toast:B}=(0,r.useToast)(),C=(0,e.useTranslations)("organizations");async function D(){try{let a=await fetch("/api/organizations");if(!a.ok)throw Error("Failed to fetch");let b=await a.json();j(b)}catch(a){B({title:"Erreur",description:"Impossible de charger les organisations",variant:"destructive"})}finally{l(!1)}}async function E(){if(z)try{if(!(await fetch(`/api/organizations/${z.id}`,{method:"DELETE"})).ok)throw Error("Failed to delete");B({title:"Succès",description:"Organisation supprimée avec succès"}),A(null),D()}catch(a){B({title:"Erreur",description:"Impossible de supprimer l'organisation",variant:"destructive"})}}return((0,e.useTranslations)("common"),(0,c.useEffect)(()=>{a?.role==="PRO"&&D()},[a]),a?.role!=="PRO")?(0,b.jsx)("div",{className:"container mx-auto p-6",children:(0,b.jsx)(f.Card,{children:(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:C("accessDenied")}),(0,b.jsx)(f.CardDescription,{children:C("accessDeniedDescription")})]})})}):(0,b.jsxs)("div",{className:"container mx-auto p-6",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:C("title")}),(0,b.jsx)("p",{className:"text-muted-foreground",children:C("subtitle")})]}),(0,b.jsx)(v,{open:t,onOpenChange:u,onSuccess:D})]}),k?(0,b.jsx)("div",{children:"Chargement..."}):(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[h.map(c=>{let d=c.accentColor||(c.logo?void 0:"#3b82f6");return(0,b.jsxs)(f.Card,{style:d?{borderColor:d,borderWidth:"2px"}:void 0,children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Building2,{className:"h-5 w-5"}),(0,b.jsx)(f.CardTitle,{children:c.name})]}),c.owner.id===a?.id&&(0,b.jsx)(s.Badge,{variant:"outline",children:C("owner")})]}),(0,b.jsxs)(f.CardDescription,{children:[C("owner"),": ",c.owner.name||c.owner.email]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(n.Users,{className:"h-4 w-4"}),c.members.length," ",C("member"),c.members.length>1?"s":""]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>window.location.href=`/dashboard/organizations/${c.id}`,children:[(0,b.jsx)(q,{className:"mr-2 h-4 w-4"}),C("manage")]}),c.owner.id===a?.id&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>y(c),children:[(0,b.jsx)(o.Edit,{className:"mr-2 h-4 w-4"}),C("edit")]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>A(c),children:[(0,b.jsx)(p.Trash2,{className:"mr-2 h-4 w-4"}),C("delete")]})]})]})]})})]},c.id)}),0===h.length&&(0,b.jsx)(f.Card,{children:(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:C("noOrganizations")}),(0,b.jsx)(f.CardDescription,{children:C("createFirst")})]})})]}),x&&(0,b.jsx)(w,{organization:x,onClose:()=>y(null),onSuccess:D}),(0,b.jsx)(i.AlertDialog,{open:!!z,onOpenChange:a=>!a&&A(null),children:(0,b.jsxs)(i.AlertDialogContent,{children:[(0,b.jsxs)(i.AlertDialogHeader,{children:[(0,b.jsx)(i.AlertDialogTitle,{children:"Supprimer l'organisation"}),(0,b.jsxs)(i.AlertDialogDescription,{children:['Êtes-vous sûr de vouloir supprimer "',z?.name,'" ? Cette action est irréversible.']})]}),(0,b.jsxs)(i.AlertDialogFooter,{children:[(0,b.jsx)(i.AlertDialogCancel,{children:"Annuler"}),(0,b.jsx)(i.AlertDialogAction,{onClick:E,children:"Supprimer"})]})]})})]})}function v({open:a,onOpenChange:d,onSuccess:e}){let[f,i]=(0,c.useState)(""),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("#3b82f6"),[q,s]=(0,c.useState)(!1),{toast:u}=(0,r.useToast)();async function v(a){let b=a.target.files?.[0];if(!b)return;if(b.size>2097152)return void u({title:"Erreur",description:"L'image ne doit pas dépasser 2MB",variant:"destructive"});if(!b.type.startsWith("image/"))return void u({title:"Erreur",description:"Le fichier doit être une image",variant:"destructive"});let c=new FileReader;c.onload=a=>{let b=a.target?.result,c=new Image;c.onload=()=>{let a=document.createElement("canvas");a.width=200,a.height=200;let b=a.getContext("2d");b&&(b.drawImage(c,0,0,200,200),n(a.toDataURL("image/png")))},c.src=b},c.readAsDataURL(b)}async function w(a){if(a.preventDefault(),f.trim()){s(!0);try{if(!(await fetch("/api/organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f,logo:m||null,accentColor:o||null})})).ok)throw Error("Failed to create");u({title:"Succès",description:"Organisation créée avec succès"}),i(""),n(""),p("#3b82f6"),d(!1),e()}catch(a){u({title:"Erreur",description:"Impossible de créer l'organisation",variant:"destructive"})}finally{s(!1)}}}return(0,b.jsxs)(h.Dialog,{open:a,onOpenChange:d,children:[(0,b.jsx)(h.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{children:[(0,b.jsx)(l.Plus,{className:"mr-2 h-4 w-4"}),"Créer une organisation"]})}),(0,b.jsxs)(h.DialogContent,{children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Créer une organisation"}),(0,b.jsx)(h.DialogDescription,{children:"Créez une nouvelle organisation pour regrouper des utilisateurs"})]}),(0,b.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{htmlFor:"name",children:"Nom"}),(0,b.jsx)(j.Input,{id:"name",value:f,onChange:a=>i(a.target.value),placeholder:"Nom de l'organisation",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{htmlFor:"logo",children:"Logo (optionnel)"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Input,{id:"logo-file",type:"file",accept:"image/*",onChange:v,className:"cursor-pointer"}),(0,t.getValidImageUrl)(m)&&(0,b.jsxs)("div",{className:"relative w-32 h-32 border rounded",children:[(0,b.jsx)("img",{src:(0,t.getValidImageUrl)(m),alt:"Logo preview",className:"w-full h-full object-contain rounded",onError:a=>{a.target.style.display="none"}}),(0,b.jsx)(g.Button,{type:"button",variant:"destructive",size:"sm",className:"absolute top-0 right-0",onClick:()=>n(""),children:"×"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{htmlFor:"accentColor",children:"Couleur d'accentuation"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Input,{id:"accentColor",type:"color",value:o,onChange:a=>p(a.target.value),className:"w-20 h-10"}),(0,b.jsx)(j.Input,{type:"text",value:o,onChange:a=>p(a.target.value),placeholder:"#3b82f6",pattern:"^#[0-9A-Fa-f]{6}$"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Annuler"}),(0,b.jsx)(g.Button,{type:"submit",disabled:q,children:"Créer"})]})]})]})]})}function w({organization:a,onClose:d,onSuccess:e}){let[f,i]=(0,c.useState)(a.name),[l,m]=(0,c.useState)(a.logo||""),[n,o]=(0,c.useState)(a.accentColor||"#3b82f6"),[p,q]=(0,c.useState)(!1),{toast:s}=(0,r.useToast)();async function u(a){let b=a.target.files?.[0];if(!b)return;if(b.size>2097152)return void s({title:"Erreur",description:"L'image ne doit pas dépasser 2MB",variant:"destructive"});if(!b.type.startsWith("image/"))return void s({title:"Erreur",description:"Le fichier doit être une image",variant:"destructive"});let c=new FileReader;c.onload=a=>{let b=a.target?.result,c=new Image;c.onload=()=>{let a=document.createElement("canvas");a.width=200,a.height=200;let b=a.getContext("2d");b&&(b.drawImage(c,0,0,200,200),m(a.toDataURL("image/png")))},c.src=b},c.readAsDataURL(b)}async function v(b){if(b.preventDefault(),f.trim()){q(!0);try{if(!(await fetch(`/api/organizations/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f,logo:l||null,accentColor:n||null})})).ok)throw Error("Failed to update");s({title:"Succès",description:"Organisation mise à jour avec succès"}),d(),e()}catch(a){s({title:"Erreur",description:"Impossible de mettre à jour l'organisation",variant:"destructive"})}finally{q(!1)}}}return(0,b.jsx)(h.Dialog,{open:!0,onOpenChange:a=>!a&&d(),children:(0,b.jsxs)(h.DialogContent,{children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Modifier l'organisation"}),(0,b.jsx)(h.DialogDescription,{children:"Mettez à jour les informations de l'organisation"})]}),(0,b.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{htmlFor:"name",children:"Nom"}),(0,b.jsx)(j.Input,{id:"name",value:f,onChange:a=>i(a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{htmlFor:"logo-edit",children:"Logo (optionnel)"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Input,{id:"logo-edit-file",type:"file",accept:"image/*",onChange:u,className:"cursor-pointer"}),(0,t.getValidImageUrl)(l)&&(0,b.jsxs)("div",{className:"relative w-32 h-32 border rounded",children:[(0,b.jsx)("img",{src:(0,t.getValidImageUrl)(l),alt:"Logo preview",className:"w-full h-full object-contain rounded",onError:a=>{a.target.style.display="none"}}),(0,b.jsx)(g.Button,{type:"button",variant:"destructive",size:"sm",className:"absolute top-0 right-0",onClick:()=>m(""),children:"×"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{htmlFor:"accentColor-edit",children:"Couleur d'accentuation"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Input,{id:"accentColor-edit",type:"color",value:n||"#3b82f6",onChange:a=>o(a.target.value),className:"w-20 h-10"}),(0,b.jsx)(j.Input,{type:"text",value:n||"#3b82f6",onChange:a=>o(a.target.value),placeholder:"#3b82f6",pattern:"^#[0-9A-Fa-f]{6}$"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:d,children:"Annuler"}),(0,b.jsx)(g.Button,{type:"submit",disabled:p,children:"Enregistrer"})]})]})]})})}a.s(["default",()=>u],287300)}];

//# sourceMappingURL=app_dashboard_organizations_page_tsx_f2196916._.js.map