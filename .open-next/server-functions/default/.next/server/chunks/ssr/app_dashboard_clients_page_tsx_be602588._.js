module.exports=[654098,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(278165),e=a.i(856696),f=a.i(892474),g=a.i(413902),h=a.i(703130),i=a.i(340695),j=a.i(254161),k=a.i(205522),l=a.i(965733),m=a.i(905094),n=a.i(887682),o=a.i(660246),p=a.i(915618),q=a.i(835181),r=a.i(564485),s=a.i(563588),t=a.i(587532),u=a.i(369012),v=a.i(104720),w=a.i(992258),x=a.i(783604),x=x,y=a.i(277687),z=a.i(50944),A=a.i(595129),B=a.i(514727),C=a.i(829108),D=a.i(46470);function E(){let{user:a}=(0,d.useUser)(),{activeOrganization:E,getAccentColor:F}=(0,e.useOrganization)(),{subscription:G}=(0,f.useSubscription)(),{theme:H}=(0,g.useTheme)(),I=(0,z.useRouter)(),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)(!0),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)("all"),[V,W]=(0,c.useState)("all"),[X,Y]=(0,c.useState)(!1),[Z,$]=(0,c.useState)("SPORT"),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)("SPORT"),[af,ag]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(!1),{toast:aj}=(0,y.useToast)(),ak="dark"===H,al=F(ak),am=G&&("TRIAL"===G.status||"ACTIVE"===G.status);async function an(){try{let[b,c]=await Promise.all([fetch("/api/organizations"),fetch(`/api/programs${E?`?organizationId=${E.id}`:""}`)]);if(!b.ok||!c.ok)throw Error("Failed to fetch");let d=await b.json(),e=await c.json();K(d),M(e);let f=new Map;d.forEach(b=>{b.members.forEach(c=>{let d=c.user;d.id===a?.id||"USER"!==d.role||f.has(d.id)||f.set(d.id,{id:d.id,name:d.name,email:d.email,programs:[],organization:b})})}),e.forEach(a=>{if(a.user){let b=f.get(a.user.id);b&&b.programs.push(a)}}),O(Array.from(f.values()))}catch(a){aj({title:"Erreur",description:"Impossible de charger les données",variant:"destructive"})}finally{Q(!1)}}(0,c.useEffect)(()=>{localStorage.getItem("hasSeenExportAlert")||a?.role!=="PRO"||(ai(!0),localStorage.setItem("hasSeenExportAlert","true"))},[a]),(0,c.useEffect)(()=>{a?.role==="PRO"&&an()},[a,E]);let ao=N.filter(a=>{let b=a.name?.toLowerCase().includes(R.toLowerCase())||a.email.toLowerCase().includes(R.toLowerCase()),c="all"===V||a.organization?.id===V;if("all"===T)return b&&c;let d=a.programs.some(a=>a.type===T);return b&&c&&d});async function ap(a){ag(a);try{let b=await fetch("/api/chats/direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to create chat")}let c=await b.json();I.push(`/dashboard/messaging?chatId=${c.id}`)}catch(a){aj({title:"Erreur",description:a instanceof Error?a.message:"Impossible de créer la conversation",variant:"destructive"})}finally{ag(null)}}if(a?.role!=="PRO")return(0,b.jsx)("div",{className:"container mx-auto p-6",children:(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardHeader,{children:[(0,b.jsx)(h.CardTitle,{children:"Accès refusé"}),(0,b.jsx)(h.CardDescription,{children:"Cette page est réservée aux professionnels."})]})})});let aq=N.length,ar=L.length,as=L.filter(a=>"SPORT"===a.type).length,at=L.filter(a=>"NUTRITION"===a.type).length;return(0,b.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,b.jsx)(m.AlertDialog,{open:ah,onOpenChange:ai,children:(0,b.jsxs)(m.AlertDialogContent,{children:[(0,b.jsxs)(m.AlertDialogHeader,{children:[(0,b.jsxs)(m.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(x.default,{className:"h-5 w-5 text-yellow-500"}),"Restrictions d'exportation"]}),(0,b.jsxs)(m.AlertDialogDescription,{className:"space-y-2",children:[(0,b.jsxs)("p",{children:["En tant que professionnel, vous n'avez ",(0,b.jsx)("strong",{children:"pas le droit"})," d'exporter ou d'externaliser les contacts de vos clients en dehors de la plateforme Atletia."]}),(0,b.jsx)("p",{children:"Cette restriction est en place pour protéger la confidentialité et la sécurité des données de vos clients, conformément au RGPD et à nos conditions d'utilisation."}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Toute violation de cette règle peut entraîner la suspension de votre compte professionnel."})]})]}),(0,b.jsx)(m.AlertDialogFooter,{children:(0,b.jsx)(m.AlertDialogAction,{onClick:()=>ai(!1),children:"J'ai compris"})})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(B.SidebarTrigger,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",style:{color:al},children:"Gestion des Clients"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gérez vos clients et leurs programmes personnalisés"})]})]}),am?(0,b.jsxs)(l.Dialog,{open:X,onOpenChange:Y,children:[(0,b.jsx)(l.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(i.Button,{style:{backgroundColor:al,color:ak?"#020617":"#f8fafc"},children:[(0,b.jsx)(p.Plus,{className:"mr-2 h-4 w-4"}),"Créer un programme"]})}),(0,b.jsxs)(l.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsx)(l.DialogTitle,{children:"Créer un nouveau programme"}),(0,b.jsx)(l.DialogDescription,{children:"Générez un programme sportif ou nutritionnel personnalisé pour votre client"})]}),(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)(n.Select,{value:Z,onValueChange:a=>$(a),children:[(0,b.jsx)(n.SelectTrigger,{children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"SPORT",children:"Programme Sportif"}),(0,b.jsx)(n.SelectItem,{value:"NUTRITION",children:"Programme Nutritionnel"})]})]})}),(0,b.jsx)(C.ProgramGeneratorForm,{open:X,onOpenChange:Y,type:Z,onSuccess:()=>{Y(!1),an()}})]})]}):(0,b.jsxs)(i.Button,{disabled:!0,variant:"outline",onClick:()=>{I.push("/dashboard/subscription")},title:"Un abonnement actif est requis pour créer des programmes",children:[(0,b.jsx)(p.Plus,{className:"mr-2 h-4 w-4"}),"Créer un programme"]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"Total Clients"}),(0,b.jsx)(o.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:aq}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ao.length," affichés"]})]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"Total Programmes"}),(0,b.jsx)(v.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:ar}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Tous types confondus"})]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"Programmes Sport"}),(0,b.jsx)(q.Dumbbell,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:as}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ar>0?Math.round(as/ar*100):0,"% du total"]})]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"Programmes Nutrition"}),(0,b.jsx)(r.Apple,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:at}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ar>0?Math.round(at/ar*100):0,"% du total"]})]})]})]}),(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(t.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(k.Input,{placeholder:"Rechercher un client par nom ou email...",value:R,onChange:a=>S(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(n.Select,{value:T,onValueChange:a=>U(a),children:[(0,b.jsxs)(n.SelectTrigger,{className:"w-full md:w-[180px]",children:[(0,b.jsx)(u.Filter,{className:"mr-2 h-4 w-4"}),(0,b.jsx)(n.SelectValue,{placeholder:"Type de programme"})]}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"all",children:"Tous les types"}),(0,b.jsx)(n.SelectItem,{value:"SPORT",children:"Sport uniquement"}),(0,b.jsx)(n.SelectItem,{value:"NUTRITION",children:"Nutrition uniquement"})]})]}),(0,b.jsxs)(n.Select,{value:V,onValueChange:W,children:[(0,b.jsx)(n.SelectTrigger,{className:"w-full md:w-[200px]",children:(0,b.jsx)(n.SelectValue,{placeholder:"Organisation"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"all",children:"Toutes les organisations"}),J.map(a=>(0,b.jsx)(n.SelectItem,{value:a.id,children:a.name},a.id))]})]})]})})}),P?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})}):0===ao.length?(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(o.Users,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Aucun client trouvé"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:R||"all"!==V||"all"!==T?"Aucun client ne correspond à vos critères de recherche.":"Vos clients apparaîtront ici une fois qu'ils rejoindront vos organisations."})]})})}):(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:ao.map(a=>{let c=a.organization,d=c?.accentColor||al;return(0,b.jsxs)(h.Card,{className:"hover:shadow-lg transition-shadow",style:{borderLeft:`4px solid ${d}`},children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold",style:{backgroundColor:d},children:a.name?a.name.charAt(0).toUpperCase():a.email.charAt(0).toUpperCase()}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.CardTitle,{className:"text-lg",children:a.name||a.email.split("@")[0]}),(0,b.jsxs)(h.CardDescription,{className:"flex items-center gap-1 mt-1",children:[(0,b.jsx)(w.Mail,{className:"h-3 w-3"}),a.email]})]})]}),c&&(0,b.jsx)(j.Badge,{variant:"outline",className:"text-xs",children:c.name})]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Programmes:"}),(0,b.jsx)("span",{className:"font-semibold",children:a.programs.length})]}),(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsxs)(j.Badge,{variant:"outline",className:"text-xs",children:[(0,b.jsx)(q.Dumbbell,{className:"h-3 w-3 mr-1"}),a.programs.filter(a=>"SPORT"===a.type).length]}),(0,b.jsxs)(j.Badge,{variant:"outline",className:"text-xs",children:[(0,b.jsx)(r.Apple,{className:"h-3 w-3 mr-1"}),a.programs.filter(a=>"NUTRITION"===a.type).length]})]})]}),a.programs.length>0&&(0,b.jsx)(D.ScrollArea,{className:"h-32",children:(0,b.jsxs)("div",{className:"space-y-2",children:[a.programs.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 hover:bg-muted transition-colors cursor-pointer",onClick:()=>I.push(`/dashboard/programs/${a.id}`),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:["SPORT"===a.type?(0,b.jsx)(q.Dumbbell,{className:"h-4 w-4 flex-shrink-0",style:{color:d}}):(0,b.jsx)(r.Apple,{className:"h-4 w-4 flex-shrink-0",style:{color:d}}),(0,b.jsx)("span",{className:"text-sm font-medium truncate",children:a.name})]}),(0,b.jsx)(j.Badge,{variant:"outline",className:"text-xs ml-2",children:a.type})]},a.id)),a.programs.length>3&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground text-center pt-1",children:["+",a.programs.length-3," autre",a.programs.length-3>1?"s":""]})]})}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 pt-2 border-t",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>{ac(a.id),ae("SPORT"),aa(!0)},className:"text-xs",children:[(0,b.jsx)(q.Dumbbell,{className:"mr-1 h-3 w-3"}),"Sport"]}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>{ac(a.id),ae("NUTRITION"),aa(!0)},className:"text-xs",children:[(0,b.jsx)(r.Apple,{className:"mr-1 h-3 w-3"}),"Nutrition"]})]}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>ap(a.id),disabled:af===a.id,className:"w-full",style:{borderColor:d,color:d},children:[(0,b.jsx)(s.MessageSquare,{className:"mr-2 h-4 w-4"}),af===a.id?"Création...":"Envoyer un message"]})]})]})]},a.id)})}),ab&&(0,b.jsx)(A.UserProfileForm,{open:_,onOpenChange:a=>{aa(a),a||ac(null)},userId:ab,type:ad,onSuccess:()=>{an()}})]})}a.s(["default",()=>E],654098)}];

//# sourceMappingURL=app_dashboard_clients_page_tsx_be602588._.js.map