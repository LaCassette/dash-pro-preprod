module.exports=[830240,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={MutableRequestCookiesAdapter:function(){return p},ReadonlyRequestCookiesError:function(){return c},RequestCookiesAdapter:function(){return u},appendMutableCookies:function(){return h},areCookiesMutableInCurrentPhase:function(){return y},createCookiesWithMutableAccessCheck:function(){return f},getModifiedCookieValues:function(){return d},responseCookiesToRequestCookies:function(){return w}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let i=e.r(365716),s=e.r(130759),o=e.r(556704);class c extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new c}}class u{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return c.callable;default:return s.ReflectAdapter.get(e,t,r)}}})}}let l=Symbol.for("next.mutated.cookies");function d(e){let t=e[l];return t&&Array.isArray(t)&&0!==t.length?t:[]}function h(e,t){let r=d(t);if(0===r.length)return!1;let n=new i.ResponseCookies(e),a=n.getAll();for(let e of r)n.set(e);for(let e of a)n.set(e);return!0}class p{static wrap(e,t){let r=new i.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let n=[],a=new Set,c=()=>{let e=o.workAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),n=r.getAll().filter(e=>a.has(e.name)),t){let e=[];for(let t of n){let r=new i.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}},u=new Proxy(r,{get(e,t,r){switch(t){case l:return n;case"delete":return function(...t){a.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.delete(...t),u}finally{c()}};case"set":return function(...t){a.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t),u}finally{c()}};default:return s.ReflectAdapter.get(e,t,r)}}});return u}}function f(e){let t=new Proxy(e.mutableCookies,{get(r,n,a){switch(n){case"delete":return function(...n){return m(e,"cookies().delete"),r.delete(...n),t};case"set":return function(...n){return m(e,"cookies().set"),r.set(...n),t};default:return s.ReflectAdapter.get(r,n,a)}}});return t}function y(e){return"action"===e.phase}function m(e,t){if(!y(e))throw new c}function w(e){let t=new i.RequestCookies(new Headers);for(let r of e.getAll())t.set(r);return t}},213884,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return c}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(e.r(347540));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}let i={current:null},s="function"==typeof n.cache?n.cache:e=>e,o=console.warn;function c(e){return function(...t){o(e(...t))}}s(e=>{try{o(i.current)}finally{i.current=null}})},307460,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cookies",{enumerable:!0,get:function(){return p}});let n=e.r(830240),a=e.r(365716),i=e.r(556704),s=e.r(832319),o=e.r(868665),c=e.r(97573),u=e.r(204642),l=e.r(213884),d=e.r(543824),h=e.r(276414);function p(){let e="cookies",t=i.workAsyncStorage.getStore(),r=s.workUnitAsyncStorage.getStore();if(t){if(r&&"after"===r.phase&&!(0,d.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`cookies()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E843",enumerable:!1,configurable:!0});if(t.forceStatic)return y(n.RequestCookiesAdapter.seal(new a.RequestCookies(new Headers({}))));if(t.dynamicShouldError)throw Object.defineProperty(new c.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E849",enumerable:!1,configurable:!0});if(r)switch(r.type){case"cache":let i=Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E831",enumerable:!1,configurable:!0});throw Error.captureStackTrace(i,p),t.invalidDynamicUsageError??=i,i;case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E846",enumerable:!1,configurable:!0});case"prerender":var l=t,m=r;let s=f.get(m);if(s)return s;let w=(0,u.makeHangingPromise)(m.renderSignal,l.route,"`cookies()`");return f.set(m,w),w;case"prerender-client":let g="`cookies`";throw Object.defineProperty(new h.InvariantError(`${g} must not be used within a Client Component. Next.js should be preventing ${g} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,o.postponeWithTracking)(t.route,e,r.dynamicTracking);case"prerender-legacy":return(0,o.throwToInterruptStaticGeneration)(e,t,r);case"prerender-runtime":return(0,o.delayUntilRuntimeStage)(r,y(r.cookies));case"private-cache":return y(r.cookies);case"request":return(0,o.trackDynamicDataInDynamicRender)(r),y((0,n.areCookiesMutableInCurrentPhase)(r)?r.userspaceMutableCookies:r.cookies)}}(0,s.throwForMissingRequestStore)(e)}e.r(518185);let f=new WeakMap;function y(e){let t=f.get(e);if(t)return t;let r=Promise.resolve(e);return f.set(e,r),r}(0,l.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E830",enumerable:!1,configurable:!0})})},536052,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={HeadersAdapter:function(){return o},ReadonlyHeadersError:function(){return s}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let i=e.r(130759);class s extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new s}}class o extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,n){if("symbol"==typeof r)return i.ReflectAdapter.get(t,r,n);let a=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===a);if(void 0!==s)return i.ReflectAdapter.get(t,s,n)},set(t,r,n,a){if("symbol"==typeof r)return i.ReflectAdapter.set(t,r,n,a);let s=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===s);return i.ReflectAdapter.set(t,o??r,n,a)},has(t,r){if("symbol"==typeof r)return i.ReflectAdapter.has(t,r);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0!==a&&i.ReflectAdapter.has(t,a)},deleteProperty(t,r){if("symbol"==typeof r)return i.ReflectAdapter.deleteProperty(t,r);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0===a||i.ReflectAdapter.deleteProperty(t,a)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return s.callable;default:return i.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new o(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},719971,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"headers",{enumerable:!0,get:function(){return h}});let n=e.r(536052),a=e.r(556704),i=e.r(832319),s=e.r(868665),o=e.r(97573),c=e.r(204642),u=e.r(213884),l=e.r(543824),d=e.r(276414);function h(){let e="headers",t=a.workAsyncStorage.getStore(),r=i.workUnitAsyncStorage.getStore();if(t){if(r&&"after"===r.phase&&!(0,l.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`headers()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E839",enumerable:!1,configurable:!0});if(t.forceStatic)return f(n.HeadersAdapter.seal(new Headers({})));if(r)switch(r.type){case"cache":{let e=Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E833",enumerable:!1,configurable:!0});throw Error.captureStackTrace(e,h),t.invalidDynamicUsageError??=e,e}case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E838",enumerable:!1,configurable:!0})}if(t.dynamicShouldError)throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`headers()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E828",enumerable:!1,configurable:!0});if(r)switch(r.type){case"prerender":var u=t,y=r;let a=p.get(y);if(a)return a;let i=(0,c.makeHangingPromise)(y.renderSignal,u.route,"`headers()`");return p.set(y,i),i;case"prerender-client":let m="`headers`";throw Object.defineProperty(new d.InvariantError(`${m} must not be used within a client component. Next.js should be preventing ${m} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,s.postponeWithTracking)(t.route,e,r.dynamicTracking);case"prerender-legacy":return(0,s.throwToInterruptStaticGeneration)(e,t,r);case"prerender-runtime":return(0,s.delayUntilRuntimeStage)(r,f(r.headers));case"private-cache":return f(r.headers);case"request":return(0,s.trackDynamicDataInDynamicRender)(r),f(r.headers)}}(0,i.throwForMissingRequestStore)(e)}e.r(518185);let p=new WeakMap;function f(e){let t=p.get(e);if(t)return t;let r=Promise.resolve(e);return p.set(e,r),r}(0,u.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`headers()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E836",enumerable:!1,configurable:!0})})},721423,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"draftMode",{enumerable:!0,get:function(){return l}});let n=e.r(832319),a=e.r(556704),i=e.r(868665),s=e.r(213884),o=e.r(97573),c=e.r(865252),u=e.r(276414);function l(){let e=a.workAsyncStorage.getStore(),t=n.workUnitAsyncStorage.getStore();switch((!e||!t)&&(0,n.throwForMissingRequestStore)("draftMode"),t.type){case"prerender-runtime":return(0,i.delayUntilRuntimeStage)(t,d(t.draftMode,e));case"request":return d(t.draftMode,e);case"cache":case"private-cache":case"unstable-cache":let r=(0,n.getDraftModeProviderForCacheScope)(e,t);if(r)return d(r,e);case"prerender":case"prerender-client":case"prerender-ppr":case"prerender-legacy":return d(null,e);default:return t}}function d(e,t){let r=p.get(e??h);return r||Promise.resolve(new f(e))}e.r(130759);let h={},p=new WeakMap;class f{constructor(e){this._provider=e}get isEnabled(){return null!==this._provider&&this._provider.isEnabled}enable(){y("draftMode().enable()",this.enable),null!==this._provider&&this._provider.enable()}disable(){y("draftMode().disable()",this.disable),null!==this._provider&&this._provider.disable()}}function y(e,t){let r=a.workAsyncStorage.getStore(),s=n.workUnitAsyncStorage.getStore();if(r){if((null==s?void 0:s.phase)==="after")throw Object.defineProperty(Error(`Route ${r.route} used "${e}" inside \`after()\`. The enabled status of \`draftMode()\` can be read inside \`after()\` but you cannot enable or disable \`draftMode()\`. See more info here: https://nextjs.org/docs/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E845",enumerable:!1,configurable:!0});if(r.dynamicShouldError)throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${r.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E553",enumerable:!1,configurable:!0});if(s)switch(s.type){case"cache":case"private-cache":{let n=Object.defineProperty(Error(`Route ${r.route} used "${e}" inside "use cache". The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E829",enumerable:!1,configurable:!0});throw Error.captureStackTrace(n,t),r.invalidDynamicUsageError??=n,n}case"unstable-cache":throw Object.defineProperty(Error(`Route ${r.route} used "${e}" inside a function cached with \`unstable_cache()\`. The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E844",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":{let t=Object.defineProperty(Error(`Route ${r.route} used ${e} without first calling \`await connection()\`. See more info here: https://nextjs.org/docs/messages/next-prerender-sync-headers`),"__NEXT_ERROR_CODE",{value:"E126",enumerable:!1,configurable:!0});return(0,i.abortAndThrowOnSynchronousRequestDataAccess)(r.route,e,t,s)}case"prerender-client":let n="`draftMode`";throw Object.defineProperty(new u.InvariantError(`${n} must not be used within a Client Component. Next.js should be preventing ${n} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,i.postponeWithTracking)(r.route,e,s.dynamicTracking);case"prerender-legacy":s.revalidate=0;let a=Object.defineProperty(new c.DynamicServerError(`Route ${r.route} couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw r.dynamicUsageDescription=e,r.dynamicUsageStack=a.stack,a;case"request":(0,i.trackDynamicDataInDynamicRender)(s)}}}(0,s.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`draftMode()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E835",enumerable:!1,configurable:!0})})},493458,(e,t,r)=>{t.exports.cookies=e.r(307460).cookies,t.exports.headers=e.r(719971).headers,t.exports.draftMode=e.r(721423).draftMode},453321,e=>{"use strict";let t,r,n,a,i,s,o,c,u,l;var d,h,p,f,y,m,w,g,S,b,A,E,k,_,v,T,P,C,R,O=e.i(493458),x=e.i(89171);class I extends Error{}class D extends I{constructor({code:e,message:t}){super(t??"An error occurred while interacting with the authorization server."),this.name="OAuth2Error",this.code=e}}class H extends I{constructor(e){super(e??"Discovery failed for the OpenID Connect configuration."),this.code="discovery_error",this.name="DiscoveryError"}}class K extends I{constructor(e){super(e??"The state parameter is missing."),this.code="missing_state",this.name="MissingStateError"}}class U extends I{constructor(e){super(e??"The state parameter is invalid."),this.code="invalid_state",this.name="InvalidStateError"}}class N extends I{constructor(e){super(e??"The configuration is invalid."),this.code="invalid_configuration",this.name="InvalidConfigurationError"}}class M extends I{constructor({cause:e,message:t}){super(t??"An error occurred during the authorization flow."),this.code="authorization_error",this.cause=e,this.name="AuthorizationError"}}class j extends I{constructor(e){super(e??"An error occurred while preparing or performing the authorization code grant request."),this.code="authorization_code_grant_request_error",this.name="AuthorizationCodeGrantRequestError"}}class W extends I{constructor({cause:e,message:t}){super(t??"An error occurred while trying to exchange the authorization code."),this.code="authorization_code_grant_error",this.cause=e,this.name="AuthorizationCodeGrantError"}}class L extends I{constructor(e){super(e??"An error occurred while completing the backchannel logout request."),this.code="backchannel_logout_error",this.name="BackchannelLogoutError"}}class $ extends I{constructor(){super("The authorization server does not support backchannel authentication. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-client-initiated-backchannel-authentication"),this.code="backchannel_authentication_not_supported_error",this.name="BackchannelAuthenticationNotSupportedError"}}class J extends I{constructor({cause:e}){super("There was an error when trying to use Client-Initiated Backchannel Authentication."),this.code="backchannel_authentication_error",this.cause=e,this.name="BackchannelAuthenticationError"}}(d=w||(w={})).MISSING_SESSION="missing_session",d.MISSING_REFRESH_TOKEN="missing_refresh_token",d.FAILED_TO_REFRESH_TOKEN="failed_to_refresh_token";class q extends I{constructor(e,t,r){super(t),this.name="AccessTokenError",this.code=e,this.cause=r}}(h=g||(g={})).MISSING_SESSION="missing_session",h.MISSING_REFRESH_TOKEN="missing_refresh_token",h.FAILED_TO_EXCHANGE="failed_to_exchange_refresh_token";class z extends I{constructor(e,t,r){super(t),this.name="AccessTokenForConnectionError",this.code=e,this.cause=r}}(p=S||(S={})).DPOP_JKT_CALCULATION_FAILED="dpop_jkt_calculation_failed",p.DPOP_KEY_EXPORT_FAILED="dpop_key_export_failed",p.DPOP_CONFIGURATION_ERROR="dpop_configuration_error";class B extends I{constructor(e,t,r){super(t),this.name="DPoPError",this.code=e,this.cause=r}}class F extends I{constructor({type:e,title:t,detail:r,status:n,validationErrors:a}){super(`${t}: ${r}`),this.name="MyAccountApiError",this.code="my_account_api_error",this.type=e,this.title=t,this.detail=r,this.status=n,this.validationErrors=a}}(f=b||(b={})).MISSING_SESSION="missing_session",f.FAILED_TO_INITIATE="failed_to_initiate",f.FAILED_TO_COMPLETE="failed_to_complete";class G extends I{constructor({code:e,message:t,cause:r}){super(t),this.name="ConnectAccountError",this.code=e,this.cause=r}}let V="openid profile email offline_access";var X=e.i(254799);function Y(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(t="oauth4webapi/v3.8.2");let Z="ERR_INVALID_ARG_VALUE",Q="ERR_INVALID_ARG_TYPE";function ee(e,t,r){let n=TypeError(e,{cause:r});return Object.assign(n,{code:t}),n}let et=Symbol(),er=Symbol(),en=Symbol(),ea=Symbol(),ei=Symbol(),es=Symbol();Symbol();let eo=new TextEncoder,ec=new TextDecoder;function eu(e){return"string"==typeof e?eo.encode(e):ec.decode(e)}function el(e){return"string"==typeof e?n(e):r(e)}r=Uint8Array.prototype.toBase64?e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},n=Uint8Array.fromBase64?e=>{try{return Uint8Array.fromBase64(e,{alphabet:"base64url"})}catch(e){throw ee("The input to be decoded is not correctly encoded.",Z,e)}}:e=>{try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw ee("The input to be decoded is not correctly encoded.",Z,e)}};class ed extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tb,Error.captureStackTrace?.(this,this.constructor)}}class eh extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,t?.code&&(this.code=t?.code),Error.captureStackTrace?.(this,this.constructor)}}function ep(e,t,r){return new eh(e,{code:t,cause:r})}async function ef(e){let t;switch(e.kty){case"EC":t={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":t={crv:e.crv,kty:e.kty,x:e.x};break;case"AKP":t={alg:e.alg,kty:e.kty,pub:e.pub};break;case"RSA":t={e:e.e,kty:e.kty,n:e.n};break;default:throw new ed("unsupported JWK key type",{cause:e})}return el(await crypto.subtle.digest("SHA-256",eu(JSON.stringify(t))))}function ey(e,t){if(!(e instanceof CryptoKey))throw ee(`${t} must be a CryptoKey`,Q)}function em(e,t){if(ey(e,t),"private"!==e.type)throw ee(`${t} must be a private CryptoKey`,Z)}function ew(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function eg(e){Y(e,Headers)&&(e=Object.fromEntries(e.entries()));let r=new Headers(e??{});if(t&&!r.has("user-agent")&&r.set("user-agent",t),r.has("authorization"))throw ee('"options.headers" must not include the "authorization" header name',Z);return r}function eS(e,t){if(void 0!==t){if("function"==typeof t&&(t=t(e.href)),!(t instanceof AbortSignal))throw ee('"options.signal" must return or be an instance of AbortSignal',Q);return t}}function eb(e){return e.includes("//")?e.replace("//","/"):e}async function eA(e,t,r,n){if(!(e instanceof URL))throw ee(`"${t}" must be an instance of URL`,Q);eW(e,n?.[et]!==!0);let a=r(new URL(e.href)),i=eg(n?.headers);return i.set("accept","application/json"),(n?.[ea]||fetch)(a.href,{body:void 0,headers:Object.fromEntries(i.entries()),method:"GET",redirect:"manual",signal:eS(a,n?.signal)})}async function eE(e,t){return eA(e,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":e.pathname=eb(`${e.pathname}/.well-known/openid-configuration`);break;case"oauth2":!function(e,t,r=!1){"/"===e.pathname?e.pathname=t:e.pathname=eb(`${t}/${r?e.pathname:e.pathname.replace(/(\/)$/,"")}`)}(e,".well-known/oauth-authorization-server");break;default:throw ee('"options.algorithm" must be "oidc" (default), or "oauth2"',Z)}return e},t)}function ek(e,t,r,n,a){try{if("number"!=typeof e||!Number.isFinite(e))throw ee(`${r} must be a number`,Q,a);if(e>0)return;if(t){if(0!==e)throw ee(`${r} must be a non-negative number`,Z,a);return}throw ee(`${r} must be a positive number`,Z,a)}catch(e){if(n)throw ep(e.message,n,a);throw e}}function e_(e,t,r,n){try{if("string"!=typeof e)throw ee(`${t} must be a string`,Q,n);if(0===e.length)throw ee(`${t} must not be empty`,Z,n)}catch(e){if(r)throw ep(e.message,r,n);throw e}}async function ev(e,t){if(!(e instanceof URL)&&e!==tF)throw ee('"expectedIssuerIdentifier" must be an instance of URL',Q);if(!Y(t,Response))throw ee('"response" must be an instance of Response',Q);if(200!==t.status)throw ep('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',tv,t);tK(t);let r=await tB(t);if(e_(r.issuer,'"response" body "issuer" property',tk,{body:r}),e!==tF&&new URL(r.issuer).href!==e.href)throw ep('"response" body "issuer" property does not match the expected value',tO,{expected:e.href,body:r,attribute:"issuer"});return r}function eT(e){var t,r=e,n="application/json";if(t=r,t.headers.get("content-type")?.split(";")[0]!==n)throw function(e,...t){let r='"response" content-type must be ';if(t.length>2){let e=t.pop();r+=`${t.join(", ")}, or ${e}`}else 2===t.length?r+=`${t[0]} or ${t[1]}`:r+=t[0];return ep(r,t_,e)}(r,n)}function eP(){return el(crypto.getRandomValues(new Uint8Array(32)))}async function eC(e){return e_(e,"codeVerifier"),el(await crypto.subtle.digest("SHA-256",eu(e)))}function eR(e){switch(e.algorithm.name){case"RSA-PSS":switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new ed("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new ed("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"ECDSA":switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new ed("unsupported EcKeyAlgorithm namedCurve",{cause:e})}case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e.algorithm.name;case"EdDSA":return"Ed25519";default:throw new ed("unsupported CryptoKey algorithm name",{cause:e})}}function eO(e){let t=e?.[er];return"number"==typeof t&&Number.isFinite(t)?t:0}function ex(e){let t=e?.[en];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function eI(){return Math.floor(Date.now()/1e3)}function eD(e){if("object"!=typeof e||null===e)throw ee('"as" must be an object',Q);e_(e.issuer,'"as.issuer"')}function eH(e){if("object"!=typeof e||null===e)throw ee('"client" must be an object',Q);e_(e.client_id,'"client.client_id"')}function eK(e){return e_(e,'"clientSecret"'),(t,r,n,a)=>{n.set("client_id",r.client_id),n.set("client_secret",e)}}async function eU(e,t,r){if(!r.usages.includes("sign"))throw ee('CryptoKey instances used for signing assertions must include "sign" in their "usages"',Z);let n=`${el(eu(JSON.stringify(e)))}.${el(eu(JSON.stringify(t)))}`,a=el(await crypto.subtle.sign(function(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){let{algorithm:t}=e;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new ed("unsupported ECDSA namedCurve",{cause:e})}}(e)};case"RSA-PSS":switch(tU(e),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new ed("unsupported RSA-PSS hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":return tU(e),e.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return e.algorithm.name}throw new ed("unsupported CryptoKey algorithm name",{cause:e})}(r),r,eu(n)));return`${n}.${a}`}async function eN(e,t){let{kty:r,e:n,n:i,x:s,y:o,crv:c,pub:u}=await crypto.subtle.exportKey("jwk",e),l={kty:r,e:n,n:i,x:s,y:o,crv:c,pub:u};return"AKP"===r&&(l.alg=t),a.set(e,l),l}async function eM(e,t){return(a||=new WeakMap).get(e)||eN(e,t)}let ej=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch{return null}};function eW(e,t){if(t&&"https:"!==e.protocol)throw ep("only requests to HTTPS are allowed",tT,e);if("https:"!==e.protocol&&"http:"!==e.protocol)throw ep("only HTTP and HTTPS requests are allowed",tP,e)}function eL(e,t,r,n){let a;if("string"!=typeof e||!(a=ej(e)))throw ep(`authorization server metadata does not contain a valid ${r?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,void 0===e?tx:tI,{attribute:r?`mtls_endpoint_aliases.${t}`:t});return eW(a,n),a}function e$(e,t,r,n){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?eL(e.mtls_endpoint_aliases[t],t,r,n):eL(e[t],t,r,n)}async function eJ(e,t,r,n,a){eD(e),eH(t);let i=e$(e,"pushed_authorization_request_endpoint",t.use_mtls_endpoint_aliases,a?.[et]!==!0),s=new URLSearchParams(n);s.set("client_id",t.client_id);let o=eg(a?.headers);o.set("accept","application/json"),a?.DPoP!==void 0&&(e8(a.DPoP),await a.DPoP.addProof(i,o,"POST"));let c=await e3(e,t,r,i,s,o,a);return a?.DPoP?.cacheNonce(c,i),c}class eq{#e;#t;#r;#n;#a;#i;#s;constructor(e,t,r){if(em(t?.privateKey,'"DPoP.privateKey"'),!function(e,t){if(ey(e,t),"public"!==e.type)throw ee(`${t} must be a public CryptoKey`,Z)}(t?.publicKey,'"DPoP.publicKey"'),!t.publicKey.extractable)throw ee('"DPoP.publicKey.extractable" must be true',Z);this.#a=r?.[ei],this.#n=eO(e),this.#t=t.privateKey,this.#r=t.publicKey,tc.add(this)}#o(e){this.#i||=new Map;let t=this.#i.get(e);return t&&(this.#i.delete(e),this.#i.set(e,t)),t}#c(e,t){this.#i||=new Map,this.#i.delete(e),100===this.#i.size&&this.#i.delete(this.#i.keys().next().value),this.#i.set(e,t)}async calculateThumbprint(){if(!this.#s){let e=await crypto.subtle.exportKey("jwk",this.#r);this.#s||=await ef(e)}return this.#s}async addProof(e,t,r,n){let a=eR(this.#t);this.#e||={alg:a,typ:"dpop+jwt",jwk:await eM(this.#r,a)};let i=this.#o(e.origin),s={iat:eI()+this.#n,jti:eP(),htm:r,nonce:i,htu:`${e.origin}${e.pathname}`,ath:n?el(await crypto.subtle.digest("SHA-256",eu(n))):void 0};this.#a?.(this.#e,s),t.set("dpop",await eU(this.#e,s,this.#t))}cacheNonce(e,t){try{let r=e.headers.get("dpop-nonce");r&&this.#c(t.origin,r)}catch{}}}function ez(e){if(e instanceof eV){let{0:t,length:r}=e.cause;return 1===r&&"dpop"===t.scheme&&"use_dpop_nonce"===t.parameters.error}return e instanceof eF&&"use_dpop_nonce"===e.error}function eB(e,t,r){return new eq(e,t,r)}class eF extends Error{cause;code;error;status;error_description;response;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tS,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),Error.captureStackTrace?.(this,this.constructor)}}class eG extends Error{cause;code;error;error_description;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tA,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=t.cause.get("error_description")??void 0,Error.captureStackTrace?.(this,this.constructor)}}class eV extends Error{cause;code;response;status;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tg,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),Error.captureStackTrace?.(this,this.constructor)}}let eX="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",eY=RegExp("^[,\\s]*("+eX+")\\s(.*)"),eZ=RegExp("^[,\\s]*("+eX+')\\s*=\\s*"((?:[^"\\\\]|\\\\.)*)"[,\\s]*(.*)'),eQ=RegExp("^[,\\s]*"+("("+eX+")\\s*=\\s*(")+eX+")[,\\s]*(.*)"),e0=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+[=]{0,2})(?:$|[,\\s])(.*)");async function e1(e,t,r){if(eD(e),eH(t),!Y(r,Response))throw ee('"response" must be an instance of Response',Q);await e5(r,201,"Pushed Authorization Request Endpoint"),tK(r);let n=await tB(r);e_(n.request_uri,'"response" body "request_uri" property',tk,{body:n});let a="number"!=typeof n.expires_in?parseFloat(n.expires_in):n.expires_in;return ek(a,!0,'"response" body "expires_in" property',tk,{body:n}),n.expires_in=a,n}async function e2(e){if(e.status>399&&e.status<500){tK(e),eT(e);try{let t=await e.clone().json();if(ew(t)&&"string"==typeof t.error&&t.error.length)return t}catch{}}}async function e5(e,t,r){if(e.status!==t){let t;if(ta(e),t=await e2(e))throw await e.body?.cancel(),new eF("server responded with an error in the response body",{cause:t,response:e});throw ep(`"response" is not a conform ${r} response (unexpected HTTP status code)`,tv,e)}}function e8(e){if(!tc.has(e))throw ee('"options.DPoP" is not a valid DPoPHandle',Z)}async function e6(e,t,r,n,a,i){if(e_(e,'"accessToken"'),!(r instanceof URL))throw ee('"url" must be an instance of URL',Q);eW(r,i?.[et]!==!0),n=eg(n),i?.DPoP&&(e8(i.DPoP),await i.DPoP.addProof(r,n,t.toUpperCase(),e)),n.set("authorization",`${n.has("dpop")?"DPoP":"Bearer"} ${e}`);let s=await (i?.[ea]||fetch)(r.href,{body:a,headers:Object.fromEntries(n.entries()),method:t,redirect:"manual",signal:eS(r,i?.signal)});return i?.DPoP?.cacheNonce(s,r),s}async function e4(e,t,r,n,a,i){let s=await e6(e,t,r,n,a,i);return ta(s),s}async function e3(e,t,r,n,a,i,s){return await r(e,t,a,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(s?.[ea]||fetch)(n.href,{body:a,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:eS(n,s?.signal)})}async function e9(e,t,r,n,a,i){let s=e$(e,"token_endpoint",t.use_mtls_endpoint_aliases,i?.[et]!==!0);a.set("grant_type",n);let o=eg(i?.headers);o.set("accept","application/json"),i?.DPoP!==void 0&&(e8(i.DPoP),await i.DPoP.addProof(s,o,"POST"));let c=await e3(e,t,r,s,a,o,i);return i?.DPoP?.cacheNonce(c,s),c}async function e7(e,t,r,n,a){eD(e),eH(t),e_(n,'"refreshToken"');let i=new URLSearchParams(a?.additionalParameters);return i.set("refresh_token",n),e9(e,t,r,"refresh_token",i,a)}Symbol();let te=new WeakMap,tt=new WeakMap;function tr(e){if(!e.id_token)return;let t=te.get(e);if(!t)throw ee('"ref" was already garbage collected or did not resolve from the proper sources',Z);return t}async function tn(e,t,r,n,a,i){if(eD(e),eH(t),!Y(r,Response))throw ee('"response" must be an instance of Response',Q);await e5(r,200,"Token Endpoint"),tK(r);let s=await tB(r);if(e_(s.access_token,'"response" body "access_token" property',tk,{body:s}),e_(s.token_type,'"response" body "token_type" property',tk,{body:s}),s.token_type=s.token_type.toLowerCase(),void 0!==s.expires_in){let e="number"!=typeof s.expires_in?parseFloat(s.expires_in):s.expires_in;ek(e,!0,'"response" body "expires_in" property',tk,{body:s}),s.expires_in=e}if(void 0!==s.refresh_token&&e_(s.refresh_token,'"response" body "refresh_token" property',tk,{body:s}),void 0!==s.scope&&"string"!=typeof s.scope)throw ep('"response" body "scope" property must be a string',tk,{body:s});if(void 0!==s.id_token){e_(s.id_token,'"response" body "id_token" property',tk,{body:s});let i=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&i.push("auth_time"),void 0!==t.default_max_age&&(ek(t.default_max_age,!0,'"client.default_max_age"'),i.push("auth_time")),n?.length&&i.push(...n);let{claims:o,jwt:c}=await tN(s.id_token,tM.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),eO(t),ex(t),a).then(th.bind(void 0,i)).then(to.bind(void 0,e)).then(ts.bind(void 0,t.client_id));if(Array.isArray(o.aud)&&1!==o.aud.length){if(void 0===o.azp)throw ep('ID Token "aud" (audience) claim includes additional untrusted audiences',tR,{claims:o,claim:"aud"});if(o.azp!==t.client_id)throw ep('unexpected ID Token "azp" (authorized party) claim value',tR,{expected:t.client_id,claims:o,claim:"azp"})}void 0!==o.auth_time&&ek(o.auth_time,!0,'ID Token "auth_time" (authentication time)',tk,{claims:o}),tt.set(r,c),te.set(s,o)}if(i?.[s.token_type]!==void 0)i[s.token_type](r,s);else if("dpop"!==s.token_type&&"bearer"!==s.token_type)throw new ed("unsupported `token_type` value",{cause:{body:s}});return s}function ta(e){let t;if(t=function(e){if(!Y(e,Response))throw ee('"response" must be an instance of Response',Q);let t=e.headers.get("www-authenticate");if(null===t)return;let r=[],n=t;for(;n;){let e,t=n.match(eY),a=t?.["1"].toLowerCase();if(n=t?.["2"],!a)return;let i={};for(;n;){let r,a;if(t=n.match(eZ)){if([,r,a,n]=t,a.includes("\\"))try{a=JSON.parse(`"${a}"`)}catch{}i[r.toLowerCase()]=a;continue}if(t=n.match(eQ)){[,r,a,n]=t,i[r.toLowerCase()]=a;continue}if(t=n.match(e0)){if(Object.keys(i).length)break;[,e,n]=t;break}return}let s={scheme:a,parameters:i};e&&(s.token68=e),r.push(s)}if(r.length)return r}(e))throw new eV("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:t,response:e})}async function ti(e,t,r,n){return tn(e,t,r,void 0,n?.[es],n?.recognizedTokenTypes)}function ts(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw ep('unexpected JWT "aud" (audience) claim value',tR,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw ep('unexpected JWT "aud" (audience) claim value',tR,{expected:e,claims:t.claims,claim:"aud"});return t}function to(e,t){let r=e[tG]?.(t)??e.issuer;if(t.claims.iss!==r)throw ep('unexpected JWT "iss" (issuer) claim value',tR,{expected:r,claims:t.claims,claim:"iss"});return t}let tc=new WeakSet,tu=Symbol();async function tl(e,t,r,n,a,i,s){if(eD(e),eH(t),!tc.has(n))throw ee('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',Z);e_(a,'"redirectUri"');let o=tj(n,"code");if(!o)throw ep('no authorization code in "callbackParameters"',tk);let c=new URLSearchParams(s?.additionalParameters);return c.set("redirect_uri",a),c.set("code",o),i!==tu&&(e_(i,'"codeVerifier"'),c.set("code_verifier",i)),e9(e,t,r,"authorization_code",c,s)}let td={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function th(e,t){for(let r of e)if(void 0===t.claims[r])throw ep(`JWT "${r}" (${td[r]}) claim missing`,tk,{claims:t.claims});return t}let tp=Symbol(),tf=Symbol();async function ty(e,t,r,n){return"string"==typeof n?.expectedNonce||"number"==typeof n?.maxAge||n?.requireIdToken?tm(e,t,r,n.expectedNonce,n.maxAge,n[es],n.recognizedTokenTypes):tw(e,t,r,n?.[es],n?.recognizedTokenTypes)}async function tm(e,t,r,n,a,i,s){let o=[];switch(n){case void 0:n=tp;break;case tp:break;default:e_(n,'"expectedNonce" argument'),o.push("nonce")}switch(a??=t.default_max_age){case void 0:a=tf;break;case tf:break;default:ek(a,!0,'"maxAge" argument'),o.push("auth_time")}let c=await tn(e,t,r,o,i,s);e_(c.id_token,'"response" body "id_token" property',tk,{body:c});let u=tr(c);if(a!==tf){let e=eI()+eO(t),r=ex(t);if(u.auth_time+a<e-r)throw ep("too much time has elapsed since the last End-User authentication",tC,{claims:u,now:e,tolerance:r,claim:"auth_time"})}if(n===tp){if(void 0!==u.nonce)throw ep('unexpected ID Token "nonce" claim value',tR,{expected:void 0,claims:u,claim:"nonce"})}else if(u.nonce!==n)throw ep('unexpected ID Token "nonce" claim value',tR,{expected:n,claims:u,claim:"nonce"});return c}async function tw(e,t,r,n,a){let i=await tn(e,t,r,void 0,n,a),s=tr(i);if(s){if(void 0!==t.default_max_age){ek(t.default_max_age,!0,'"client.default_max_age"');let e=eI()+eO(t),r=ex(t);if(s.auth_time+t.default_max_age<e-r)throw ep("too much time has elapsed since the last End-User authentication",tC,{claims:s,now:e,tolerance:r,claim:"auth_time"})}if(void 0!==s.nonce)throw ep('unexpected ID Token "nonce" claim value',tR,{expected:void 0,claims:s,claim:"nonce"})}return i}let tg="OAUTH_WWW_AUTHENTICATE_CHALLENGE",tS="OAUTH_RESPONSE_BODY_ERROR",tb="OAUTH_UNSUPPORTED_OPERATION",tA="OAUTH_AUTHORIZATION_RESPONSE_ERROR",tE="OAUTH_PARSE_ERROR",tk="OAUTH_INVALID_RESPONSE",t_="OAUTH_RESPONSE_IS_NOT_JSON",tv="OAUTH_RESPONSE_IS_NOT_CONFORM",tT="OAUTH_HTTP_REQUEST_FORBIDDEN",tP="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",tC="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",tR="OAUTH_JWT_CLAIM_COMPARISON_FAILED",tO="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",tx="OAUTH_MISSING_SERVER_METADATA",tI="OAUTH_INVALID_SERVER_METADATA";async function tD(e,t,r,n,a,i){return eD(e),eH(t),e_(n,'"grantType"'),e9(e,t,r,n,new URLSearchParams(a),i)}async function tH(e,t,r,n){return tn(e,t,r,void 0,n?.[es],n?.recognizedTokenTypes)}function tK(e){if(e.bodyUsed)throw ee('"response" body has been used already',Z)}function tU(e){let{algorithm:t}=e;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new ed(`unsupported ${t.name} modulusLength`,{cause:e})}async function tN(e,t,r,n,a){let i,s,{0:o,1:c,length:u}=e.split(".");if(5===u)if(void 0!==a)e=await a(e),{0:o,1:c,length:u}=e.split(".");else throw new ed("JWE decryption is not configured",{cause:e});if(3!==u)throw ep("Invalid JWT",tk,e);try{i=JSON.parse(eu(el(o)))}catch(e){throw ep("failed to parse JWT Header body as base64url encoded JSON",tE,e)}if(!ew(i))throw ep("JWT Header must be a top level object",tk,e);if(t(i),void 0!==i.crit)throw new ed('no JWT "crit" header parameter extensions are supported',{cause:{header:i}});try{s=JSON.parse(eu(el(c)))}catch(e){throw ep("failed to parse JWT Payload body as base64url encoded JSON",tE,e)}if(!ew(s))throw ep("JWT Payload must be a top level object",tk,e);let l=eI()+r;if(void 0!==s.exp){if("number"!=typeof s.exp)throw ep('unexpected JWT "exp" (expiration time) claim type',tk,{claims:s});if(s.exp<=l-n)throw ep('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',tC,{claims:s,now:l,tolerance:n,claim:"exp"})}if(void 0!==s.iat&&"number"!=typeof s.iat)throw ep('unexpected JWT "iat" (issued at) claim type',tk,{claims:s});if(void 0!==s.iss&&"string"!=typeof s.iss)throw ep('unexpected JWT "iss" (issuer) claim type',tk,{claims:s});if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw ep('unexpected JWT "nbf" (not before) claim type',tk,{claims:s});if(s.nbf>l+n)throw ep('unexpected JWT "nbf" (not before) claim value',tC,{claims:s,now:l,tolerance:n,claim:"nbf"})}if(void 0!==s.aud&&"string"!=typeof s.aud&&!Array.isArray(s.aud))throw ep('unexpected JWT "aud" (audience) claim type',tk,{claims:s});return{header:i,claims:s,jwt:e}}function tM(e,t,r,n){if(void 0!==e){if("string"==typeof e?n.alg!==e:!e.includes(n.alg))throw ep('unexpected JWT "alg" header parameter',tk,{header:n,expected:e,reason:"client configuration"});return}if(Array.isArray(t)){if(!t.includes(n.alg))throw ep('unexpected JWT "alg" header parameter',tk,{header:n,expected:t,reason:"authorization server metadata"});return}if(void 0!==r){if("string"==typeof r?n.alg!==r:"function"==typeof r?!r(n.alg):!r.includes(n.alg))throw ep('unexpected JWT "alg" header parameter',tk,{header:n,expected:r,reason:"default value"});return}throw ep('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:r})}function tj(e,t){let{0:r,length:n}=e.getAll(t);if(n>1)throw ep(`"${t}" parameter must be provided only once`,tk);return r}let tW=Symbol(),tL=Symbol();async function t$(e,t,r,n,a){eD(e),eH(t);let i=e$(e,"backchannel_authentication_endpoint",t.use_mtls_endpoint_aliases,a?.[et]!==!0),s=new URLSearchParams(n);s.set("client_id",t.client_id);let o=eg(a?.headers);return o.set("accept","application/json"),e3(e,t,r,i,s,o,a)}async function tJ(e,t,r){if(eD(e),eH(t),!Y(r,Response))throw ee('"response" must be an instance of Response',Q);await e5(r,200,"Backchannel Authentication Endpoint"),tK(r);let n=await tB(r);e_(n.auth_req_id,'"response" body "auth_req_id" property',tk,{body:n});let a="number"!=typeof n.expires_in?parseFloat(n.expires_in):n.expires_in;return ek(a,!0,'"response" body "expires_in" property',tk,{body:n}),n.expires_in=a,void 0!==n.interval&&ek(n.interval,!1,'"response" body "interval" property',tk,{body:n}),n}async function tq(e,t,r,n,a){eD(e),eH(t),e_(n,'"authReqId"');let i=new URLSearchParams(a?.additionalParameters);return i.set("auth_req_id",n),e9(e,t,r,"urn:openid:params:grant-type:ciba",i,a)}async function tz(e,t,r,n){return tn(e,t,r,void 0,n?.[es],n?.recognizedTokenTypes)}async function tB(e,t=eT){let r;try{r=await e.json()}catch(r){throw t(e),ep('failed to parse "response" body as JSON',tE,r)}if(!ew(r))throw ep('"response" body must be a top level object',tk,{body:r});return r}let tF=Symbol(),tG=Symbol();function tV(){return"string"==typeof globalThis.EdgeRuntime}let tX=async e=>{let t=e?.delay??100,r=e?.jitter??!0,n=t;r&&(n=t*(.5+.5*Math.random())),await new Promise(e=>setTimeout(e,n))};async function tY(e,t){if(!t?.isDPoPEnabled)return await e();try{let r=await e();if(r instanceof Response&&400===r.status)try{let n=await r.clone().json();if("use_dpop_nonce"===n.error)return await tX(t),await e()}catch{}return r}catch(r){if(ez(r))return await tX(t),await e();throw r}}function tZ(e,t){if(e){if("string"==typeof e)return e;if(!t)throw new N("When defining scope as a Map, an audience is required to look up the correct scope.");return e[t]}}function tQ(e,t){return{accessToken:e.accessToken,expiresAt:e.expiresAt,audience:t.audience,scope:e.scope,requestedScope:e.requestedScope,...e.token_type&&{token_type:e.token_type}}}function t0(e){return e?e.trim().split(" ").filter(Boolean):[]}let t1=(e,t,r={})=>{if(e===t)return!0;if(!e||!t)return!1;let n=new Set(t0(e)),a=new Set(t0(t)),i=Array.from(a).every(e=>n.has(e));return r.strict?i&&n.size===a.size:i};function t2(e,t){return Array.from(new Set([...e?t0(e):[],...t?t0(t):[]])).join(" ")}function t5(e,t){let r=t.matchMode??"requestedScope",n=e?.accessTokens;if(!n||0===n.length)return;let a=n.filter(e=>e.audience===t.audience&&t1("scope"===r?e.scope:e.requestedScope??e.scope,t.scope,{strict:"scope"===r}));if(0!==a.length)return a.sort((e,t)=>{let r=new Set(t0(e.scope)),n=new Set(t0(t.scope));return r.size-n.size}),a[0]}function t8(e,t,r){if(r)return{accessTokens:r.accessTokens,tokenSet:{...e.tokenSet,idToken:t.idToken,refreshToken:t.refreshToken}}}function t6(e,t,r){let n,a,i=tZ(r.scope,t.audience??r.audience);if(n=!t.audience||t.audience===(e.tokenSet.audience??r.audience),a=!t.requestedScope||t1(e.tokenSet.requestedScope??i,t.requestedScope),n&&a)return t.accessToken!==e.tokenSet.accessToken||t.expiresAt!==e.tokenSet.expiresAt||t.refreshToken!==e.tokenSet.refreshToken?{tokenSet:t}:void 0;let s=t.audience??r.audience,o=t.requestedScope??i??void 0;if(s)return function(e,t,r,n){var a;let i=t5(e,{scope:n,audience:r,matchMode:"requestedScope"});if(i){let n=function(e,t,r,n){if(t.accessToken!==r.accessToken)return{accessTokens:e.accessTokens?.map(e=>e===r?tQ(t,{audience:n}):e)}}(e,t,i,r);return t8(e,t,n)}if(i=t5(e,{scope:t.scope,audience:r,matchMode:"scope"})){let n=(a=i,{accessTokens:e.accessTokens?.map(e=>e===a?tQ({...t,requestedScope:t2(e.requestedScope,t.requestedScope),scope:t.scope},{audience:r}):e)});return t8(e,t,n)}{let n={accessTokens:[...e.accessTokens||[],tQ(t,{audience:r})]};return t8(e,t,n)}}(e,t,s,o)}function t4(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let t3=(e,...t)=>t4("Key must be ",e,...t),t9=(e,t,...r)=>t4(`Key for the ${e} algorithm must be `,t,...r);function t7(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}class re extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class rt extends re{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class rr extends re{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class rn extends re{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class ra extends re{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class ri extends re{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}class rs extends re{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class ro extends re{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class rc extends re{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class ru extends re{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class rl extends re{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class rd extends re{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class rh extends re{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class rp extends re{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}class rf extends re{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function ry(e){if(!rm(e))throw Error("CryptoKey instance expected")}let rm=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},rw=e=>e?.[Symbol.toStringTag]==="KeyObject",rg=e=>rm(e)||rw(e),rS=(e,t)=>{if(e.byteLength!==t.length)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},rb=e=>{let t=e.data[e.pos++];if(128&t){let r=127&t,n=0;for(let t=0;t<r;t++)n=n<<8|e.data[e.pos++];return n}return t},rA=(e,t,r)=>{if(e.data[e.pos++]!==t)throw Error(r)},rE=(e,t)=>{let r=e.data.subarray(e.pos,e.pos+t);return e.pos+=t,r},rk=async(e,t,r,n)=>{let a,i,s="spki"===e,o=()=>s?["verify"]:["sign"];switch(r){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=o();break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=o();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":a={name:"ECDSA",namedCurve:({ES256:"P-256",ES384:"P-384",ES512:"P-521"})[r]},i=o();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let e=n.getNamedCurve(t);a="X25519"===e?{name:"X25519"}:{name:"ECDH",namedCurve:e}}catch(e){throw new ra("Invalid or unsupported key format")}i=s?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":a={name:"Ed25519"},i=o();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:r},i=o();break;default:throw new ra('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,t,a,n?.extractable??!!s,i)},r_=new TextEncoder,rv=new TextDecoder;function rT(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}function rP(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function rC(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return rP(r,t,0),rP(r,e%0x100000000,4),r}function rR(e){let t=new Uint8Array(4);return rP(t,e),t}function rO(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(n>127)throw TypeError("non-ASCII string encountered in encode()");t[r]=n}return t}function rx(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:rv.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=rv.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return t7(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function rI(e){let t=e;return("string"==typeof t&&(t=r_.encode(t)),Uint8Array.prototype.toBase64)?t.toBase64({alphabet:"base64url",omitPadding:!0}):(function(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join(""))})(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}async function rD(e){if(rw(e))if("secret"!==e.type)return e.export({format:"jwk"});else e=e.export();if(e instanceof Uint8Array)return{kty:"oct",k:rI(e)};if(!rm(e))throw TypeError(t3(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:n,use:a,...i}=await crypto.subtle.exportKey("jwk",e);return"AKP"===i.kty&&(i.alg=n),i}async function rH(e){return rD(e)}async function rK(e,t){let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(r,t))}function rU(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}e.s(["decode",()=>rx,"encode",()=>rI],663370);let rN=e=>rU(e)&&"string"==typeof e.kty,rM=(e,t)=>{if("string"!=typeof e||!e)throw new ru(`${t} missing or invalid`)};async function rj(e,t){let r,n;if(rN(e))r=e;else if(rg(e))r=await rH(e);else throw TypeError(t3(e,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(t??="sha256")&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(r.kty){case"AKP":rM(r.alg,'"alg" (Algorithm) Parameter'),rM(r.pub,'"pub" (Public key) Parameter'),n={alg:r.alg,kty:r.kty,pub:r.pub};break;case"EC":rM(r.crv,'"crv" (Curve) Parameter'),rM(r.x,'"x" (X Coordinate) Parameter'),rM(r.y,'"y" (Y Coordinate) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":rM(r.crv,'"crv" (Subtype of Key Pair) Parameter'),rM(r.x,'"x" (Public Key) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":rM(r.e,'"e" (Exponent) Parameter'),rM(r.n,'"n" (Modulus) Parameter'),n={e:r.e,kty:r.kty,n:r.n};break;case"oct":rM(r.k,'"k" (Key Value) Parameter'),n={k:r.k,kty:r.kty};break;default:throw new ra('"kty" (Key Type) Parameter missing or unsupported')}let a=rO(JSON.stringify(n));return rI(await rK(t,a))}async function rW(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new ra('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ra('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new ra('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new ra('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new ra('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),n={...e};return"AKP"!==n.kty&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,t,e.ext??(!e.d&&!e.priv),e.key_ops??r)}async function rL(e,t,r){let n,a,i;if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return n=/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,a=t7(e.replace(n,"")),i=r,t?.startsWith?.("ECDH-ES")&&((i||={}).getNamedCurve=e=>{let t,r={data:e,pos:0};return rA(r,48,"Invalid PKCS#8 structure"),rb(r),rA(r,2,"Expected version field"),t=rb(r),r.pos+=t,rA(r,48,"Expected algorithm identifier"),rb(r),r.pos,(e=>{let t,r=(rA(e,6,"Expected algorithm OID"),t=rb(e),rE(e,t));if(rS(r,[43,101,110]))return"X25519";if(!rS(r,[42,134,72,206,61,2,1]))throw Error("Unsupported key algorithm");rA(e,6,"Expected curve OID");let n=rb(e),a=rE(e,n);for(let{name:e,oid:t}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(rS(a,t))return e;throw Error("Unsupported named curve")})(r)}),rk("pkcs8",a,t,i)}async function r$(e,t,r){let n;if(!rU(e))throw TypeError("JWK must be an object");switch(t??=e.alg,n??=r?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return rx(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new ra('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return rW({...e,alg:t,ext:n});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return rW({...e,ext:n});case"EC":case"OKP":return rW({...e,alg:t,ext:n});default:throw new ra('Unsupported "kty" (Key Type) Parameter value')}}function rJ(e){return rU(e)}class rq{#u;#l=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(rJ)}(e))throw new rl("JSON Web Key Set malformed");this.#u=structuredClone(e)}jwks(){return this.#u}async getKey(e,t){let{alg:r,kid:n}={...e,...t?.header},a=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new ra('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this.#u.keys.filter(e=>{let t=a===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&("string"==typeof e.alg||"AKP"===a)&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":case"EdDSA":t="Ed25519"===e.crv}return t}),{0:s,length:o}=i;if(0===o)throw new rd;if(1!==o){let e=new rh,t=this.#l;throw e[Symbol.asyncIterator]=async function*(){for(let e of i)try{yield await rz(t,e,r)}catch{}},e}return rz(this.#l,s,r)}}async function rz(e,t,r){let n=e.get(t)||e.set(t,{}).get(t);if(void 0===n[r]){let e=await r$({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new rl("JSON Web Key Set members must be public keys");n[r]=e}return n[r]}function rB(e){let t=new rq(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),r}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(i="jose/v6.1.2");let rF=Symbol();async function rG(e,t,r,n=fetch){let a=await n(e,{method:"GET",signal:r,redirect:"manual",headers:t}).catch(e=>{if("TimeoutError"===e.name)throw new rp;throw e});if(200!==a.status)throw new re("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new re("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let rV=Symbol();class rX{#d;#h;#p;#f;#y;#m;#w;#g;#S;#b;constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this.#d=new URL(e.href),this.#h="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this.#p="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this.#f="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,this.#w=new Headers(t?.headers),i&&!this.#w.has("User-Agent")&&this.#w.set("User-Agent",i),this.#w.has("accept")||(this.#w.set("accept","application/json"),this.#w.append("accept","application/jwk-set+json")),this.#g=t?.[rF],t?.[rV]!==void 0&&(this.#b=t?.[rV],function(e,t){return!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&!!rU(e.jwks)&&!!Array.isArray(e.jwks.keys)&&!!Array.prototype.every.call(e.jwks.keys,rU)}(t?.[rV],this.#f)&&(this.#y=this.#b.uat,this.#S=rB(this.#b.jwks)))}pendingFetch(){return!!this.#m}coolingDown(){return"number"==typeof this.#y&&Date.now()<this.#y+this.#p}fresh(){return"number"==typeof this.#y&&Date.now()<this.#y+this.#f}jwks(){return this.#S?.jwks()}async getKey(e,t){this.#S&&this.fresh()||await this.reload();try{return await this.#S(e,t)}catch(r){if(r instanceof rd&&!1===this.coolingDown())return await this.reload(),this.#S(e,t);throw r}}async reload(){this.#m&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#m=void 0),this.#m||=rG(this.#d.href,this.#w,AbortSignal.timeout(this.#h),this.#g).then(e=>{this.#S=rB(e),this.#b&&(this.#b.uat=Date.now(),this.#b.jwks=e),this.#y=Date.now(),this.#m=void 0}).catch(e=>{throw this.#m=void 0,e}),await this.#m}}function rY(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}let rZ=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`);function rQ(e){return parseInt(e.name.slice(4),10)}function r0(e,t){if(t&&!e.usages.includes(t))throw TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function r1(e,t,r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==e.algorithm.name)throw rZ("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rZ(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==e.algorithm.name)throw rZ("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rZ(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw rZ("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==e.algorithm.name)throw rZ("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==e.algorithm.name)throw rZ("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(rQ(e.algorithm.hash)!==r)throw rZ(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}r0(e,r)}async function r2(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(t3(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return!function(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if("HMAC"!==e.algorithm.name)throw rZ("HMAC");let r=parseInt(t.slice(2),10);if(rQ(e.algorithm.hash)!==r)throw rZ(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if("RSASSA-PKCS1-v1_5"!==e.algorithm.name)throw rZ("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(rQ(e.algorithm.hash)!==r)throw rZ(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if("RSA-PSS"!==e.algorithm.name)throw rZ("RSA-PSS");let r=parseInt(t.slice(2),10);if(rQ(e.algorithm.hash)!==r)throw rZ(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if("Ed25519"!==e.algorithm.name)throw rZ("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":let n;if(n=e.algorithm,n.name!==t)throw rZ(t);break;case"ES256":case"ES384":case"ES512":{if("ECDSA"!==e.algorithm.name)throw rZ("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw rZ(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}r0(e,r)}(t,e,r),t}async function r5(e,t,r,n){let a=await r2(e,t,"verify");rY(e,a);let i=function(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new ra(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e,a.algorithm);try{return await crypto.subtle.verify(i,a,r,n)}catch{return!1}}function r8(...e){let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0}let r6=e=>e?.[Symbol.toStringTag],r4=(e,t,r)=>{if(void 0!==t.use){let e;switch(r){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let n;switch(!0){case"sign"===r||"verify"===r:case"dir"===e:case e.includes("CBC-HS"):n=r;break;case e.startsWith("PBES2"):n="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):n=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===r?"wrapKey":"unwrapKey":r;break;case"encrypt"===r&&e.startsWith("RSA"):n="wrapKey";break;case"decrypt"===r:n=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(n&&t.key_ops?.includes?.(n)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${n}" when present`)}return!0};function r3(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((e,t,r)=>{if(!(t instanceof Uint8Array)){if(rN(t)){if("oct"===t.kty&&"string"==typeof t.k&&r4(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!rg(t))throw TypeError(t9(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError(`${r6(t)} instances for symmetric algorithms must be of type "secret"`)}})(e,t,r);break;default:((e,t,r)=>{if(rN(t))switch(r){case"decrypt":case"sign":if("oct"!==t.kty&&("AKP"===t.kty&&"string"==typeof t.priv||"string"==typeof t.d)&&r4(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if("oct"!==t.kty&&void 0===t.d&&void 0===t.priv&&r4(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!rg(t))throw TypeError(t9(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError(`${r6(t)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===t.type)switch(r){case"sign":throw TypeError(`${r6(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${r6(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===t.type)switch(r){case"verify":throw TypeError(`${r6(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${r6(t)} instances for asymmetric algorithm encryption must be of type "public"`)}})(e,t,r)}}function r9(e,t,r,n,a){let i;if(void 0!==a.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!i.has(s))throw new ra(`Extension Header Parameter "${s}" is not recognized`);if(void 0===a[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&void 0===n[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(n.crit)}function r7(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}let ne=async(e,t,r,n=!1)=>{let a=(s||=new WeakMap).get(e);if(a?.[r])return a[r];let i=await rW({...t,alg:r});return n&&Object.freeze(e),a?a[r]=i:s.set(e,{[r]:i}),i};async function nt(e,t){if(e instanceof Uint8Array||rm(e))return e;if(rw(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,t)=>{let r,n=(s||=new WeakMap).get(e);if(n?.[t])return n[t];let a="public"===e.type,i=!!a;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}r=e.toCryptoKey(e.asymmetricKeyType,i,a?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");r=e.toCryptoKey(e.asymmetricKeyType,i,[a?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");r=e.toCryptoKey(e.asymmetricKeyType,i,[a?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let n;switch(t){case"RSA-OAEP":n="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":n="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":n="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":n="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:n},i,a?["encrypt"]:["decrypt"]);r=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:n},i,[a?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let n=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!n)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===n&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:n},i,[a?"verify":"sign"])),"ES384"===t&&"P-384"===n&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:n},i,[a?"verify":"sign"])),"ES512"===t&&"P-521"===n&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:n},i,[a?"verify":"sign"])),t.startsWith("ECDH-ES")&&(r=e.toCryptoKey({name:"ECDH",namedCurve:n},i,a?[]:["deriveBits"]))}if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[t]=r:s.set(e,{[t]:r}),r})(e,t)}catch(e){if(e instanceof TypeError)throw e}let r=e.export({format:"jwk"});return ne(e,r,t)}if(rN(e))return e.k?rx(e.k):ne(e,e,t,!0);throw Error("unreachable")}async function nr(e,t,r){let n,a;if(!rU(e))throw new ro("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new ro('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new ro("JWS Protected Header incorrect type");if(void 0===e.payload)throw new ro("JWS Payload missing");if("string"!=typeof e.signature)throw new ro("JWS Signature missing or incorrect type");if(void 0!==e.header&&!rU(e.header))throw new ro("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=rx(e.protected);i=JSON.parse(rv.decode(t))}catch{throw new ro("JWS Protected Header is invalid")}if(!r8(i,e.header))throw new ro("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...i,...e.header},o=r9(ro,new Map([["b64",!0]]),r?.crit,i,s),c=!0;if(o.has("b64")&&"boolean"!=typeof(c=i.b64))throw new ro('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:u}=s;if("string"!=typeof u||!u)throw new ro('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=r&&r7("algorithms",r.algorithms);if(l&&!l.has(u))throw new rn('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new ro("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new ro("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t&&(t=await t(i,e),d=!0),r3(u,t,"verify");let h=rT(void 0!==e.protected?rO(e.protected):new Uint8Array,rO("."),"string"==typeof e.payload?c?rO(e.payload):r_.encode(e.payload):e.payload);try{n=rx(e.signature)}catch{throw new ro("Failed to base64url decode the signature")}let p=await nt(t,u);if(!await r5(u,p,n,h))throw new rf;if(c)try{a=rx(e.payload)}catch{throw new ro("Failed to base64url decode the payload")}else a="string"==typeof e.payload?r_.encode(e.payload):e.payload;let f={payload:a};return(void 0!==e.protected&&(f.protectedHeader=i),void 0!==e.header&&(f.unprotectedHeader=e.header),d)?{...f,key:p}:f}async function nn(e,t,r){if(e instanceof Uint8Array&&(e=rv.decode(e)),"string"!=typeof e)throw new ro("Compact JWS must be a string or Uint8Array");let{0:n,1:a,2:i,length:s}=e.split(".");if(3!==s)throw new ro("Invalid Compact JWS");let o=await nr({payload:a,protected:n,signature:i},t,r),c={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...c,key:o.key}:c}let na=e=>Math.floor(e.getTime()/1e3),ni=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function ns(e){let t,r=ni.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(0x1e187e0*n)}return"-"===r[1]||"ago"===r[4]?-t:t}function no(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}let nc=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`;function nu(e,t,r={}){var n,a;let i,s;try{i=JSON.parse(rv.decode(t))}catch{}if(!rU(i))throw new rc("JWT Claims Set must be a top-level JSON object");let{typ:o}=r;if(o&&("string"!=typeof e.typ||nc(e.typ)!==nc(o)))throw new rt('unexpected "typ" JWT header value',i,"typ","check_failed");let{requiredClaims:c=[],issuer:u,subject:l,audience:d,maxTokenAge:h}=r,p=[...c];for(let e of(void 0!==h&&p.push("iat"),void 0!==d&&p.push("aud"),void 0!==l&&p.push("sub"),void 0!==u&&p.push("iss"),new Set(p.reverse())))if(!(e in i))throw new rt(`missing required "${e}" claim`,i,e,"missing");if(u&&!(Array.isArray(u)?u:[u]).includes(i.iss))throw new rt('unexpected "iss" claim value',i,"iss","check_failed");if(l&&i.sub!==l)throw new rt('unexpected "sub" claim value',i,"sub","check_failed");if(d&&(n=i.aud,a="string"==typeof d?[d]:d,"string"==typeof n?!a.includes(n):!(Array.isArray(n)&&a.some(Set.prototype.has.bind(new Set(n))))))throw new rt('unexpected "aud" claim value',i,"aud","check_failed");switch(typeof r.clockTolerance){case"string":s=ns(r.clockTolerance);break;case"number":s=r.clockTolerance;break;case"undefined":s=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:f}=r,y=na(f||new Date);if((void 0!==i.iat||h)&&"number"!=typeof i.iat)throw new rt('"iat" claim must be a number',i,"iat","invalid");if(void 0!==i.nbf){if("number"!=typeof i.nbf)throw new rt('"nbf" claim must be a number',i,"nbf","invalid");if(i.nbf>y+s)throw new rt('"nbf" claim timestamp check failed',i,"nbf","check_failed")}if(void 0!==i.exp){if("number"!=typeof i.exp)throw new rt('"exp" claim must be a number',i,"exp","invalid");if(i.exp<=y-s)throw new rr('"exp" claim timestamp check failed',i,"exp","check_failed")}if(h){let e=y-i.iat;if(e-s>("number"==typeof h?h:ns(h)))throw new rr('"iat" claim timestamp check failed (too far in the past)',i,"iat","check_failed");if(e<0-s)throw new rt('"iat" claim timestamp check failed (it should be in the past)',i,"iat","check_failed")}return i}class nl{#A;constructor(e){if(!rU(e))throw TypeError("JWT Claims Set MUST be an object");this.#A=structuredClone(e)}data(){return r_.encode(JSON.stringify(this.#A))}get iss(){return this.#A.iss}set iss(e){this.#A.iss=e}get sub(){return this.#A.sub}set sub(e){this.#A.sub=e}get aud(){return this.#A.aud}set aud(e){this.#A.aud=e}set jti(e){this.#A.jti=e}set nbf(e){"number"==typeof e?this.#A.nbf=no("setNotBefore",e):e instanceof Date?this.#A.nbf=no("setNotBefore",na(e)):this.#A.nbf=na(new Date)+ns(e)}set exp(e){"number"==typeof e?this.#A.exp=no("setExpirationTime",e):e instanceof Date?this.#A.exp=no("setExpirationTime",na(e)):this.#A.exp=na(new Date)+ns(e)}set iat(e){void 0===e?this.#A.iat=na(new Date):e instanceof Date?this.#A.iat=no("setIssuedAt",na(e)):"string"==typeof e?this.#A.iat=no("setIssuedAt",na(new Date)+ns(e)):this.#A.iat=no("setIssuedAt",e)}}async function nd(e,t,r){let n=await nn(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new rc("JWTs MUST NOT use unencoded payload");let a={payload:nu(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...a,key:n.key}:a}function nh(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new ra(`Unsupported JWE Algorithm: ${e}`)}}function np(e,t){if(t.length<<3!==nh(e))throw new rs("Invalid Initialization Vector length")}function nf(e,t){let r=e.byteLength<<3;if(r!==t)throw new rs(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)}async function ny(e,t){if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let r={name:"HMAC",hash:"SHA-256"},n=await crypto.subtle.generateKey(r,!1,["sign"]),a=new Uint8Array(await crypto.subtle.sign(r,n,e)),i=new Uint8Array(await crypto.subtle.sign(r,n,t)),s=0,o=-1;for(;++o<32;)s|=a[o]^i[o];return 0===s}async function nm(e,t,r,n,a,i){let s,o;if(!(t instanceof Uint8Array))throw TypeError(t3(t,"Uint8Array"));let c=parseInt(e.slice(1,4),10),u=await crypto.subtle.importKey("raw",t.subarray(c>>3),"AES-CBC",!1,["decrypt"]),l=await crypto.subtle.importKey("raw",t.subarray(0,c>>3),{hash:`SHA-${c<<1}`,name:"HMAC"},!1,["sign"]),d=rT(i,n,r,rC(i.length<<3)),h=new Uint8Array((await crypto.subtle.sign("HMAC",l,d)).slice(0,c>>3));try{s=await ny(a,h)}catch{}if(!s)throw new ri;try{o=new Uint8Array(await crypto.subtle.decrypt({iv:n,name:"AES-CBC"},u,r))}catch{}if(!o)throw new ri;return o}async function nw(e,t,r,n,a,i){let s;t instanceof Uint8Array?s=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(r1(t,e,"decrypt"),s=t);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:i,iv:n,name:"AES-GCM",tagLength:128},s,rT(r,a)))}catch{throw new ri}}async function ng(e,t,r,n,a,i){if(!rm(t)&&!(t instanceof Uint8Array))throw TypeError(t3(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!n)throw new rs("JWE Initialization Vector missing");if(!a)throw new rs("JWE Authentication Tag missing");switch(np(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&nf(t,parseInt(e.slice(-3),10)),nm(e,t,r,n,a,i);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&nf(t,parseInt(e.slice(1,4),10)),nw(e,t,r,n,a,i);default:throw new ra("Unsupported JWE Content Encryption Algorithm")}}function nS(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function nb(e,t,r){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[r]):(r1(e,t,r),e)}async function nA(e,t,r){let n=await nb(t,e,"wrapKey");nS(n,e);let a=await crypto.subtle.importKey("raw",r,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",a,n,"AES-KW"))}async function nE(e,t,r){let n=await nb(t,e,"unwrapKey");nS(n,e);let a=await crypto.subtle.unwrapKey("raw",r,n,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",a))}function nk(e){return rT(rR(e.length),e)}async function n_(e,t,r){let n=t>>3,a=Math.ceil(n/32),i=new Uint8Array(32*a);for(let t=1;t<=a;t++){let n=new Uint8Array(4+e.length+r.length);n.set(rR(t),0),n.set(e,4),n.set(r,4+e.length);let a=await rK("sha256",n);i.set(a,(t-1)*32)}return i.slice(0,n)}async function nv(e,t,r,n,a=new Uint8Array,i=new Uint8Array){var s;r1(e,"ECDH"),r1(t,"ECDH","deriveBits");let o=rT(nk(rO(r)),nk(a),nk(i),rR(n),new Uint8Array);return n_(new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},t,"X25519"===(s=e).algorithm.name?256:Math.ceil(parseInt(s.algorithm.namedCurve.slice(-3),10)/8)<<3)),n,o)}function nT(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===e.algorithm.name}}async function nP(e,t,r,n){if(!(e instanceof Uint8Array)||e.length<8)throw new rs("PBES2 Salt Input must be 8 or more octets");let a=rT(rO(t),Uint8Array.of(0),e),i=parseInt(t.slice(13,16),10),s={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:a},o=await (n instanceof Uint8Array?crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits"]):(r1(n,t,"deriveBits"),n));return new Uint8Array(await crypto.subtle.deriveBits(s,o,i))}async function nC(e,t,r,n=2048,a=crypto.getRandomValues(new Uint8Array(16))){let i=await nP(a,e,n,t);return{encryptedKey:await nA(e.slice(-6),i,r),p2c:n,p2s:rI(a)}}async function nR(e,t,r,n,a){let i=await nP(a,e,n,t);return nE(e.slice(-6),i,r)}let nO=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new ra(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function nx(e,t,r){return r1(t,e,"encrypt"),rY(e,t),new Uint8Array(await crypto.subtle.encrypt(nO(e),t,r))}async function nI(e,t,r){return r1(t,e,"decrypt"),rY(e,t),new Uint8Array(await crypto.subtle.decrypt(nO(e),t,r))}function nD(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new ra(`Unsupported JWE Algorithm: ${e}`)}}let nH=e=>crypto.getRandomValues(new Uint8Array(nD(e)>>3));async function nK(e,t,r,n,a){if(!(r instanceof Uint8Array))throw TypeError(t3(r,"Uint8Array"));let i=parseInt(e.slice(1,4),10),s=await crypto.subtle.importKey("raw",r.subarray(i>>3),"AES-CBC",!1,["encrypt"]),o=await crypto.subtle.importKey("raw",r.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),c=new Uint8Array(await crypto.subtle.encrypt({iv:n,name:"AES-CBC"},s,t)),u=rT(a,n,c,rC(a.length<<3));return{ciphertext:c,tag:new Uint8Array((await crypto.subtle.sign("HMAC",o,u)).slice(0,i>>3)),iv:n}}async function nU(e,t,r,n,a){let i;r instanceof Uint8Array?i=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(r1(r,e,"encrypt"),i=r);let s=new Uint8Array(await crypto.subtle.encrypt({additionalData:a,iv:n,name:"AES-GCM",tagLength:128},i,t)),o=s.slice(-16);return{ciphertext:s.slice(0,-16),tag:o,iv:n}}async function nN(e,t,r,n,a){if(!rm(r)&&!(r instanceof Uint8Array))throw TypeError(t3(r,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(n)np(e,n);else n=crypto.getRandomValues(new Uint8Array(nh(e)>>3));switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&nf(r,parseInt(e.slice(-3),10)),nK(e,t,r,n,a);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&nf(r,parseInt(e.slice(1,4),10)),nU(e,t,r,n,a);default:throw new ra("Unsupported JWE Content Encryption Algorithm")}}async function nM(e,t,r,n){let a=e.slice(0,7),i=await nN(a,r,t,n,new Uint8Array);return{encryptedKey:i.ciphertext,iv:rI(i.iv),tag:rI(i.tag)}}async function nj(e,t,r,n,a){return ng(e.slice(0,7),t,r,n,a,new Uint8Array)}async function nW(e,t,r,n,a){switch(e){case"dir":if(void 0!==r)throw new rs("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new rs("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let a,i;if(!rU(n.epk))throw new rs('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(ry(t),!nT(t))throw new ra("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await r$(n.epk,e);if(ry(s),void 0!==n.apu){if("string"!=typeof n.apu)throw new rs('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{a=rx(n.apu)}catch{throw new rs("Failed to base64url decode the apu")}}if(void 0!==n.apv){if("string"!=typeof n.apv)throw new rs('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{i=rx(n.apv)}catch{throw new rs("Failed to base64url decode the apv")}}let o=await nv(s,t,"ECDH-ES"===e?n.enc:e,"ECDH-ES"===e?nD(n.enc):parseInt(e.slice(-5,-2),10),a,i);if("ECDH-ES"===e)return o;if(void 0===r)throw new rs("JWE Encrypted Key missing");return nE(e.slice(-6),o,r)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new rs("JWE Encrypted Key missing");return ry(t),nI(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let i;if(void 0===r)throw new rs("JWE Encrypted Key missing");if("number"!=typeof n.p2c)throw new rs('JOSE Header "p2c" (PBES2 Count) missing or invalid');let s=a?.maxPBES2Count||1e4;if(n.p2c>s)throw new rs('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof n.p2s)throw new rs('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{i=rx(n.p2s)}catch{throw new rs("Failed to base64url decode the p2s")}return nR(e,t,r,n.p2c,i)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new rs("JWE Encrypted Key missing");return nE(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let a,i;if(void 0===r)throw new rs("JWE Encrypted Key missing");if("string"!=typeof n.iv)throw new rs('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof n.tag)throw new rs('JOSE Header "tag" (Authentication Tag) missing or invalid');try{a=rx(n.iv)}catch{throw new rs("Failed to base64url decode the iv")}try{i=rx(n.tag)}catch{throw new rs("Failed to base64url decode the tag")}return nj(e,t,r,a,i)}default:throw new ra('Invalid or unsupported "alg" (JWE Algorithm) header value')}}async function nL(e,t,r){let n,a,i,s,o,c,u;if(!rU(e))throw new rs("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new rs("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new rs("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new rs("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new rs("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new rs("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new rs("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new rs("JWE AAD incorrect type");if(void 0!==e.header&&!rU(e.header))throw new rs("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!rU(e.unprotected))throw new rs("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=rx(e.protected);n=JSON.parse(rv.decode(t))}catch{throw new rs("JWE Protected Header is invalid")}if(!r8(n,e.header,e.unprotected))throw new rs("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let l={...n,...e.header,...e.unprotected};if(r9(rs,new Map,r?.crit,n,l),void 0!==l.zip)throw new ra('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:d,enc:h}=l;if("string"!=typeof d||!d)throw new rs("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof h||!h)throw new rs("missing JWE Encryption Algorithm (enc) in JWE Header");let p=r&&r7("keyManagementAlgorithms",r.keyManagementAlgorithms),f=r&&r7("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(p&&!p.has(d)||!p&&d.startsWith("PBES2"))throw new rn('"alg" (Algorithm) Header Parameter value not allowed');if(f&&!f.has(h))throw new rn('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{a=rx(e.encrypted_key)}catch{throw new rs("Failed to base64url decode the encrypted_key")}let y=!1;"function"==typeof t&&(t=await t(n,e),y=!0),r3("dir"===d?h:d,t,"decrypt");let m=await nt(t,d);try{i=await nW(d,m,a,l,r)}catch(e){if(e instanceof TypeError||e instanceof rs||e instanceof ra)throw e;i=nH(h)}if(void 0!==e.iv)try{s=rx(e.iv)}catch{throw new rs("Failed to base64url decode the iv")}if(void 0!==e.tag)try{o=rx(e.tag)}catch{throw new rs("Failed to base64url decode the tag")}let w=void 0!==e.protected?rO(e.protected):new Uint8Array;c=void 0!==e.aad?rT(w,rO("."),rO(e.aad)):w;try{u=rx(e.ciphertext)}catch{throw new rs("Failed to base64url decode the ciphertext")}let g={plaintext:await ng(h,i,u,s,o,c)};if(void 0!==e.protected&&(g.protectedHeader=n),void 0!==e.aad)try{g.additionalAuthenticatedData=rx(e.aad)}catch{throw new rs("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(g.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(g.unprotectedHeader=e.header),y)?{...g,key:m}:g}async function n$(e,t,r){if(e instanceof Uint8Array&&(e=rv.decode(e)),"string"!=typeof e)throw new rs("Compact JWE must be a string or Uint8Array");let{0:n,1:a,2:i,3:s,4:o,length:c}=e.split(".");if(5!==c)throw new rs("Invalid Compact JWE");let u=await nL({ciphertext:s,iv:i||void 0,protected:n,tag:o||void 0,encrypted_key:a||void 0},t,r),l={plaintext:u.plaintext,protectedHeader:u.protectedHeader};return"function"==typeof t?{...l,key:u.key}:l}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(o={"user-agent":"openid-client/v6.8.1"});let nJ="ERR_INVALID_ARG_VALUE",nq="ERR_INVALID_ARG_TYPE";function nz(e,t,r){let n=TypeError(e,{cause:r});return Object.assign(n,{code:t}),n}class nB extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=t?.code,Error.captureStackTrace?.(this,this.constructor)}}function nF(e,t,r){return new nB(e,{cause:t,code:r})}function nG(e){if(e instanceof TypeError||e instanceof nB||e instanceof eF||e instanceof eG||e instanceof eV)throw e;if(e instanceof eh)switch(e.code){case tT:throw nF("only requests to HTTPS are allowed",e,e.code);case tP:throw nF("only requests to HTTP or HTTPS are allowed",e,e.code);case tv:throw nF("unexpected HTTP response status code",e.cause,e.code);case t_:throw nF("unexpected response content-type",e.cause,e.code);case tE:throw nF("parsing error occured",e,e.code);case tk:throw nF("invalid response encountered",e,e.code);case tR:throw nF("unexpected JWT claim value encountered",e,e.code);case tO:throw nF("unexpected JSON attribute value encountered",e,e.code);case tC:throw nF("JWT timestamp claim value failed validation",e,e.code);default:throw nF(e.message,e,e.code)}if(e instanceof ed)throw nF("unsupported operation",e,e.code);if(e instanceof DOMException)switch(e.name){case"OperationError":throw nF("runtime operation error",e,tb);case"NotSupportedError":throw nF("runtime unsupported operation",e,tb);case"TimeoutError":throw nF("operation timed out",e,"OAUTH_TIMEOUT");case"AbortError":throw nF("operation aborted",e,"OAUTH_ABORT")}throw new nB("something went wrong",{cause:e})}new TextDecoder;let nV=Symbol();class nX{constructor(e,t,r,n){let a;if("string"!=typeof t||!t.length)throw nz('"clientId" must be a non-empty string',nq);if("string"==typeof r&&(r={client_secret:r}),r?.client_id!==void 0&&t!==r.client_id)throw nz('"clientId" and "metadata.client_id" must be the same',nJ);const i={...structuredClone(r),client_id:t};i[er]=r?.[er]??0,i[en]=r?.[en]??30,a=n||("string"==typeof i.client_secret&&i.client_secret.length?function(e){return void 0!==e?eK(e):(u||=new WeakMap,(e,t,r,n)=>{let a;return(a=u.get(t))||(function(e,t){if("string"!=typeof e)throw nz(`${t} must be a string`,nq);if(0===e.length)throw nz(`${t} must not be empty`,nJ)}(t.client_secret,'"metadata.client_secret"'),a=eK(t.client_secret),u.set(t,a)),a(e,t,r,n)})}(i.client_secret):(e,t,r,n)=>{r.set("client_id",t.client_id)});let s=Object.freeze(i);const o=structuredClone(e);nV in e&&(o[tG]=({claims:{tid:t}})=>e.issuer.replace("{tenantid}",t));let l=Object.freeze(o);(c||=new WeakMap).set(this,{__proto__:null,as:l,c:s,auth:a,tlsOnly:!0,jwksCache:{}})}serverMetadata(){let e=structuredClone(c.get(this).as);return Object.defineProperties(e,{supportsPKCE:{__proto__:null,value:(t="S256")=>e.code_challenge_methods_supported?.includes(t)===!0}}),e}clientMetadata(){return structuredClone(c.get(this).c)}get timeout(){return c.get(this).timeout}set timeout(e){c.get(this).timeout=e}get[ea](){return c.get(this).fetch}set[ea](e){c.get(this).fetch=e}}async function nY(e,t,r,n=!1){let a,i=e.headers.get("retry-after")?.trim();if(void 0!==i){if(/^\d+$/.test(i))a=parseInt(i,10);else{let e=new Date(i);if(Number.isFinite(e.getTime())){let t=new Date,r=e.getTime()-t.getTime();r>0&&(a=Math.ceil(r/1e3))}}if(n&&!Number.isFinite(a))throw new eh("invalid Retry-After header value",{cause:e});a>t&&await nZ(a-t,r)}}function nZ(e,t){return new Promise((r,n)=>{let a=e=>{try{t.throwIfAborted()}catch(e){n(e);return}if(e<=0)return void r();let i=Math.min(e,5);setTimeout(()=>a(e-i),1e3*i)};a(e)})}async function nQ(e,t){n1(e);let{as:r,c:n,auth:a,fetch:i,tlsOnly:s,timeout:u}=c.get(e);return t$(r,n,a,t,{[ea]:i,[et]:!s,headers:new Headers(o),signal:n2(u)}).then(e=>tJ(r,n,e)).catch(nG)}async function n0(e,t,r,n){var a,i,s;let u;n1(e),r=new URLSearchParams(r);let l=t.interval??5,d=n?.signal??AbortSignal.timeout(1e3*t.expires_in);try{await nZ(l,d)}catch(e){nG(e)}let{as:h,c:p,auth:f,fetch:y,tlsOnly:m,nonRepudiation:w,timeout:g,decrypt:S}=c.get(e),b=(a,i)=>n0(e,{...t,interval:a},r,{...n,signal:d,flag:i}),A=await tq(h,p,f,t.auth_req_id,{[ea]:y,[et]:!m,additionalParameters:r,DPoP:n?.DPoP,headers:new Headers(o),signal:d.aborted?d:n2(g)}).catch(nG);if(503===A.status&&A.headers.has("retry-after"))return await nY(A,l,d,!0),await A.body?.cancel(),b(l);let E=tz(h,p,A,{[es]:S});try{u=await E}catch(e){if(i=e,s=n,s?.DPoP&&s.flag!==n5&&ez(i))return b(l,n5);if(e instanceof eF)switch(e.error){case"slow_down":l+=5;case"authorization_pending":return await nY(e.response,l,d),b(l)}nG(e)}return u.id_token&&await w?.(A),Object.defineProperties(a=u,function(e){let t;if(void 0!==e.expires_in){let r=new Date;r.setSeconds(r.getSeconds()+e.expires_in),t=r.getTime()}return{expiresIn:{__proto__:null,value(){if(t){let e=Date.now();return t>e?Math.floor((t-e)/1e3):0}}},claims:{__proto__:null,value(){try{return tr(this)}catch{return}}}}}(a)),u}function n1(e){if(!(e instanceof nX))throw nz('"config" must be an instance of Configuration',nq);if(Object.getPrototypeOf(e)!==nX.prototype)throw nz("subclassing Configuration is not allowed",nJ)}function n2(e){return e?AbortSignal.timeout(1e3*e):void 0}Object.freeze(nX.prototype);let n5=Symbol();var n8=e.i(372418);function n6(e,t,r=[]){let n=new URLSearchParams,a={...e,...t};return Object.entries(a).forEach(([e,t])=>{r&&(r.includes(e)||null==t)||("scope"===e&&"object"==typeof t&&(t=tZ(t,a.audience)),t&&n.set(e,String(t)))}),n}function n4(e){return e&&!e.endsWith("/")?`${e}/`:e}function n3(e){return e&&e.startsWith("/")?e.substring(1,e.length):e}(y=A||(A={})).SUBJECT_TYPE_REFRESH_TOKEN="urn:ietf:params:oauth:token-type:refresh_token",y.SUBJECT_TYPE_ACCESS_TOKEN="urn:ietf:params:oauth:token-type:access_token",(m=E||(E={})).CODE="code",m.CONNECT_CODE="connect_code";let n9=new Set(["accept","accept-language","content-language","content-type","user-agent","cache-control","if-match","if-none-match","if-modified-since","if-unmodified-since","etag","x-request-id","x-correlation-id","traceparent","tracestate","x-forwarded-for","x-forwarded-host","x-forwarded-proto","x-real-ip","origin","access-control-request-method","access-control-request-headers"]),n7=new Set(["connection","keep-alive","proxy-authenticate","proxy-authorization","te","trailer","transfer-encoding","upgrade"]);function ae(e){let t=new Headers;return e.headers.forEach((e,r)=>{let n=r.toLowerCase();n9.has(n)&&!n7.has(n)&&t.set(r,e)}),t}function at(e){let t=new Headers;return e.headers.forEach((e,r)=>{let n=r.toLowerCase();n7.has(n)||t.set(r,e)}),t}function ar(e,t){let r=t.targetBaseUrl,n=e.nextUrl.pathname.startsWith(t.proxyPath)?e.nextUrl.pathname.slice(t.proxyPath.length):e.nextUrl.pathname;n&&!n.startsWith("/")&&(n="/"+n);let a=new URL(r.replace(/\/$/,"")),i=a.pathname,s=i;if(n&&"/"!==n){let e=i.split("/").filter(Boolean),t=n.split("/").filter(Boolean),r=0,a=Math.min(e.length,t.length);for(let n=a;n>=1;n--){let a=e.slice(-n),i=t.slice(0,n);if(a.every((e,t)=>e===i[t])){r=n;break}}let o=t.slice(r);if(o.length>0){let e="/"===i||i.endsWith("/")?"":"/";s=i+e+o.join("/")}}let o=new URL(a.origin+s);return e.nextUrl.searchParams.forEach((e,t)=>{o.searchParams.set(t,e)}),o}function an(e,t){let r;try{r=new URL(e,t)}catch(e){return}if(r.origin===t.origin)return r}function aa(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),n=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?n:`${n}; ${r.join("; ")}`}function ai(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[n,a]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=a?a:"true"))}catch{}}return t}var as=["strict","lax","none"],ao=["low","medium","high"],ac=class{constructor(e){this._parsed=new Map,this._headers=e;const t=e.get("cookie");if(t)for(const[e,r]of ai(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>aa(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>aa(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},au=class{constructor(e){var t,r,n;this._parsed=new Map,this._headers=e;const a=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[];for(const e of Array.isArray(a)?a:function(e){if(!e)return[];var t,r,n,a,i,s=[],o=0;function c(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,i=!1;c();)if(","===(r=e.charAt(o))){for(n=o,o+=1,c(),a=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(i=!0,o=a,s.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!i||o>=e.length)&&s.push(e.substring(t,e.length))}return s}(a)){const t=function(e){var t,r;if(!e)return;let[[n,a],...i]=ai(e),{domain:s,expires:o,httponly:c,maxage:u,path:l,samesite:d,secure:h,partitioned:p,priority:f}=Object.fromEntries(i.map(([e,t])=>[e.toLowerCase().replace(/-/g,""),t]));return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}({name:n,value:decodeURIComponent(a),domain:s,...o&&{expires:new Date(o)},...c&&{httpOnly:!0},..."string"==typeof u&&{maxAge:Number(u)},path:l,...d&&{sameSite:(t=(t=d).toLowerCase(),as.includes(t)?t:void 0)},...h&&{secure:!0},...f&&{priority:(r=(r=f).toLowerCase(),ao.includes(r)?r:void 0)},...p&&{partitioned:!0}})}(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){let[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,a=this._parsed;return a.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=aa(r);t.append("set-cookie",e)}}(a,this._headers),this}delete(...e){let[t,r]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0]];return this.set({...r,name:t,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(aa).join("; ")}};"function"!=typeof X.hkdf||process.versions.electron||(l=async(...e)=>new Promise((t,r)=>{X.hkdf(...e,(e,n)=>{e?r(e):t(new Uint8Array(n))})}));let al=async(e,t,r,n,a)=>(l||((e,t,r,n,a)=>{let i=parseInt(e.substr(3),10)>>3||20,s=(0,X.createHmac)(e,r.byteLength?r:new Uint8Array(i)).update(t).digest(),o=Math.ceil(a/i),c=new Uint8Array(i*o+n.byteLength+1),u=0,l=0;for(let t=1;t<=o;t++)c.set(n,l),c[l+n.byteLength]=t,c.set((0,X.createHmac)(e,s).update(c.subarray(u,l+n.byteLength+1)).digest(),l),u=l,l+=i;return c.slice(0,a)}))(e,t,r,n,a);function ad(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}async function ah(e,t,r,n,a){return al(function(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}(e),function(e){let t=ad(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}(t),ad(r,"salt"),function(e){let t=ad(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}(n),function(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');if(e>255*(parseInt(t.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return e}(a,e))}let ap=Symbol();async function af(e,t,r,n,a={}){let i,s,o;switch(e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let c;if(ry(r),!nT(r))throw new ra("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:u,apv:l}=a;c=a.epk?await nt(a.epk,e):(await crypto.subtle.generateKey(r.algorithm,!0,["deriveBits"])).privateKey;let{x:d,y:h,crv:p,kty:f}=await rH(c),y=await nv(r,c,"ECDH-ES"===e?t:e,"ECDH-ES"===e?nD(t):parseInt(e.slice(-5,-2),10),u,l);if(s={epk:{x:d,crv:p,kty:f}},"EC"===f&&(s.epk.y=h),u&&(s.apu=rI(u)),l&&(s.apv=rI(l)),"ECDH-ES"===e){o=y;break}o=n||nH(t);let m=e.slice(-6);i=await nA(m,y,o);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=n||nH(t),ry(r),i=await nx(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=n||nH(t);let{p2c:c,p2s:u}=a;({encryptedKey:i,...s}=await nC(e,r,o,c,u));break}case"A128KW":case"A192KW":case"A256KW":o=n||nH(t),i=await nA(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=n||nH(t);let{iv:c}=a;({encryptedKey:i,...s}=await nM(e,r,o,c));break}default:throw new ra('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:i,parameters:s}}class ay{#E;#k;#_;#v;#T;#P;#C;#R;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#E=e}setKeyManagementParameters(e){if(this.#R)throw TypeError("setKeyManagementParameters can only be called once");return this.#R=e,this}setProtectedHeader(e){if(this.#k)throw TypeError("setProtectedHeader can only be called once");return this.#k=e,this}setSharedUnprotectedHeader(e){if(this.#_)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#_=e,this}setUnprotectedHeader(e){if(this.#v)throw TypeError("setUnprotectedHeader can only be called once");return this.#v=e,this}setAdditionalAuthenticatedData(e){return this.#T=e,this}setContentEncryptionKey(e){if(this.#P)throw TypeError("setContentEncryptionKey can only be called once");return this.#P=e,this}setInitializationVector(e){if(this.#C)throw TypeError("setInitializationVector can only be called once");return this.#C=e,this}async encrypt(e,t){let r,n,a,i,s,o;if(!this.#k&&!this.#v&&!this.#_)throw new rs("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!r8(this.#k,this.#v,this.#_))throw new rs("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this.#k,...this.#v,...this.#_};if(r9(rs,new Map,t?.crit,this.#k,c),void 0!==c.zip)throw new ra('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:u,enc:l}=c;if("string"!=typeof u||!u)throw new rs('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof l||!l)throw new rs('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#P&&("dir"===u||"ECDH-ES"===u))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${u}`);r3("dir"===u?l:u,e,"encrypt");{let a,i=await nt(e,u);({cek:n,encryptedKey:r,parameters:a}=await af(u,l,i,this.#P,this.#R)),a&&(t&&ap in t?this.#v?this.#v={...this.#v,...a}:this.setUnprotectedHeader(a):this.#k?this.#k={...this.#k,...a}:this.setProtectedHeader(a))}if(this.#k?s=rO(i=rI(JSON.stringify(this.#k))):(i="",s=new Uint8Array),this.#T){let e=rO(o=rI(this.#T));a=rT(s,rO("."),e)}else a=s;let{ciphertext:d,tag:h,iv:p}=await nN(l,this.#E,n,this.#C,a),f={ciphertext:rI(d)};return p&&(f.iv=rI(p)),h&&(f.tag=rI(h)),r&&(f.encrypted_key=rI(r)),o&&(f.aad=o),this.#k&&(f.protected=i),this.#_&&(f.unprotected=this.#_),this.#v&&(f.header=this.#v),f}}class am{#O;constructor(e){this.#O=new ay(e)}setContentEncryptionKey(e){return this.#O.setContentEncryptionKey(e),this}setInitializationVector(e){return this.#O.setInitializationVector(e),this}setProtectedHeader(e){return this.#O.setProtectedHeader(e),this}setKeyManagementParameters(e){return this.#O.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this.#O.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}class aw{#P;#C;#R;#k;#x;#I;#D;#H;constructor(e={}){this.#H=new nl(e)}setIssuer(e){return this.#H.iss=e,this}setSubject(e){return this.#H.sub=e,this}setAudience(e){return this.#H.aud=e,this}setJti(e){return this.#H.jti=e,this}setNotBefore(e){return this.#H.nbf=e,this}setExpirationTime(e){return this.#H.exp=e,this}setIssuedAt(e){return this.#H.iat=e,this}setProtectedHeader(e){if(this.#k)throw TypeError("setProtectedHeader can only be called once");return this.#k=e,this}setKeyManagementParameters(e){if(this.#R)throw TypeError("setKeyManagementParameters can only be called once");return this.#R=e,this}setContentEncryptionKey(e){if(this.#P)throw TypeError("setContentEncryptionKey can only be called once");return this.#P=e,this}setInitializationVector(e){if(this.#C)throw TypeError("setInitializationVector can only be called once");return this.#C=e,this}replicateIssuerAsHeader(){return this.#x=!0,this}replicateSubjectAsHeader(){return this.#I=!0,this}replicateAudienceAsHeader(){return this.#D=!0,this}async encrypt(e,t){let r=new am(this.#H.data());return this.#k&&(this.#x||this.#I||this.#D)&&(this.#k={...this.#k,iss:this.#x?this.#H.iss:void 0,sub:this.#I?this.#H.sub:void 0,aud:this.#D?this.#H.aud:void 0}),r.setProtectedHeader(this.#k),this.#C&&r.setInitializationVector(this.#C),this.#P&&r.setContentEncryptionKey(this.#P),this.#R&&r.setKeyManagementParameters(this.#R),r.encrypt(e,t)}}async function ag(e,t,r){let n=await n$(e,t,r),a=nu(n.protectedHeader,n.plaintext,r),{protectedHeader:i}=n;if(void 0!==i.iss&&i.iss!==a.iss)throw new rt('replicated "iss" claim header parameter mismatch',a,"iss","mismatch");if(void 0!==i.sub&&i.sub!==a.sub)throw new rt('replicated "sub" claim header parameter mismatch',a,"sub","mismatch");if(void 0!==i.aud&&JSON.stringify(i.aud)!==JSON.stringify(a.aud))throw new rt('replicated "aud" claim header parameter mismatch',a,"aud","mismatch");let s={payload:a,protectedHeader:i};return"function"==typeof t?{...s,key:n.key}:s}var aS=e.i(663370),aS=aS;let ab="sha256",aA="JWE CEK";async function aE(e,t,r,n){let a=await ah(ab,t,"",aA,32);return(await new aw(e).setProtectedHeader({enc:"A256GCM",alg:"dir",...n}).setExpirationTime(r).encrypt(a)).toString()}async function ak(e,t,r){try{let n=await ah(ab,t,"",aA,32);return await ag(e,n,{...r,clockTolerance:15})}catch(e){if("ERR_JWT_EXPIRED"===e.code)return null;throw e}}async function a_(e,t,r){if(!t)return;let[n,a]=t.split("."),i={protected:aS.encode(JSON.stringify({alg:"HS256",b64:!1,crit:["b64"]})),payload:`${e}=${n}`,signature:a},s=await ah("sha256",r,"","JWS Cookie Signing",32);try{return await nr(i,s,{algorithms:["HS256"]}),n}catch(e){return}}let av=RegExp("__(\\d+)$"),aT=/\.(\d+)$/,aP=(e,t)=>{let r=t?aT.exec(e):av.exec(e);if(r)return parseInt(r[1],10)},aC=(e,t,r)=>{let n=new RegExp(r?`^${t}${aT.source}$`:`^${t}__\\d+$`);return e.getAll().filter(e=>n.test(e.name))};function aR(e,t,r){let n=t.get(e);if(n?.value)return n.value;let a=aC(t,e,r).sort((e,t)=>aP(e.name,r)-aP(t.name,r));if(0===a.length)return;let i=aP(a[a.length-1].name,r);return a.length!==i+1?void console.warn(`Incomplete chunked cookie '${e}': Found ${a.length} chunks, expected ${i+1}`):a.map(e=>e.value).join("")}function aO(e,t,r,n,a){aI(r,e,a),aC(t,e,n).forEach(e=>{aI(r,e.name,a)})}function ax(e){e.headers.set("Cache-Control","private, no-cache, no-store, must-revalidate, max-age=0"),e.headers.set("Pragma","no-cache"),e.headers.set("Expires","0")}function aI(e,t,r){let n={maxAge:0};r?.domain&&(n.domain=r.domain),r?.path&&(n.path=r.path),e.set(t,"",n)}class aD{constructor(e,t){this.hooks=t,this.config={...e,fetch:e.fetch||fetch}}isAbsoluteUrl(e){try{return new URL(e),!0}catch{return!1}}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return`${e.replace(/\/?\/$/,"")}/${t.replace(/^\/+/,"")}`}throw TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(e){return this.config.getAccessToken?this.config.getAccessToken(e??{}):this.hooks.getAccessToken(e??{})}buildBaseRequest(e,t){let r;return r=e instanceof Request?e.url:e instanceof URL?e.toString():this.config.baseUrl&&!this.isAbsoluteUrl(e)?this.buildUrl(this.config.baseUrl,e):e,new Request(r,t)}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":"function"==typeof e.get?e.get(t)||"":e[t]||""}async internalFetchWithAuth(e,t,r,n){let a,i,s=this.buildBaseRequest(e,t),o=await this.getAccessToken(n);"string"==typeof o?(a=!!this.config.dpopHandle,i=o):(a=!!this.config.dpopHandle&&o.token_type?.toLowerCase()==="dpop",i=o.accessToken);try{return await e4(i,s.method,new URL(s.url),s.headers,s.body,{...this.config.httpOptions(),[ea]:(e,t)=>this.config.fetch(e,t),[et]:this.config.allowInsecureRequests||!1,...a&&{DPoP:this.config.dpopHandle}})}catch(e){if(ez(e)&&r.onUseDpopNonceError)return r.onUseDpopNonceError();throw e}}isRequestInit(e){return!!e&&"object"==typeof e&&!["refresh","scope","audience"].some(t=>Object.prototype.hasOwnProperty.call(e,t))}fetchWithAuth(e,t,r){let n,a;2==arguments.length&&void 0!==t?this.isRequestInit(t)?(n=t,a=void 0):(n=void 0,a=t):(n=t,a=r);let i={onUseDpopNonceError:async()=>{let t=this.config.retryConfig??{delay:100,jitter:!0},r=t.delay??100;t.jitter&&(r*=.5+.5*Math.random()),await new Promise(e=>setTimeout(e,r));try{return await this.internalFetchWithAuth(e,n,{...i,onUseDpopNonceError:void 0},a)}catch(e){if(ez(e)){let t=Error(`DPoP nonce error persisted after retry: ${e.message}`);throw t.code=e.code||"dpop_nonce_retry_failed",t}throw e}}};return this.internalFetchWithAuth(e,n,i,a)}}let aH=["sub","name","nickname","given_name","family_name","picture","email","email_verified","org_id"];var aK=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};let aU=["client_id","redirect_uri","response_type","code_challenge","code_challenge_method","state","nonce"];function aN(e,t){return new URL(n3((e=>{let t=process.env.NEXT_PUBLIC_BASE_PATH;return t?n4(t&&!t.startsWith("/")?`/${t}`:t)+n3(e):e})(e)),n4(t))}class aM{constructor(e){k.add(this),this.proxyFetchers={},this.fetch=e.fetch||fetch,this.jwksCache=e.jwksCache||{},this.allowInsecureRequests=e.allowInsecureRequests??!1,this.httpTimeout=e.httpTimeout??5e3,this.httpOptions=()=>{let t=new Headers;if(e.enableTelemetry??!0){let e="nextjs-auth0",r=n8.default.version;t.set("User-Agent",`${e}/${r}`),t.set("Auth0-Client",aj(JSON.stringify({name:e,version:r})))}return{signal:AbortSignal.timeout(this.httpTimeout),headers:t}},this.allowInsecureRequests&&console.warn("allowInsecureRequests is enabled in a production environment. This is not recommended."),this.transactionStore=e.transactionStore,this.sessionStore=e.sessionStore,this.domain=e.domain,this.clientMetadata={client_id:e.clientId},e.dpopOptions&&("number"==typeof e.dpopOptions.clockSkew&&(this.clientMetadata[er]=e.dpopOptions.clockSkew),"number"==typeof e.dpopOptions.clockTolerance&&(this.clientMetadata[en]=e.dpopOptions.clockTolerance)),this.dpopOptions=e.dpopOptions,this.clientSecret=e.clientSecret,this.authorizationParameters=e.authorizationParameters||{scope:V},this.pushedAuthorizationRequests=e.pushedAuthorizationRequests??!1,this.clientAssertionSigningKey=e.clientAssertionSigningKey,this.clientAssertionSigningAlg=e.clientAssertionSigningAlg||"RS256",this.authorizationParameters.scope=function(e){if(!e.scope)return V;if("object"==typeof e.scope&&!tZ(e.scope,e.audience)){let t=e.audience;return{...e.scope,[t]:V}}return e.scope}(this.authorizationParameters);const t=tZ(this.authorizationParameters.scope,this.authorizationParameters.audience)?.split(" ").map(e=>e.trim());if(!t||!t.includes("openid"))throw Error("The 'openid' scope must be included in the set of scopes. See https://auth0.com/docs");this.appBaseUrl=e.appBaseUrl,this.signInReturnToPath=e.signInReturnToPath||"/";const r=["auto","oidc","v2"];let n=e.logoutStrategy||"auto";r.includes(n)||(console.error(`Invalid logoutStrategy: ${n}. Must be one of: ${r.join(", ")}. Defaulting to "auto"`),n="auto"),this.logoutStrategy=n,this.includeIdTokenHintInOIDCLogoutUrl=e.includeIdTokenHintInOIDCLogoutUrl??!0,this.beforeSessionSaved=e.beforeSessionSaved,this.onCallback=e.onCallback||this.defaultOnCallback,this.routes=e.routes,this.enableAccessTokenEndpoint=e.enableAccessTokenEndpoint??!0,this.noContentProfileResponseWhenUnauthenticated=e.noContentProfileResponseWhenUnauthenticated??!1,this.enableConnectAccountEndpoint=e.enableConnectAccountEndpoint??!1,this.useDPoP=e.useDPoP??!1,e.useDPoP&&e.dpopKeyPair&&(this.dpopKeyPair=e.dpopKeyPair)}async handler(e){let t,{pathname:r}=e.nextUrl,n=e.nextUrl.basePath;n&&r.startsWith(n)&&(r=r.slice(n.length)||"/");let a=(t=r).endsWith("/")?t.slice(0,-1):t,i=e.method;if("GET"===i&&a===this.routes.login)return this.handleLogin(e);{if("GET"===i&&a===this.routes.logout)return this.handleLogout(e);if("GET"===i&&a===this.routes.callback)return this.handleCallback(e);if("GET"===i&&a===this.routes.profile)return this.handleProfile(e);if("GET"===i&&a===this.routes.accessToken&&this.enableAccessTokenEndpoint)return this.handleAccessToken(e);if("POST"===i&&a===this.routes.backChannelLogout)return this.handleBackChannelLogout(e);if("GET"===i&&a===this.routes.connectAccount&&this.enableConnectAccountEndpoint)return this.handleConnectAccount(e);if(a.startsWith("/me/"))return this.handleMyAccount(e);if(a.startsWith("/my-org/"))return this.handleMyOrg(e);let t=x.NextResponse.next(),r=await this.sessionStore.get(e.cookies);return r&&(await this.sessionStore.set(e.cookies,t.cookies,{...r}),ax(t)),t}}async startInteractiveLogin(e={}){let t=aN(this.routes.callback,this.appBaseUrl),r=this.signInReturnToPath;if(e.returnTo){let t=new URL(this.authorizationParameters.redirect_uri||this.appBaseUrl),n=an(e.returnTo,t);n&&(r=n.pathname+n.search+n.hash)}let n=eP(),a=await eC(n),i=eP(),s=eP(),o=n6(this.authorizationParameters,e.authorizationParameters,aU);if(o.set("client_id",this.clientMetadata.client_id),o.set("redirect_uri",t.toString()),o.set("response_type",E.CODE),o.set("code_challenge",a),o.set("code_challenge_method","S256"),o.set("state",i),o.set("nonce",s),this.dpopKeyPair)try{let e=await rH(this.dpopKeyPair.publicKey),t=await rj(e);o.set("dpop_jkt",t)}catch(e){throw new B(S.DPOP_JKT_CALCULATION_FAILED,"DPoP is enabled but failed to calculate key thumbprint (dpop_jkt). This is required for secure DPoP binding. Please check your key configuration.",e instanceof Error?e:void 0)}let c={nonce:s,maxAge:this.authorizationParameters.max_age,codeVerifier:n,responseType:E.CODE,state:i,returnTo:r,scope:o.get("scope")||void 0,audience:o.get("audience")||void 0},[u,l]=await this.authorizationUrl(o);if(u)return new x.NextResponse("An error occurred while trying to initiate the login request.",{status:500});let d=x.NextResponse.redirect(l.toString());return await this.transactionStore.save(d.cookies,c),d}async handleLogin(e){let{returnTo:t,...r}=Object.fromEntries(e.nextUrl.searchParams.entries());return this.startInteractiveLogin({authorizationParameters:r,returnTo:t})}async handleLogout(e){let t,r=await this.sessionStore.get(e.cookies),[n,a]=await this.discoverAuthorizationServerMetadata();if(n){let t=new x.NextResponse("An error occurred while trying to initiate the logout request.",{status:500});return await this.sessionStore.delete(e.cookies,t.cookies),await this.transactionStore.deleteAll(e.cookies,t.cookies),t}let i=e.nextUrl.searchParams.get("returnTo")||this.appBaseUrl,s=e.nextUrl.searchParams.has("federated"),o=()=>{let e=new URL("/v2/logout",this.issuer);return e.searchParams.set("returnTo",i),e.searchParams.set("client_id",this.clientMetadata.client_id),s&&e.searchParams.set("federated",""),x.NextResponse.redirect(e)},c=()=>{let e=new URL(a.end_session_endpoint);return e.searchParams.set("client_id",this.clientMetadata.client_id),e.searchParams.set("post_logout_redirect_uri",i),r?.internal.sid&&e.searchParams.set("logout_hint",r.internal.sid),this.includeIdTokenHintInOIDCLogoutUrl&&r?.tokenSet.idToken&&e.searchParams.set("id_token_hint",r.tokenSet.idToken),s&&e.searchParams.set("federated",""),x.NextResponse.redirect(e)};if("v2"===this.logoutStrategy)t=o();else if("oidc"===this.logoutStrategy){if(!a.end_session_endpoint){let t=new x.NextResponse("OIDC RP-Initiated Logout is not supported by the authorization server. Enable it or use a different logout strategy.",{status:500});return await this.sessionStore.delete(e.cookies,t.cookies),await this.transactionStore.deleteAll(e.cookies,t.cookies),t}t=c()}else a.end_session_endpoint?t=c():(console.warn("The Auth0 client does not have RP-initiated logout enabled, the user will be redirected to the `/v2/logout` endpoint instead. Learn how to enable it here: https://auth0.com/docs/authenticate/login/logout/log-users-out-of-auth0#enable-endpoint-discovery"),t=o());return await this.sessionStore.delete(e.cookies,t.cookies),ax(t),await this.transactionStore.deleteAll(e.cookies,t.cookies),t}async handleCallback(e){let t,r,n,a,i,s=e.nextUrl.searchParams.get("state");if(!s)return this.handleCallbackError(new K,{},e);let o=await this.transactionStore.get(e.cookies,s);if(!o)return this.onCallback(new U,{},null);let c=o.payload,u={responseType:c.responseType,returnTo:c.returnTo};if(c.responseType===E.CONNECT_CODE){let t=await this.sessionStore.get(e.cookies);if(!t)return this.handleCallbackError(new G({code:b.MISSING_SESSION,message:"The user does not have an active session."}),u,e,s);let[r,n]=await this.getTokenSet(t,{audience:`${this.issuer}/me/`,scope:"create:me:connected_accounts"});if(r)return this.handleCallbackError(r,u,e,s);let[a,i]=await this.completeConnectAccount({tokenSet:n.tokenSet,authSession:c.authSession,connectCode:e.nextUrl.searchParams.get("connect_code"),redirectUri:aN(this.routes.callback,this.appBaseUrl).toString(),codeVerifier:c.codeVerifier});if(a)return this.handleCallbackError(a,u,e,s);let o=await this.onCallback(null,{...u,connectedAccount:i},t);return await this.transactionStore.delete(o.cookies,s),o}let[l,d]=await this.discoverAuthorizationServerMetadata();if(l)return this.handleCallbackError(l,u,e,s);try{t=function(e,t,r,n){var a;if(eD(e),eH(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw ee('"parameters" must be an instance of URLSearchParams, or URL',Q);if(tj(r,"response"))throw ep('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',tk,{parameters:r});let i=tj(r,"iss"),s=tj(r,"state");if(!i&&e.authorization_response_iss_parameter_supported)throw ep('response parameter "iss" (issuer) missing',tk,{parameters:r});if(i&&i!==e.issuer)throw ep('unexpected "iss" (issuer) response parameter value',tk,{expected:e.issuer,parameters:r});switch(n){case void 0:case tL:if(void 0!==s)throw ep('unexpected "state" response parameter encountered',tk,{expected:void 0,parameters:r});break;case tW:break;default:if(e_(n,'"expectedState" argument'),s!==n)throw ep(void 0===s?'response parameter "state" missing':'unexpected "state" response parameter value',tk,{expected:n,parameters:r})}if(tj(r,"error"))throw new eG("authorization response from the server is an error",{cause:r});let o=tj(r,"id_token"),c=tj(r,"token");if(void 0!==o||void 0!==c)throw new ed("implicit and hybrid flows are not supported");return a=new URLSearchParams(r),tc.add(a),a}(d,this.clientMetadata,e.nextUrl.searchParams,c.state)}catch(t){return this.handleCallbackError(new M({cause:new D({code:t.error,message:t.error_description})}),u,e,s)}try{n=aN(this.routes.callback,this.appBaseUrl);let e=this.useDPoP&&this.dpopKeyPair?eB(this.clientMetadata,this.dpopKeyPair):void 0;a=async()=>tl(d,this.clientMetadata,await this.getClientAuth(),t,n.toString(),c.codeVerifier,{...this.httpOptions(),[ea]:this.fetch,[et]:this.allowInsecureRequests,...e&&{DPoP:e}}),r=await tY(a,{isDPoPEnabled:!!e,...this.dpopOptions?.retry})}catch(t){return this.handleCallbackError(new j(t.message),u,e,s)}try{i=await ty(d,this.clientMetadata,r,{expectedNonce:c.nonce,maxAge:c.maxAge,requireIdToken:!0})}catch(t){return this.handleCallbackError(new W({cause:new D({code:t.error,message:t.error_description})}),u,e,s)}let h=tr(i),p={user:h,tokenSet:{accessToken:i.access_token,idToken:i.id_token,scope:i.scope,requestedScope:c.scope,audience:c.audience,refreshToken:i.refresh_token,expiresAt:Math.floor(Date.now()/1e3)+Number(i.expires_in)},internal:{sid:h.sid,createdAt:Math.floor(Date.now()/1e3)}},f=await this.onCallback(null,u,p);return p=await this.finalizeSession(p,i.id_token),await this.sessionStore.set(e.cookies,f.cookies,p,!0),ax(f),await this.transactionStore.delete(f.cookies,s),f}async handleProfile(e){let t=await this.sessionStore.get(e.cookies);if(!t)return this.noContentProfileResponseWhenUnauthenticated?new x.NextResponse(null,{status:204}):new x.NextResponse(null,{status:401});let r=x.NextResponse.json(t?.user);return ax(r),r}async handleAccessToken(e){let t=await this.sessionStore.get(e.cookies),r=e.nextUrl.searchParams.get("audience"),n=e.nextUrl.searchParams.get("scope");if(!t)return x.NextResponse.json({error:{message:"The user does not have an active session.",code:w.MISSING_SESSION}},{status:401});let[a,i]=await this.getTokenSet(t,{scope:n,audience:r});if(a)return x.NextResponse.json({error:{message:a.message,code:a.code}},{status:401});let{tokenSet:s}=i,o=x.NextResponse.json({token:s.accessToken,scope:s.scope,expires_at:s.expiresAt,...s.token_type&&{token_type:s.token_type}});return await aK(this,k,"m",P).call(this,e,o,t,i),o}async handleBackChannelLogout(e){if(!this.sessionStore.store)return new x.NextResponse("A session data store is not configured.",{status:500});if(!this.sessionStore.store.deleteByLogoutToken)return new x.NextResponse("Back-channel logout is not supported by the session data store.",{status:500});let t=new URLSearchParams(await e.text()).get("logout_token");if(!t)return new x.NextResponse("Missing `logout_token` in the request body.",{status:400});let[r,n]=await this.verifyLogoutToken(t);return r?new x.NextResponse(r.message,{status:400}):(await this.sessionStore.store.deleteByLogoutToken(n),new x.NextResponse(null,{status:204}))}async handleConnectAccount(e){let t=await this.sessionStore.get(e.cookies),r=e.nextUrl.searchParams.get("connection"),n=e.nextUrl.searchParams.get("returnTo")??void 0,a=Object.fromEntries([...e.nextUrl.searchParams.entries()].filter(([e])=>"connection"!==e&&"returnTo"!==e));if(!r)return new x.NextResponse("A connection is required.",{status:400});if(!t)return new x.NextResponse("The user does not have an active session.",{status:401});let[i,s]=await this.getTokenSet(t,{scope:"create:me:connected_accounts",audience:`${this.issuer}/me/`});if(i)return new x.NextResponse("Failed to retrieve a connected account access token.",{status:401});let{tokenSet:o}=s,[c,u]=await this.connectAccount({tokenSet:o,connection:r,authorizationParams:a,returnTo:n});return c?new x.NextResponse(c.message,{status:c.cause?.status??500}):(await aK(this,k,"m",P).call(this,e,u,t,s),u)}async handleMyAccount(e){return aK(this,k,"m",T).call(this,e,{proxyPath:"/me",targetBaseUrl:`${this.issuer}/me/v1`,audience:`${this.issuer}/me/`,scope:e.headers.get("scope")})}async handleMyOrg(e){return aK(this,k,"m",T).call(this,e,{proxyPath:"/my-org",targetBaseUrl:`${this.issuer}/my-org`,audience:`${this.issuer}/my-org/`,scope:e.headers.get("scope")})}async getTokenSet(e,t={}){let r=t2(tZ(this.authorizationParameters.scope,t.audience??this.authorizationParameters.audience),t.scope),n=aK(this,k,"m",_).call(this,e,{scope:r,audience:t.audience??this.authorizationParameters.audience});if(!n.refreshToken&&!n.accessToken)return[new q(w.MISSING_REFRESH_TOKEN,"No access token found and a refresh token was not provided. The user needs to re-authenticate."),null];if(!n.refreshToken&&n.accessToken&&n.expiresAt&&n.expiresAt<=Date.now()/1e3)return[new q(w.MISSING_REFRESH_TOKEN,"The access token has expired and a refresh token was not provided. The user needs to re-authenticate."),null];if(n.refreshToken&&(t.refresh||!n.expiresAt||n.expiresAt<=Date.now()/1e3)){let[e,a]=await aK(this,k,"m",C).call(this,n,{audience:t.audience,scope:t.scope?r:void 0,requestedScope:r});return e?[e,null]:[null,{tokenSet:a.updatedTokenSet,idTokenClaims:a.idTokenClaims}]}return[null,{tokenSet:n,idTokenClaims:void 0}]}async backchannelAuthentication(e){let[t,r]=await this.discoverAuthorizationServerMetadata();if(t)return[t,null];if(!r.backchannel_authentication_endpoint)return[new $,null];let n=n6(this.authorizationParameters,e.authorizationParams,aU);n.get("scope")||n.set("scope",V),n.set("client_id",this.clientMetadata.client_id),n.set("binding_message",e.bindingMessage),n.set("login_hint",JSON.stringify({format:"iss_sub",iss:r.issuer,sub:e.loginHint.sub})),e.requestedExpiry&&n.append("requested_expiry",e.requestedExpiry.toString()),e.authorizationDetails&&n.append("authorization_details",JSON.stringify(e.authorizationDetails));let[a,i]=await this.getOpenIdClientConfig();if(a)return[a,null];try{let e=await nQ(i,n),t=await n0(i,e),r=Math.floor(Date.now()/1e3)+Number(t.expires_in);return[null,{tokenSet:{accessToken:t.access_token,idToken:t.id_token,scope:t.scope,refreshToken:t.refresh_token,expiresAt:r},idTokenClaims:t.claims(),authorizationDetails:t.authorization_details}]}catch(e){return[new J({cause:new D({code:e.error,message:e.error_description})}),null]}}async discoverAuthorizationServerMetadata(){if(this.authorizationServerMetadata)return[null,this.authorizationServerMetadata];let e=new URL(this.issuer);try{let t=await eE(e,{...this.httpOptions(),[ea]:this.fetch,[et]:this.allowInsecureRequests}).then(t=>ev(e,t));return this.authorizationServerMetadata=t,[null,t]}catch(t){return console.error(`An error occurred while performing the discovery request. issuer=${e.toString()}, error:`,t),[new H("Discovery failed for the OpenID Connect configuration."),null]}}async defaultOnCallback(e,t){return e?new x.NextResponse(e.message,{status:500}):x.NextResponse.redirect(aN(t.returnTo||"/",this.appBaseUrl))}async handleCallbackError(e,t,r,n){let a=await this.onCallback(e,t,null);return n&&await this.transactionStore.delete(a.cookies,n),a}async verifyLogoutToken(e){let t,r,[n,a]=await this.discoverAuthorizationServerMetadata();if(n)return[n,null];let i=(t=new rX(new URL(a.jwks_uri),{[rV]:this.jwksCache}),Object.defineProperties(r=async(e,r)=>t.getKey(e,r),{coolingDown:{get:()=>t.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>t.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>t.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>t.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>t.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r),{payload:s}=await nd(e,i,{issuer:a.issuer,audience:this.clientMetadata.client_id,algorithms:["RS256"],requiredClaims:["iat"]});return"sid"in s||"sub"in s?"sid"in s&&"string"!=typeof s.sid?[new L('"sid" claim must be a string'),null]:"sub"in s&&"string"!=typeof s.sub?[new L('"sub" claim must be a string'),null]:"nonce"in s?[new L('"nonce" claim is prohibited'),null]:"events"in s?"object"!=typeof s.events||null===s.events?[new L('"events" claim must be an object'),null]:"http://schemas.openid.net/event/backchannel-logout"in s.events?"object"!=typeof s.events["http://schemas.openid.net/event/backchannel-logout"]?[new L('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object'),null]:[null,{sid:s.sid,sub:s.sub}]:[new L('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim'),null]:[new L('"events" claim is missing'),null]:[new L('either "sid" or "sub" (or both) claims must be present'),null]}async authorizationUrl(e){let[t,r]=await this.discoverAuthorizationServerMetadata();if(t)return[t,null];if(this.pushedAuthorizationRequests&&!r.pushed_authorization_request_endpoint)return console.error("The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par"),[Error("The authorization server does not support pushed authorization requests."),null];let n=new URL(r.authorization_endpoint);if(this.pushedAuthorizationRequests){let t,a=await eJ(r,this.clientMetadata,await this.getClientAuth(),e,{...this.httpOptions(),[ea]:this.fetch,[et]:this.allowInsecureRequests});try{t=await e1(r,this.clientMetadata,a)}catch(e){return[new M({cause:new D({code:e.error,message:e.error_description}),message:"An error occurred while pushing the authorization request."}),null]}return n.searchParams.set("request_uri",t.request_uri),n.searchParams.set("client_id",this.clientMetadata.client_id),[null,n]}return n.search=e.toString(),[null,n]}async getClientAuth(){if(!this.clientSecret&&!this.clientAssertionSigningKey)throw Error("The client secret or client assertion signing key must be provided.");let e=this.clientAssertionSigningKey;return e&&"string"==typeof e&&(e=await rL(e,this.clientAssertionSigningAlg)),e?function(e,t){let{key:r,kid:n}=e instanceof CryptoKey?{key:e}:e?.key instanceof CryptoKey?(void 0!==e.kid&&e_(e.kid,'"kid"'),{key:e.key,kid:e.kid}):{};return em(r,'"clientPrivateKey.key"'),async(e,t,a,i)=>{let s,o={alg:eR(r),kid:n},c=(s=eI()+eO(t),{jti:eP(),aud:e.issuer,exp:s+60,iat:s,nbf:s,iss:t.client_id,sub:t.client_id});a.set("client_id",t.client_id),a.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),a.set("client_assertion",await eU(o,c,r))}}(e):eK(this.clientSecret)}get issuer(){return this.domain.startsWith("http://")||this.domain.startsWith("https://")?this.domain:`https://${this.domain}`}async getConnectionTokenSet(e,t,r){if(!e.refreshToken&&(!t||t.expiresAt<=Date.now()/1e3))return[new z(g.MISSING_REFRESH_TOKEN,"A refresh token was not present, Connection Access Token requires a refresh token. The user needs to re-authenticate."),null];if(e.refreshToken&&(!t||t.expiresAt<=Date.now()/1e3)){let t,n=new URLSearchParams;n.append("connection",r.connection);let a=r.subject_token_type??A.SUBJECT_TYPE_REFRESH_TOKEN,i=a===A.SUBJECT_TYPE_ACCESS_TOKEN?e.accessToken:e.refreshToken;n.append("subject_token_type",a),n.append("subject_token",i),n.append("requested_token_type","http://auth0.com/oauth/token-type/federated-connection-access-token"),r.login_hint&&n.append("login_hint",r.login_hint);let[s,o]=await this.discoverAuthorizationServerMetadata();if(s)return[s,null];let c=this.useDPoP&&this.dpopKeyPair?eB(this.clientMetadata,this.dpopKeyPair):void 0,u=async()=>tD(o,this.clientMetadata,await this.getClientAuth(),"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",n,{[ea]:this.fetch,[et]:this.allowInsecureRequests,...c&&{DPoP:c}}),l=async()=>{let e=await u();return tH(o,this.clientMetadata,e)};try{t=await tY(l,{isDPoPEnabled:!!(this.useDPoP&&this.dpopKeyPair),...this.dpopOptions?.retry})}catch(e){return[new z(g.FAILED_TO_EXCHANGE,"There was an error trying to exchange the refresh token for a connection access token.",new D({code:e.error,message:e.error_description})),null]}return[null,{accessToken:t.access_token,expiresAt:Math.floor(Date.now()/1e3)+Number(t.expires_in),scope:t.scope,connection:r.connection}]}return[null,t]}async finalizeSession(e,t){if(this.beforeSessionSaved)e={...await this.beforeSessionSaved(e,t??null),internal:e.internal};else{var r;e.user=Object.keys(r=e.user).reduce((e,t)=>(aH.includes(t)&&(e[t]=r[t]),e),{})}return e}async connectAccount(e){let t=aN(this.routes.callback,this.appBaseUrl),r=this.signInReturnToPath;if(e.returnTo){let t=new URL(this.authorizationParameters.redirect_uri||this.appBaseUrl),n=an(e.returnTo,t);n&&(r=n.pathname+n.search+n.hash)}let n=eP(),a=await eC(n),i=eP(),[s,o]=await this.createConnectAccountTicket({tokenSet:e.tokenSet,connection:e.connection,redirectUri:t.toString(),state:i,codeChallenge:a,codeChallengeMethod:"S256",authorizationParams:e.authorizationParams});if(s)return[s,null];let c={codeVerifier:n,responseType:E.CONNECT_CODE,state:i,returnTo:r,authSession:o.authSession},u=x.NextResponse.redirect(`${o.connectUri}?ticket=${encodeURIComponent(o.connectParams.ticket)}`);return await this.transactionStore.save(u.cookies,c),[null,u]}async createConnectAccountTicket(e){try{let t=new URL("/me/v1/connected-accounts/connect",this.issuer),r=await this.fetcherFactory({useDPoP:this.useDPoP,getAccessToken:async()=>({accessToken:e.tokenSet.accessToken,expiresAt:e.tokenSet.expiresAt||0,scope:e.tokenSet.scope,token_type:e.tokenSet.token_type}),fetch:this.fetch}),n=this.httpOptions();new Headers(n.headers).set("Content-Type","application/json");let a={connection:e.connection,redirect_uri:e.redirectUri,state:e.state,code_challenge:e.codeChallenge,code_challenge_method:e.codeChallengeMethod,authorization_params:e.authorizationParams},i=await r.fetchWithAuth(t.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)try{let e=await i.json();return[new G({code:b.FAILED_TO_INITIATE,message:`The request to initiate the connect account flow failed with status ${i.status}.`,cause:new F({type:e.type,title:e.title,detail:e.detail,status:i.status,validationErrors:e.validation_errors})}),null]}catch(e){return[new G({code:b.FAILED_TO_INITIATE,message:`The request to initiate the connect account flow failed with status ${i.status}.`}),null]}let{connect_uri:s,connect_params:o,auth_session:c,expires_in:u}=await i.json();return[null,{connectUri:s,connectParams:o,authSession:c,expiresIn:u}]}catch(t){let e="An unexpected error occurred while trying to initiate the connect account flow.";return t instanceof B&&(e=t.message),[new G({code:b.FAILED_TO_INITIATE,message:e}),null]}}async completeConnectAccount(e){let t=new URL("/me/v1/connected-accounts/complete",this.issuer);try{let r=this.httpOptions();new Headers(r.headers).set("Content-Type","application/json");let n=await this.fetcherFactory({useDPoP:this.useDPoP,getAccessToken:async()=>({accessToken:e.tokenSet.accessToken,expiresAt:e.tokenSet.expiresAt||0,scope:e.tokenSet.scope,token_type:e.tokenSet.token_type}),fetch:this.fetch}),a={auth_session:e.authSession,connect_code:e.connectCode,redirect_uri:e.redirectUri,code_verifier:e.codeVerifier},i=await n.fetchWithAuth(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)try{let e=await i.json();return[new G({code:b.FAILED_TO_COMPLETE,message:`The request to complete the connect account flow failed with status ${i.status}.`,cause:new F({type:e.type,title:e.title,detail:e.detail,status:i.status,validationErrors:e.validation_errors})}),null]}catch(e){return[new G({code:b.FAILED_TO_COMPLETE,message:`The request to complete the connect account flow failed with status ${i.status}.`}),null]}let{id:s,connection:o,access_type:c,scopes:u,created_at:l,expires_at:d}=await i.json();return[null,{id:s,connection:o,accessType:c,scopes:u,createdAt:l,expiresAt:d}]}catch(e){return[new G({code:b.FAILED_TO_COMPLETE,message:"An unexpected error occurred while trying to complete the connect account flow."}),null]}}async getOpenIdClientConfig(){let[e,t]=await this.discoverAuthorizationServerMetadata();if(e)return[e,null];let r=new nX(t,this.clientMetadata.client_id,{},await this.getClientAuth()),n=new Headers(this.httpOptions().headers);return r[ea]=(...e)=>{let t=new Headers(e[1].headers);return this.fetch(e[0],{...e[1],body:e[1].body,headers:new Headers([...n,...t])})},r.timeout=this.httpTimeout,this.allowInsecureRequests&&(c.get(r).tlsOnly=!1),[null,r]}async fetcherFactory(e){if(this.useDPoP&&!this.dpopKeyPair)throw new B(S.DPOP_CONFIGURATION_ERROR,"DPoP is enabled but no keypair is configured.");let[t,r]=await this.discoverAuthorizationServerMetadata();if(t)throw t;return new aD({dpopHandle:this.useDPoP&&(e.useDPoP??!0)?eB(this.clientMetadata,this.dpopKeyPair):void 0,httpOptions:this.httpOptions,allowInsecureRequests:this.allowInsecureRequests,retryConfig:this.dpopOptions?.retry,fetch:e.fetch,getAccessToken:e.getAccessToken,baseUrl:e.baseUrl},{getAccessToken:e.getAccessToken,isDpopEnabled:()=>e.useDPoP??this.useDPoP??!1})}}k=new WeakSet,_=function(e,t){var r;let n,a=e.tokenSet,i=t.audience,s=t.scope,o=!i||i===(a.audience||this.authorizationParameters.audience),c=!s||t1(a.requestedScope||tZ(this.authorizationParameters.scope,i),s);return o&&c?a:(i&&(n=t5(e,{scope:s,audience:i})),r=n,{...a,accessToken:r?.accessToken,expiresAt:r?.expiresAt,scope:r?.scope,requestedScope:r?.requestedScope,audience:r?.audience,...r?.token_type&&{token_type:r.token_type}})},v=async function(e,t){let r=ae(e),n=ar(e,t);r.set("host",n.host);try{let e=await this.fetch(n.toString(),{method:"OPTIONS",headers:r});return new x.NextResponse(null,{status:e.status,headers:at(e)})}catch(e){return new x.NextResponse(e.cause||e.message||"Preflight request failed",{status:500})}},T=async function(e,t){let r,n=await this.sessionStore.get(e.cookies);if(!n)return new x.NextResponse("The user does not have an active session.",{status:401});if("OPTIONS"===e.method&&e.headers.has("access-control-request-method"))return aK(this,k,"m",v).call(this,e,t);let a=ae(e),i=this.useDPoP?e.clone():e,s=ar(e,t);a.set("host",s.host);let o=i.body?await i.arrayBuffer():void 0,c=async e=>{let[t,a]=await this.getTokenSet(n,{audience:e.audience,scope:e.scope});if(t)throw t;return r=a,a.tokenSet},u=this.proxyFetchers[t.audience];u?u.getAccessToken=c:(u=await this.fetcherFactory({useDPoP:this.useDPoP,fetch:this.fetch,getAccessToken:c}),this.proxyFetchers[t.audience]=u);try{let c=await u.fetchWithAuth(s.toString(),{method:i.method,headers:a,body:o},{scope:t.scope,audience:t.audience}),l=new x.NextResponse(c.body,{status:c.status,statusText:c.statusText,headers:at(c)});return r&&await aK(this,k,"m",P).call(this,e,l,n,r),l}catch(e){if(e instanceof q&&e.code===w.MISSING_REFRESH_TOKEN)return new x.NextResponse(e.message,{status:401});return new x.NextResponse(e.cause||e.message||"An error occurred while proxying the request.",{status:500})}},P=async function(e,t,r,n){let a=t6(r,n.tokenSet,{scope:this.authorizationParameters?.scope??V,audience:this.authorizationParameters?.audience});if(a){n.idTokenClaims&&(r.user=n.idTokenClaims);let i=await this.finalizeSession({...r,...a},n.tokenSet.idToken);await this.sessionStore.set(e.cookies,t.cookies,i),ax(t)}},C=async function(e,t){let r,[n,a]=await this.discoverAuthorizationServerMetadata();if(n)return[n,null];let i=new URLSearchParams;t.scope&&i.append("scope",t.scope),t.audience&&i.append("audience",t.audience);let s=this.useDPoP&&this.dpopKeyPair?eB(this.clientMetadata,this.dpopKeyPair):void 0,o=async()=>e7(a,this.clientMetadata,await this.getClientAuth(),e.refreshToken,{...this.httpOptions(),[ea]:this.fetch,[et]:this.allowInsecureRequests,additionalParameters:i,...s&&{DPoP:s}}),c=e=>ti(a,this.clientMetadata,e);try{r=await tY(async()=>{let e=await o();return await c(e)},{isDPoPEnabled:!!(this.useDPoP&&this.dpopKeyPair),...this.dpopOptions?.retry})}catch(e){return[new q(w.FAILED_TO_REFRESH_TOKEN,"The access token has expired and there was an error while trying to refresh it.",new D({code:e.error,message:e.error_description})),null]}let u=tr(r),l=Math.floor(Date.now()/1e3)+Number(r.expires_in),d={...e,accessToken:r.access_token,idToken:r.id_token,scope:r.scope,requestedScope:t.requestedScope,expiresAt:l,audience:e.audience||t.audience||void 0,...r.token_type&&{token_type:r.token_type}};return r.refresh_token?d.refreshToken=r.refresh_token:d.refreshToken=e.refreshToken,[null,{updatedTokenSet:d,idTokenClaims:u}]};let aj=e=>{let t=new TextEncoder().encode(e),r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))};class aW{constructor({secret:e,rolling:t=!0,absoluteDuration:r=259200,inactivityDuration:n=86400,store:a,cookieOptions:i}){this.secret=e,this.rolling=t,this.absoluteDuration=r,this.inactivityDuration=n,this.store=a,this.sessionCookieName=i?.name??"__session",this.cookieConfig={httpOnly:!0,sameSite:i?.sameSite??"lax",secure:i?.secure??!1,path:i?.path??"/",domain:i?.domain,transient:i?.transient}}epoch(){return Date.now()/1e3|0}calculateMaxAge(e){if(!this.rolling)return this.absoluteDuration;let t=this.epoch(),r=Math.min(t+this.inactivityDuration,e+this.absoluteDuration)-t;return r>0?r:0}}let aL="appSession";function a$(e,t){let r=t.user;return{user:r,tokenSet:{idToken:t.idToken??void 0,accessToken:t.accessToken??void 0,scope:t.accessTokenScope,refreshToken:t.refreshToken,expiresAt:t.accessTokenExpiresAt},internal:{sid:r.sid,createdAt:e.iat}}}let aJ=()=>{let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")};class aq extends aW{constructor({secret:e,store:t,rolling:r,absoluteDuration:n,inactivityDuration:a,cookieOptions:i}){super({secret:e,rolling:r,absoluteDuration:n,inactivityDuration:a,cookieOptions:i}),this.store=t}async get(e){let t=e.get(this.sessionCookieName)||e.get(aL);if(!t||!t.value)return null;let r=null;try{let e=await ak(t.value,this.secret);if(null===e)return null;r=e.payload.id}catch(e){if("ERR_JWE_INVALID"===e.code){let e=await a_(t.name,t.value,this.secret);if(!e)return null;r=e}}if(!r)return null;let n=await this.store.get(r);return n?n.header?.iat?a$(n.header,n.data):n:null}async set(e,t,r,n=!1){let a=null,i=e.get(this.sessionCookieName)?.value;if(i){let e=await ak(i,this.secret);e&&(a=e.payload.id)}a&&n&&(await this.store.delete(a),a=aJ()),a||(a=aJ());let s=this.calculateMaxAge(r.internal.createdAt),o=this.epoch(),c=await aE({id:a},this.secret,o+s);t.set(this.sessionCookieName,c.toString(),{...this.cookieConfig,maxAge:s}),await this.store.set(a,r),e.set(this.sessionCookieName,c.toString()),this.sessionCookieName!==aL&&e.has(aL)&&aI(t,aL,{domain:this.cookieConfig.domain,path:this.cookieConfig.path})}async delete(e,t){let r=e.get(this.sessionCookieName)?.value;if(aI(t,this.sessionCookieName,{domain:this.cookieConfig.domain,path:this.cookieConfig.path}),!r)return;let n=await ak(r,this.secret);n&&await this.store.delete(n.payload.id)}}class az extends aW{constructor({secret:e,rolling:t,absoluteDuration:r,inactivityDuration:n,cookieOptions:a}){super({secret:e,rolling:t,absoluteDuration:r,inactivityDuration:n,cookieOptions:a}),this.connectionTokenSetsCookieName="__FC"}async get(e){let t=aR(this.sessionCookieName,e)??aR(aL,e,!0);if(!t)return null;let r=await ak(t,this.secret);if(!r)return null;let n=r.protectedHeader.iat?a$(r.protectedHeader,r.payload):r.payload,a=this.getConnectionTokenSetsCookies(e),i=[];for(let e of a){let t=await ak(e.value,this.secret);t&&i.push(t.payload)}return{...n,...i.length?{connectionTokenSets:i}:{}}}async set(e,t,r){let{connectionTokenSets:n,...a}=r,i=this.calculateMaxAge(r.internal.createdAt),s=this.epoch(),o=(await aE(a,this.secret,s+i)).toString(),c={...this.cookieConfig,maxAge:i};!function(e,t,r,n,a){let{transient:i,...s}=r,o={...s};if(i&&delete o.maxAge,new TextEncoder().encode(t).length<=3500){a.set(e,t,o),n.set(e,t),aC(n,e).forEach(e=>{aI(a,e.name,{path:o.path,domain:o.domain}),n.delete(e.name)});return}let c=0,u=0;for(;c<t.length;){let r=t.slice(c,c+3500),i=`${e}__${u}`;a.set(i,r,o),n.set(i,r),c+=3500,u++}let l=aC(n,e).length-u;if(l>0)for(let t=0;t<l;t++){let r=u+t,i=`${e}__${r}`;aI(a,i,{path:o.path,domain:o.domain}),n.delete(i)}aI(a,e,{path:o.path,domain:o.domain}),n.delete(e)}(this.sessionCookieName,o,c,e,t),n?.length&&await Promise.all(n.map((r,n)=>this.storeInCookie(e,t,r,`${this.connectionTokenSetsCookieName}_${n}`,i))),aR(aL,e,!0)&&aO(aL,e,t,!0,{domain:this.cookieConfig.domain,path:this.cookieConfig.path})}async delete(e,t){let r={domain:this.cookieConfig.domain,path:this.cookieConfig.path};aO(this.sessionCookieName,e,t,!1,r),this.getConnectionTokenSetsCookies(e).forEach(e=>aI(t,e.name,r))}async storeInCookie(e,t,r,n,a){let i=Math.floor(Date.now()/1e3+a),s=await aE(r,this.secret,i),o=s.toString();t.set(n,s.toString(),{...this.cookieConfig,maxAge:a}),e.set(n,o);let c=new au(new Headers);c.set(n,o,{...this.cookieConfig,maxAge:a}),new TextEncoder().encode(c.toString()).length>=4096&&(n===this.sessionCookieName?console.warn(`The ${n} cookie size exceeds 4096 bytes, which may cause issues in some browsers. Consider removing any unnecessary custom claims from the access token or the user profile. Alternatively, you can use a stateful session implementation to store the session data in a data store.`):console.warn(`The ${n} cookie size exceeds 4096 bytes, which may cause issues in some browsers. You can use a stateful session implementation to store the session data in a data store.`))}getConnectionTokenSetsCookies(e){return e.getAll().filter(e=>e.name.startsWith(this.connectionTokenSetsCookieName))}}class aB{constructor({secret:e,cookieOptions:t,enableParallelTransactions:r}){this.secret=e,this.transactionCookiePrefix=t?.prefix??"__txn_",this.cookieOptions={httpOnly:!0,sameSite:t?.sameSite??"lax",secure:t?.secure??!1,path:t?.path??"/",domain:t?.domain,maxAge:t?.maxAge||3600},this.enableParallelTransactions=r??!0}getTransactionCookieName(e){return this.enableParallelTransactions?`${this.transactionCookiePrefix}${e}`:`${this.transactionCookiePrefix}`}getCookiePrefix(){return this.transactionCookiePrefix}async save(e,t,r){if(!t.state)throw Error("Transaction state is required");if(r&&!this.enableParallelTransactions){let e=this.getTransactionCookieName(t.state);if(r.get(e))return void console.warn("A transaction is already in progress. Only one transaction is allowed when parallel transactions are disabled.")}let n=this.cookieOptions.maxAge,a=Math.floor(Date.now()/1e3+n),i=await aE(t,this.secret,a);e.set(this.getTransactionCookieName(t.state),i.toString(),this.cookieOptions)}async get(e,t){let r=this.getTransactionCookieName(t),n=e.get(r)?.value;return n?ak(n,this.secret):null}async delete(e,t){aI(e,this.getTransactionCookieName(t),{domain:this.cookieOptions.domain,path:this.cookieOptions.path})}async deleteAll(e,t){let r=this.getCookiePrefix(),n={domain:this.cookieOptions.domain,path:this.cookieOptions.path};e.getAll().forEach(e=>{e.name.startsWith(r)&&aI(t,e.name,n)})}}var aF=function(e,t,r,n,a){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r},aG=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};R=new WeakMap;let aV=new class{constructor(e={}){R.set(this,void 0),aF(this,R,e,"f");const{domain:t,clientId:r,clientSecret:n,appBaseUrl:a,secret:i,clientAssertionSigningKey:s}=this.validateAndExtractRequiredOptions(e);this.domain=t;const o=e.clientAssertionSigningAlg||process.env.AUTH0_CLIENT_ASSERTION_SIGNING_ALG,{dpopKeyPair:c,dpopOptions:u}=function(e){let t=e.useDPoP||!1;if(!t)return{dpopKeyPair:void 0,dpopOptions:void 0};let r=e.dpopOptions?.clockTolerance??(process.env.AUTH0_DPOP_CLOCK_TOLERANCE?parseInt(process.env.AUTH0_DPOP_CLOCK_TOLERANCE,10):30);if(r>300){let e=process.env.AUTH0_DPOP_CLOCK_TOLERANCE_MAX_PROD?parseInt(process.env.AUTH0_DPOP_CLOCK_TOLERANCE_MAX_PROD,10):300;if(r>e)throw Error(`clockTolerance of ${r}s exceeds maximum allowed ${e}s in production. This could significantly weaken DPoP replay attack protection. Set AUTH0_DPOP_CLOCK_TOLERANCE_MAX_PROD environment variable to override this limit in production.`);console.warn(`WARNING: clockTolerance of ${r}s exceeds recommended maximum of 300s. This may weaken DPoP security by allowing replay attacks within a wider time window. Consider synchronizing server clocks using NTP instead of increasing tolerance.`)}let n={clockSkew:e.dpopOptions?.clockSkew??(process.env.AUTH0_DPOP_CLOCK_SKEW?parseInt(process.env.AUTH0_DPOP_CLOCK_SKEW,10):0),clockTolerance:r,retry:{delay:e.dpopOptions?.retry?.delay??(process.env.AUTH0_RETRY_DELAY?parseInt(process.env.AUTH0_RETRY_DELAY,10):100),jitter:e.dpopOptions?.retry?.jitter??(!process.env.AUTH0_RETRY_JITTER||"true"===process.env.AUTH0_RETRY_JITTER)}};if(n.retry&&"number"==typeof n.retry.delay&&n.retry.delay<0)throw Error("Retry delay must be non-negative");if(e.dpopKeyPair)return{dpopKeyPair:e.dpopKeyPair,dpopOptions:n};if(t){let e=process.env.AUTH0_DPOP_PRIVATE_KEY,t=process.env.AUTH0_DPOP_PUBLIC_KEY;if(tV()&&(e||t))return console.warn("WARNING: Running in Edge Runtime environment. DPoP keypair loading from environment variables is not supported due to limited Node.js crypto API access. DPoP has been disabled. To use DPoP in Edge Runtime, provide a pre-generated keypair via the dpopKeyPair option."),{dpopKeyPair:void 0,dpopOptions:void 0};if(e&&t)try{let r=(0,X.createPrivateKey)(e),a=(0,X.createPublicKey)(t);if("ec"!==r.asymmetricKeyType)throw Error(`DPoP private key must be an Elliptic Curve key for ES256 algorithm, got: ${r.asymmetricKeyType}`);if("ec"!==a.asymmetricKeyType)throw Error(`DPoP public key must be an Elliptic Curve key for ES256 algorithm, got: ${a.asymmetricKeyType}`);let i=r.asymmetricKeyDetails,s=a.asymmetricKeyDetails;if(i?.namedCurve!=="prime256v1")throw Error(`DPoP private key must use P-256 curve (prime256v1) for ES256 algorithm, got: ${i?.namedCurve}`);if(s?.namedCurve!=="prime256v1")throw Error(`DPoP public key must use P-256 curve (prime256v1) for ES256 algorithm, got: ${s?.namedCurve}`);if(!function(e,t){if(tV())return!0;try{let r="test-data-for-key-pair-validation",n=(0,X.createSign)("sha256");n.update(r);let a=n.sign(e),i=(0,X.createVerify)("sha256");if(i.update(r),!i.verify(t,a))return console.warn("WARNING: Private and public keys do not form a valid key pair - signature verification failed. Please ensure the keys are properly paired and in the correct format. DPoP will be disabled and bearer authentication will be used instead."),!1;return!0}catch(e){return console.warn(`WARNING: Failed to validate key pair compatibility. This may indicate invalid key format, mismatched algorithms, or corrupted key data. DPoP will be disabled and bearer authentication will be used instead. Error: ${e instanceof Error?e.message:String(e)}`),!1}}(r,a))return console.warn("WARNING: DPoP key pair validation failed. DPoP has been completely disabled. Falling back to bearer authentication. Please verify your key pair configuration."),{dpopKeyPair:void 0,dpopOptions:void 0};let o=r.toCryptoKey("ES256",!1,["sign"]),c=a.toCryptoKey("ES256",!1,["verify"]);return{dpopKeyPair:{privateKey:o,publicKey:c},dpopOptions:n}}catch(e){console.warn(`WARNING: Failed to load DPoP keypair from environment variables. Please ensure AUTH0_DPOP_PUBLIC_KEY and AUTH0_DPOP_PRIVATE_KEY contain valid ES256 keys in PEM format. Error: ${e instanceof Error?e.message:String(e)}`)}e&&t||console.warn("WARNING: useDPoP is set to true but dpopKeyPair is not provided. DPoP will not be used and protected requests will use bearer authentication instead. To enable DPoP, provide a dpopKeyPair in the Auth0Client options or set AUTH0_DPOP_PUBLIC_KEY and AUTH0_DPOP_PRIVATE_KEY environment variables.")}return{dpopKeyPair:void 0,dpopOptions:n}}(e),l=process.env.NEXT_PUBLIC_BASE_PATH,d={name:e.session?.cookie?.name??"__session",secure:e.session?.cookie?.secure??"true"===process.env.AUTH0_COOKIE_SECURE,sameSite:e.session?.cookie?.sameSite??process.env.AUTH0_COOKIE_SAME_SITE??"lax",path:e.session?.cookie?.path??process.env.AUTH0_COOKIE_PATH??l??"/",transient:e.session?.cookie?.transient??"true"===process.env.AUTH0_COOKIE_TRANSIENT,domain:e.session?.cookie?.domain??process.env.AUTH0_COOKIE_DOMAIN},h={prefix:e.transactionCookie?.prefix??"__txn_",secure:e.transactionCookie?.secure??!1,sameSite:e.transactionCookie?.sameSite??"lax",path:e.transactionCookie?.path??l??"/",maxAge:e.transactionCookie?.maxAge??3600};if(a){const{protocol:e}=new URL(a);"https:"===e&&(d.secure=!0,h.secure=!0)}this.routes={login:process.env.NEXT_PUBLIC_LOGIN_ROUTE||"/auth/login",logout:"/auth/logout",callback:"/auth/callback",backChannelLogout:"/auth/backchannel-logout",profile:process.env.NEXT_PUBLIC_PROFILE_ROUTE||"/auth/profile",accessToken:process.env.NEXT_PUBLIC_ACCESS_TOKEN_ROUTE||"/auth/access-token",connectAccount:"/auth/connect",...e.routes},this.transactionStore=new aB({secret:i,cookieOptions:h,enableParallelTransactions:e.enableParallelTransactions??!0}),this.sessionStore=e.sessionStore?new aq({...e.session,secret:i,store:e.sessionStore,cookieOptions:d}):new az({...e.session,secret:i,cookieOptions:d}),this.authClient=new aM({transactionStore:this.transactionStore,sessionStore:this.sessionStore,domain:t,clientId:r,clientSecret:n,clientAssertionSigningKey:s,clientAssertionSigningAlg:o,authorizationParameters:e.authorizationParameters,pushedAuthorizationRequests:e.pushedAuthorizationRequests,appBaseUrl:a,secret:i,signInReturnToPath:e.signInReturnToPath,logoutStrategy:e.logoutStrategy,includeIdTokenHintInOIDCLogoutUrl:e.includeIdTokenHintInOIDCLogoutUrl,beforeSessionSaved:e.beforeSessionSaved,onCallback:e.onCallback,routes:this.routes,allowInsecureRequests:e.allowInsecureRequests,httpTimeout:e.httpTimeout,enableTelemetry:e.enableTelemetry,enableAccessTokenEndpoint:e.enableAccessTokenEndpoint,noContentProfileResponseWhenUnauthenticated:e.noContentProfileResponseWhenUnauthenticated,enableConnectAccountEndpoint:e.enableConnectAccountEndpoint,useDPoP:e.useDPoP||!1,dpopKeyPair:e.dpopKeyPair||c,dpopOptions:e.dpopOptions||u})}middleware(e){return this.authClient.handler.bind(this.authClient)(e)}async getSession(e){return e?e instanceof x.NextRequest?this.sessionStore.get(e.cookies):this.sessionStore.get(this.createRequestCookies(e)):this.sessionStore.get(await (0,O.cookies)())}async getAccessToken(e,t,r){let n,a,i={refresh:!1},s={};if(e&&(e instanceof Request||"object"==typeof e.headers)){if(n=e,a=t,s={...i,...r??{}},!a)throw TypeError("getAccessToken(req, res): The 'res' argument is missing. Both 'req' and 'res' must be provided together for Pages Router or middleware usage.")}else{if(void 0!==t||void 0!==r)throw TypeError("getAccessToken: Invalid arguments. Valid signatures are getAccessToken(), getAccessToken(options), or getAccessToken(req, res, options).");s={...i,...e??{}}}return this.executeGetAccessToken(n,a,s)}async executeGetAccessToken(e,t,r){let n=e?await this.getSession(e):await this.getSession();if(!n)throw new q(w.MISSING_SESSION,"The user does not have an active session.");let[a,i]=await this.authClient.getTokenSet(n,r);if(a)throw a;let{tokenSet:s,idTokenClaims:o}=i,c=t6(n,s,{scope:aG(this,R,"f").authorizationParameters?.scope??V,audience:aG(this,R,"f").authorizationParameters?.audience});if(c){o&&(n.user=o);let r=await this.authClient.finalizeSession(n,s.idToken);await this.saveToSession({...r,...c},e,t)}return{token:s.accessToken,scope:s.scope,expiresAt:s.expiresAt,token_type:s.token_type,audience:s.audience}}async getAccessTokenForConnection(e,t,r){let n=t?await this.getSession(t):await this.getSession();if(!n)throw new z(g.MISSING_SESSION,"The user does not have an active session.");let a=n.connectionTokenSets?.find(t=>t.connection===e.connection),[i,s]=await this.authClient.getConnectionTokenSet(n.tokenSet,a,e);if(null!==i)throw i;if(s&&(!a||s.accessToken!==a.accessToken||s.expiresAt!==a.expiresAt||s.scope!==a.scope)){let i;i=a?n.connectionTokenSets?.map(t=>t.connection===e.connection?s:t):[...n.connectionTokenSets||[],s],await this.saveToSession({...n,connectionTokenSets:i},t,r)}return{token:s.accessToken,scope:s.scope,expiresAt:s.expiresAt}}async updateSession(e,t,r){if(t){if(!r)throw Error("The session data is missing.");if(e instanceof x.NextRequest&&t instanceof x.NextResponse){let n=await this.getSession(e);if(!n)throw Error("The user is not authenticated.");await this.sessionStore.set(e.cookies,t.cookies,{...r,internal:{...n.internal}})}else{let n=await this.getSession(e);if(!n)throw Error("The user is not authenticated.");let a=new Headers,i=new au(a),s=this.createRequestCookies(e);await this.sessionStore.set(s,i,{...r,internal:{...n.internal}});let o=[],c={};for(let[e,t]of a.entries())"set-cookie"===e.toLowerCase()?o.push(t):c[e]=t;for(let[e,r]of(o.length>0&&t.setHeader("set-cookie",o),Object.entries(c)))t.setHeader(e,r)}}else{let t=await this.getSession();if(!t)throw Error("The user is not authenticated.");if(!e)throw Error("The session data is missing.");await this.sessionStore.set(await (0,O.cookies)(),await (0,O.cookies)(),{...e,internal:{...t.internal}})}}createRequestCookies(e){let t=new Headers;for(let r in e.headers)if(Array.isArray(e.headers[r]))for(let n of e.headers[r])t.append(r,n);else t.append(r,e.headers[r]??"");return new ac(t)}async startInteractiveLogin(e={}){return this.authClient.startInteractiveLogin(e)}async getTokenByBackchannelAuth(e){let[t,r]=await this.authClient.backchannelAuthentication(e);if(t)throw t;return r}async connectAccount(e){if(!await this.getSession())throw new G({code:b.MISSING_SESSION,message:"The user does not have an active session."});let t={audience:`${this.issuer}/me/`,scope:"create:me:connected_accounts"},r=await this.getAccessToken(t),[n,a]=await this.authClient.connectAccount({...e,tokenSet:{accessToken:r.token,expiresAt:r.expiresAt,scope:t.scope,audience:r.audience}});if(n)throw n;return a}withPageAuthRequired(t,r){let n,a,i={loginUrl:this.routes.login},s=(n=this,(t,r={})=>async a=>{let s=await n.getSession();if(!s?.user){let t="function"==typeof r.returnTo?await r.returnTo(a):r.returnTo,{redirect:n}=await e.A(674061);n(`${i.loginUrl}${r.returnTo?`?returnTo=${t}`:""}`)}return t(a)}),o=(a=this,({getServerSideProps:e,returnTo:t}={})=>async r=>{let n=await a.getSession(r.req);if(!n?.user)return{redirect:{destination:`${i.loginUrl}?returnTo=${encodeURIComponent(t||r.resolvedUrl)}`,permanent:!1}};let s={props:{}};if(e&&(s=await e(r)),s.props instanceof Promise){let e=await s.props;return{...s,props:{user:n.user,...e}}}return{...s,props:{user:n.user,...s.props}}});return"function"==typeof t?s(t,r):o(t)}withApiAuthRequired(e){let t,r,n=(t=this,e=>async(r,n)=>{let a=await t.getSession(r);a&&a.user?await e(r,n):n.status(401).json({error:"not_authenticated",description:"The user does not have an active session or is not authenticated"})}),a=(r=this,e=>async(t,n)=>{let a=await r.getSession();if(!a||!a.user)return x.NextResponse.json({error:"not_authenticated",description:"The user does not have an active session or is not authenticated"},{status:401});let i=await e(t,n);return i instanceof x.NextResponse?i:new x.NextResponse(i.body,i)});return(t,r)=>t instanceof Request||t.headers instanceof Headers||"boolean"==typeof t.bodyUsed?a(e)(t,r):n(e)(t,r)}async saveToSession(e,t,r){if(t&&r)if(t instanceof x.NextRequest&&r instanceof x.NextResponse)await this.sessionStore.set(t.cookies,r.cookies,e);else{let n=new Headers,a=new au(n);for(let[i,s]of(await this.sessionStore.set(this.createRequestCookies(t),a,e),n.entries()))r.setHeader(i,s)}else try{await this.sessionStore.set(await (0,O.cookies)(),await (0,O.cookies)(),e)}catch(e){}}validateAndExtractRequiredOptions(e){let t={domain:e.domain??process.env.AUTH0_DOMAIN,clientId:e.clientId??process.env.AUTH0_CLIENT_ID,appBaseUrl:e.appBaseUrl??process.env.APP_BASE_URL,secret:e.secret??process.env.AUTH0_SECRET},r=e.clientSecret??process.env.AUTH0_CLIENT_SECRET,n=e.clientAssertionSigningKey??process.env.AUTH0_CLIENT_ASSERTION_SIGNING_KEY,a=Object.entries(t).filter(([,e])=>!e).map(([e])=>e);if(r||n||a.push("clientAuthentication"),a.length){let e={domain:"AUTH0_DOMAIN",clientId:"AUTH0_CLIENT_ID",appBaseUrl:"APP_BASE_URL",secret:"AUTH0_SECRET"},t="WARNING: Not all required options were provided when creating an instance of Auth0Client. Ensure to provide all missing options, either by passing it to the Auth0Client constructor, or by setting the corresponding environment variable.\n";a.forEach(r=>{"clientAuthentication"===r?t+=`Missing: clientAuthentication: Set either AUTH0_CLIENT_SECRET env var or AUTH0_CLIENT_ASSERTION_SIGNING_KEY env var, or pass clientSecret or clientAssertionSigningKey in options
`:e[r]?t+=`Missing: ${r}: Set ${e[r]} env var or pass ${r} in options
`:t+=`Missing: ${r}
`}),console.error(t.trim())}return{...t,clientSecret:r,clientAssertionSigningKey:n}}async createFetcher(e,t){let r=e?await this.getSession(e):await this.getSession();if(!r)throw new q(w.MISSING_SESSION,"The user does not have an active session.");let n=async e=>{let[t,n]=await this.authClient.getTokenSet(r,e||{});if(t)throw t;return n.tokenSet};return await this.authClient.fetcherFactory({...t,getAccessToken:n})}get issuer(){return this.domain.startsWith("http://")||this.domain.startsWith("https://")?this.domain:`https://${this.domain}`}};e.s(["auth0",0,aV],453321)},15270,e=>{"use strict";var t=e.i(29173);let r=globalThis.prisma??new t.PrismaClient({log:["error"]});e.s(["prisma",0,r])}];

//# sourceMappingURL=_e2372279._.js.map