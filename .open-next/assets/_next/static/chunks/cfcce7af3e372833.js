(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,630374,e=>{"use strict";var s=e.i(843476),t=e.i(326999),a=e.i(995926),i=e.i(647163);function n({...e}){return(0,s.jsx)(t.Root,{"data-slot":"dialog",...e})}function r({...e}){return(0,s.jsx)(t.Trigger,{"data-slot":"dialog-trigger",...e})}function l({...e}){return(0,s.jsx)(t.Portal,{"data-slot":"dialog-portal",...e})}function d({className:e,...a}){return(0,s.jsx)(t.Overlay,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...a})}function o({className:e,children:n,showCloseButton:r=!0,...o}){return(0,s.jsxs)(l,{"data-slot":"dialog-portal",children:[(0,s.jsx)(d,{}),(0,s.jsxs)(t.Content,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...o,children:[n,r&&(0,s.jsxs)(t.Close,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(a.XIcon,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function c({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",e),...t})}function m({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:(0,i.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function u({className:e,...a}){return(0,s.jsx)(t.Title,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",e),...a})}function g({className:e,...a}){return(0,s.jsx)(t.Description,{"data-slot":"dialog-description",className:(0,i.cn)("text-muted-foreground text-sm",e),...a})}e.s(["Dialog",()=>n,"DialogContent",()=>o,"DialogDescription",()=>g,"DialogFooter",()=>m,"DialogHeader",()=>c,"DialogTitle",()=>u,"DialogTrigger",()=>r])},555436,e=>{"use strict";let s=(0,e.i(475254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>s],555436)},704967,e=>{"use strict";function s(e){return!function(e){if(!e||"string"!=typeof e||!e.startsWith("data:image/"))return!1;let s=e.indexOf(",");if(-1===s)return!1;let t=e.substring(s+1);if(0===t.length)return!1;try{t.length>0&&atob(t.substring(0,Math.min(100,t.length)))}catch(e){return!1}return!0}(e)?null:e}e.s(["getValidImageUrl",()=>s])},643531,e=>{"use strict";var s=e.i(678745);e.s(["Check",()=>s.default])},263488,e=>{"use strict";let s=(0,e.i(475254).default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);e.s(["Mail",()=>s],263488)},879002,e=>{"use strict";let s=(0,e.i(475254).default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserPlus",()=>s],879002)},866045,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(145645),i=e.i(970065),n=e.i(167881),r=e.i(994179),l=e.i(630374),d=e.i(120682),o=e.i(607486),c=e.i(263488),m=e.i(879002),u=e.i(643531),g=e.i(555436),x=e.i(23750),h=e.i(704967);function j(){let{user:e}=(0,a.useUser)(),[j,f]=(0,t.useState)([]),[p,v]=(0,t.useState)([]),[N,C]=(0,t.useState)([]),[y,b]=(0,t.useState)(!0),[w,D]=(0,t.useState)(""),[z,I]=(0,t.useState)(null),{toast:k}=(0,d.useToast)();async function E(){try{let[e,s,t]=await Promise.all([fetch("/api/organizations/public"),fetch("/api/invitations"),fetch("/api/requests")]);if(e.ok){let s=await e.json();f(s)}if(s.ok){let e=await s.json();v(e)}if(t.ok){let e=await t.json();C(e)}}catch(e){k({title:"Erreur",description:"Impossible de charger les données",variant:"destructive"})}finally{b(!1)}}async function T(e,s){try{let t=await fetch(`/api/organizations/${e}/invitations/${s}`,{method:"POST"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to accept")}k({title:"Succès",description:"Invitation acceptée avec succès"}),E()}catch(e){k({title:"Erreur",description:e instanceof Error?e.message:"Impossible d'accepter l'invitation",variant:"destructive"})}}async function P(e){try{let s=await fetch(`/api/organizations/${e}/request`,{method:"POST"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to request")}k({title:"Succès",description:"Demande envoyée avec succès"}),I(null),E()}catch(e){k({title:"Erreur",description:e instanceof Error?e.message:"Impossible d'envoyer la demande",variant:"destructive"})}}(0,t.useEffect)(()=>{e?.role==="USER"&&E()},[e]);let U=(0,t.useMemo)(()=>e?j.filter(s=>s.owner.id===e.id||s.members.some(s=>s.user?.id?s.user.id===e.id:!!s.userId&&s.userId===e.id)):[],[j,e]),S=(0,t.useMemo)(()=>e?p.filter(s=>"PENDING"===s.status&&(s.email===e.email||s.user?.id===e.id)):[],[p,e]),B=(0,t.useMemo)(()=>e?N.filter(e=>"PENDING"===e.status):[],[N,e]),M=(0,t.useMemo)(()=>e?j.filter(s=>!(s.owner.id===e.id||s.members.some(s=>s.user?.id?s.user.id===e.id:!!s.userId&&s.userId===e.id)||B.some(e=>e.organization.id===s.id&&"PENDING"===e.status)||S.some(e=>e.organization.id===s.id&&"PENDING"===e.status))&&s.name.toLowerCase().includes(w.toLowerCase())):[],[j,e,B,S,w]);return e?.role!=="USER"?(0,s.jsx)("div",{className:"container mx-auto p-6",children:(0,s.jsx)(i.Card,{children:(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{children:"Accès refusé"}),(0,s.jsx)(i.CardDescription,{children:"Cette page est réservée aux utilisateurs."})]})})}):(0,s.jsxs)("div",{className:"container mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Mes Organisations"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Gérez vos organisations, invitations et demandes d'adhésion"})]}),y?(0,s.jsx)("div",{children:"Chargement..."}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(o.Building2,{className:"h-5 w-5"}),"Mes Organisations (",U.length,")"]}),(0,s.jsx)(i.CardDescription,{children:"Organisations dont vous êtes membre"})]}),(0,s.jsx)(i.CardContent,{children:U.length>0?(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:U.map(e=>(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{children:e.name}),(0,s.jsxs)(i.CardDescription,{children:["Propriétaire: ",e.owner.name||e.owner.email]})]}),(0,s.jsx)(i.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(m.UserPlus,{className:"h-4 w-4"}),e.members.length>0?`${e.members.length} membre${e.members.length>1?"s":""}`:"Aucun membre"]})})]},e.id))}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Vous n'êtes membre d'aucune organisation pour le moment."})})]}),S.length>0&&(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(c.Mail,{className:"h-5 w-5"}),"Invitations en attente (",S.length,")"]}),(0,s.jsx)(i.CardDescription,{children:"Invitations que vous avez reçues"})]}),(0,s.jsx)(i.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:S.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,h.getValidImageUrl)(e.organization.logo)&&(0,s.jsx)("img",{src:(0,h.getValidImageUrl)(e.organization.logo),alt:e.organization.name,className:"w-12 h-12 rounded object-contain",onError:e=>{e.target.style.display="none"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.organization.name}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Invité par ",e.invitedBy.name||e.invitedBy.email]})]})]}),(0,s.jsxs)(n.Button,{onClick:()=>T(e.organization.id,e.id),children:[(0,s.jsx)(u.Check,{className:"mr-2 h-4 w-4"}),"Accepter"]})]},e.id))})})]}),B.length>0&&(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.UserPlus,{className:"h-5 w-5"}),"Demandes en attente (",B.length,")"]}),(0,s.jsx)(i.CardDescription,{children:"Demandes d'adhésion en attente de validation"})]}),(0,s.jsx)(i.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,h.getValidImageUrl)(e.organization.logo)&&(0,s.jsx)("img",{src:(0,h.getValidImageUrl)(e.organization.logo),alt:e.organization.name,className:"w-12 h-12 rounded object-contain",onError:e=>{e.target.style.display="none"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.organization.name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"En attente de validation"})]})]}),(0,s.jsx)(r.Badge,{variant:"outline",children:"En attente"})]},e.id))})})]}),(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(g.Search,{className:"h-5 w-5"}),"Organisations disponibles"]}),(0,s.jsx)(i.CardDescription,{children:"Recherchez et demandez à rejoindre une organisation"})]}),(0,s.jsxs)(i.CardContent,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(x.Input,{placeholder:"Rechercher une organisation...",value:w,onChange:e=>D(e.target.value)})}),M.length>0?(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:M.map(e=>{let t=B.some(s=>s.organization.id===e.id&&"PENDING"===s.status),a=U.some(s=>s.id===e.id);return(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.getValidImageUrl)(e.logo)&&(0,s.jsx)("img",{src:(0,h.getValidImageUrl)(e.logo),alt:e.name,className:"w-10 h-10 rounded object-contain",onError:e=>{e.target.style.display="none"}}),(0,s.jsx)(i.CardTitle,{className:"flex-1",children:e.name})]}),(0,s.jsxs)(i.CardDescription,{children:["Propriétaire: ",e.owner.name||e.owner.email]})]}),(0,s.jsx)(i.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(m.UserPlus,{className:"h-4 w-4"}),e.members.length," membre",e.members.length>1?"s":""]}),a?(0,s.jsx)(r.Badge,{children:"Membre"}):t?(0,s.jsx)(r.Badge,{variant:"outline",children:"Demande envoyée"}):(0,s.jsxs)(l.Dialog,{open:z===e.id,onOpenChange:s=>I(s?e.id:null),children:[(0,s.jsx)(l.DialogTrigger,{asChild:!0,children:(0,s.jsxs)(n.Button,{variant:"outline",className:"w-full",children:[(0,s.jsx)(m.UserPlus,{className:"mr-2 h-4 w-4"}),"Demander à rejoindre"]})}),(0,s.jsxs)(l.DialogContent,{children:[(0,s.jsxs)(l.DialogHeader,{children:[(0,s.jsx)(l.DialogTitle,{children:"Demander à rejoindre"}),(0,s.jsxs)(l.DialogDescription,{children:['Voulez-vous demander à rejoindre "',e.name,'" ?']})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>I(null),children:"Annuler"}),(0,s.jsx)(n.Button,{onClick:()=>P(e.id),children:"Envoyer la demande"})]})]})]})]})})]},e.id)})}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:w?"Aucune organisation trouvée":"Aucune organisation disponible"})]})]})]})]})}e.s(["default",()=>j])}]);